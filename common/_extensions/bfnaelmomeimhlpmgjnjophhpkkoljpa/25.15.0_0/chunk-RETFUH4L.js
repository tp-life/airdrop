import{a as P,c as $}from"./chunk-7F2GBYX5.js";import{a as k}from"./chunk-HYOCMEEG.js";import{l as N}from"./chunk-O3RSUGZX.js";import{c as B,d as y,f as _,g as v,h as A,l as C}from"./chunk-27TD4NX4.js";import{D,E as R,F as x,G as O,H as m,I as T}from"./chunk-FBDT5S2M.js";import{i as b}from"./chunk-TKSJVOQZ.js";import{c as Q,f as F,h as g,i as d,n as u}from"./chunk-3KENBVE7.js";var j=Q(p=>{"use strict";g();u();var h=B();d.NODE_ENV==="production"?(p.createRoot=h.createRoot,p.hydrateRoot=h.hydrateRoot):(f=h.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,p.createRoot=function(i,e){f.usingClientEntryPoint=!0;try{return h.createRoot(i,e)}finally{f.usingClientEntryPoint=!1}},p.hydrateRoot=function(i,e,t){f.usingClientEntryPoint=!0;try{return h.hydrateRoot(i,e,t)}finally{f.usingClientEntryPoint=!1}});var f});g();u();g();u();var M=F(C()),w=F(k());var I=new P,U=".phantom-labs.log",z="state-log",E=class i{maxSize=1024*1024;maxDepth=5;autoTrim=!1;disableDebounce=!1;includeSessionMetadata=!1;quoteStrings=!1;useLocalStorage=!1;useTimestamps=!1;indent="  ";logFilename=z;storageKey=U;startTime;logs="";logQueue;logQueueSize=256;debounceSaveAndFlushQueuedLogs=(0,M.default)(this.saveAndFlushQueuedLogs,4e3);constructor(e){if(e)for(let t in e)e[t]!==void 0&&(this[t]=e[t])}static async init(e){let t=new i(e);if(t.useLocalStorage){let o=await t.getDataFromStorage();if(o){t.logs=o.log,t.startTime=new Date(o.startTime);let n=new Date(o.lastLog);t.addSessionMetadataToLog(`Last session end: ${o.lastLog}`),t.addSessionMetadataToLog(`Last ${t.formatSessionDuration(t.startTime,n)}`)}}return t.addSessionStartToLog(),t.logQueue=new b(t.disableDebounce?1:t.logQueueSize),t}async downloadLog(e,t){try{let o=x(e,t);await this.saveAndFlushQueuedLogs();let n=this.useLocalStorage?await this.getLogsFromStorage():this.logs,r=O(`${o}${n}`),s=new Blob([r],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(s),L=new Date().toISOString().replace(/:|\./g,"-").slice(0,-5),S=`${this.logFilename}-${L}.txt`;if(w.default.downloads&&typeof w.default.downloads.download=="function")await w.default.downloads.download({url:a,filename:S,saveAs:!0}),URL.revokeObjectURL(a);else{let l=document.createElement("a");l.href=self.URL.createObjectURL(s),l.target="_blank",l.rel="noopener noreferrer",l.download=S,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(l.href)}}catch(o){let n=`Error downloading log file: ${o}`;D.captureError(new Error(n),"fileLogger"),console.error(n)}}getRecentLogs(e){let t=new TextEncoder,o=this.logs.split(`
`),n=0,r=o.length;for(let s=o.length-1;s>=0;s--){let a=t.encode(o[s]).length+1;if(n+a>e)break;n+=a,r=s}return o.slice(r).join(`
`)+`
`}write(...e){this.queueAndBatchWriteLogs(...e)}async queueAndBatchWriteLogs(...e){let t=this.formatNewLogData(...e);this.logQueue.add(t),this.debounceSaveAndFlushQueuedLogs.cancel(),this.logQueue.isFull()?await this.saveAndFlushQueuedLogs():await this.debounceSaveAndFlushQueuedLogs()}async saveAndFlushQueuedLogs(){this.logQueue.isEmpty()||(this.addItemToLogs(this.logQueue.toArray()),this.useLocalStorage&&await this.saveDataToStorage(this.logs),this.logQueue.clear())}formatNewLogData(...e){let t="";return this.useTimestamps&&(t+=this.formatDate()+" "),t+=e.map(o=>R({obj:o,depth:0,maxDepth:this.maxDepth,indent:this.indent,quoteStrings:this.quoteStrings})).join(" "),t+=`
`,t}addItemToLogs(e){Array.isArray(e)?e.forEach(t=>this.logs+=t):this.logs+=e,this.autoTrim&&(this.logs=this.trimLogByPercentage(.5,this.maxSize))}async saveDataToStorage(e){let t={startTime:this.startTime,log:e,lastLog:new Date};await I.set(this.storageKey,JSON.stringify(t))}async getLogsFromStorage(){let e=new Date,t=await this.getDataFromStorage();return t&&(this.startTime=new Date(t.startTime),this.logs=t.log),this.includeSessionMetadata?this.logs+`---- ${this.formatSessionDuration(this.startTime,e)} ----
`:this.logs}async getDataFromStorage(){let e=await I.get(this.storageKey);return e&&typeof e=="string"?JSON.parse(e):null}trimLogByPercentage(e,t){if(e<0||e>1)throw new Error("Percentage must be between 0 and 1");if(new TextEncoder().encode(this.logs).length<=t)return this.logs;let r=this.logs.split(`
`);r.pop();let s=Math.floor(r.length*e);return r.splice(0,s),r.join(`
`)+`
`}formatSessionDuration(e,t){let o=t.getTime()-e.getTime(),n=Math.floor(o/1e3/60/60),r=("0"+n).slice(-2);o-=n*1e3*60*60;let s=Math.floor(o/1e3/60),a=("0"+s).slice(-2);o-=s*1e3*60;let L=Math.floor(o/1e3),S=("0"+L).slice(-2);return o-=L*1e3,"Session duration: "+r+":"+a+":"+S}formatDate(e=new Date){return`[${e.toISOString()}]`}addSessionMetadataToLog(e){this.includeSessionMetadata&&(this.logs+=`---- ${e} ----
`)}addSessionStartToLog(){this.startTime=new Date,this.addSessionMetadataToLog(`Session started: ${this.formatDate(this.startTime)}`)}async clear(){this.logs="",this.logQueue.clear(),this.addSessionMetadataToLog(`Session started: ${this.formatDate(this.startTime)}`),this.addSessionMetadataToLog("Log cleared "+this.formatDate()),this.useLocalStorage&&await this.saveDataToStorage(this.logs)}search(e){let t=new RegExp(e,"ig"),o=this.logs.split(`
`),n=[];for(let s=0;s<o.length;s++){let a=`[${s}] `;o[s].match(t)&&n.push(a+o[s].trim())}let r=n.join(`
`);return r.length||(r=`Nothing found for "${e}".`),r}slice(...e){return this.logs.split(`
`).slice(...e).join(`
`)}};var q=1024*10,G={autoTrim:!0,useLocalStorage:!0,useTimestamps:!0},c=null,re={init:async()=>{try{c=await E.init(G)}catch{console.error(m)}},downloadLog:async i=>{if(!c){console.error(m);return}await c.saveAndFlushQueuedLogs()},getRecentLogs:async()=>c?c.getRecentLogs(q):(console.error(m),""),write:(i,e,t,o)=>{if(!c){console.error(m);return}let n=o?` :: ${JSON.stringify(o)}`:"",s=`${(t??"info").toUpperCase()}: ${e}: ${i}${n}`;c.write(s)},getLogFilePaths:()=>{throw new Error(T)},sendLogFilesByEmail:async i=>{throw new Error(T)}};g();u();var K=new v(null,{loadPath:i=>{let e=i[0];return e.substring(0,3)==="fil"?`/locales/${e.substring(0,3)}/translation.json`:e.substring(0,2)==="zh"?e==="zh-CN"||e==="zh-TW"?`/locales/${e}/translation.json`:"/locales/zh-CN/translation.json":`/locales/${e.substring(0,2)}/translation.json`},parse:i=>JSON.parse(i)});y.use(v).use(_).use(A).use(K).init({supportedLngs:N(),fallbackLng:"en",nonExplicitSupportedLngs:!0,debug:!1,returnNull:!1,detection:{order:["querystring","localStorage","cookie","sessionStorage","navigator","htmlTag","path","subdomain"],caches:["localStorage"]},react:{useSuspense:!1},interpolation:{escapeValue:!1}});y.on("initialized",()=>{$.setDisplayLanguage(y.language)});export{j as a,c as b,re as c};
//# sourceMappingURL=chunk-RETFUH4L.js.map
