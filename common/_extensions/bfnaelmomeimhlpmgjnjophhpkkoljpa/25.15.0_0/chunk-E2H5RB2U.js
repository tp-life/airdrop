import{A as Mt,D as v,K as Kr,u as xe,w as we,z as te}from"./chunk-FBDT5S2M.js";import{k as jt,w as fe}from"./chunk-TKSJVOQZ.js";import{a as Mr,h as d,l as Dt,n as Q,x as Ht,z as Nt}from"./chunk-UA6ADLWZ.js";import{c as x,f as ee,h as s,i as p,j as jr,l as Bt,m as Buffer,n as a}from"./chunk-3KENBVE7.js";var ce=x(Ie=>{"use strict";s();a();Object.defineProperty(Ie,"__esModule",{value:!0});Ie.AppAuthError=void 0;var yo=function(){function t(e,r){this.message=e,this.extras=r}return t}();Ie.AppAuthError=yo});var Se=x(P=>{"use strict";s();a();Object.defineProperty(P,"__esModule",{value:!0});P.DefaultCrypto=P.textEncodeLite=P.urlSafe=P.bufferToString=void 0;var mo=jr(),ur=ce(),hr=typeof self<"u"&&!!self.crypto,Ao=hr&&!!self.crypto.subtle,pt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";function pr(t){for(var e=[],r=0;r<t.byteLength;r+=1){var o=t[r]%pt.length;e.push(pt[o])}return e.join("")}P.bufferToString=pr;function fr(t){var e=mo.fromByteArray(new Uint8Array(t));return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}P.urlSafe=fr;function dr(t){for(var e=new ArrayBuffer(t.length),r=new Uint8Array(e),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return r}P.textEncodeLite=dr;var xo=function(){function t(){}return t.prototype.generateRandom=function(e){var r=new Uint8Array(e);if(hr)self.crypto.getRandomValues(r);else for(var o=0;o<e;o+=1)r[o]=Math.random()*pt.length|0;return pr(r)},t.prototype.deriveChallenge=function(e){return e.length<43||e.length>128?Promise.reject(new ur.AppAuthError("Invalid code length.")):Ao?new Promise(function(r,o){self.crypto.subtle.digest("SHA-256",dr(e)).then(function(n){return r(fr(new Uint8Array(n)))},function(n){return o(n)})}):Promise.reject(new ur.AppAuthError("window.crypto.subtle is unavailable."))},t}();P.DefaultCrypto=xo});var ft=x(_=>{"use strict";s();a();Object.defineProperty(_,"__esModule",{value:!0});_.IS_PROFILE=_.IS_LOG=_.setFlag=_.Flags=void 0;_.Flags={IS_LOG:!0,IS_PROFILE:!1};function wo(t,e){_.Flags[t]=e}_.setFlag=wo;_.IS_LOG=_.Flags.IS_LOG,_.IS_PROFILE=_.Flags.IS_PROFILE});var le=x(N=>{"use strict";s();a();var dt=N&&N.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var o=0,n=e.length,i;o<n;o++)(i||!(o in e))&&(i||(i=Array.prototype.slice.call(e,0,o)),i[o]=e[o]);return t.concat(i||Array.prototype.slice.call(e))};Object.defineProperty(N,"__esModule",{value:!0});N.profile=N.log=void 0;var lr=ft();function lt(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(lr.Flags.IS_LOG){var o=e?e.length:0;o>0?console.log.apply(console,dt([t],e,!1)):console.log(t)}}N.log=lt;var bo=typeof self<"u"&&!!self.performance&&!!console.profile;function To(t,e,r){return lr.Flags.IS_PROFILE?Eo(t,e,r):r}N.profile=To;function Eo(t,e,r){var o=r.value,n=o.name;return n||(n="anonymous function"),bo?r.value=function(i){console.profile(n);var c=self.performance.now(),u=o.call.apply(o,dt([this||self],i,!1)),h=self.performance.now()-c;return console.log("".concat(n," took ").concat(h," ms")),console.profileEnd(),u}:r.value=function(i){lt("Profile start ".concat(n));var c=Date.now(),u=o.call.apply(o,dt([this||self],i,!1)),h=Date.now()-c;return lt("Profile end ".concat(n," took ").concat(h," ms.")),u},r}});var gt=x(Pe=>{"use strict";s();a();Object.defineProperty(Pe,"__esModule",{value:!0});Pe.AuthorizationRequest=void 0;var vo=Se(),_o=le(),Ro=10,ko=function(t){return t.generateRandom(Ro)},Uo=function(){function t(e,r,o){r===void 0&&(r=new vo.DefaultCrypto),o===void 0&&(o=!0),this.crypto=r,this.usePkce=o,this.clientId=e.client_id,this.redirectUri=e.redirect_uri,this.scope=e.scope,this.responseType=e.response_type||t.RESPONSE_TYPE_CODE,this.state=e.state||ko(r),this.extras=e.extras,this.internal=e.internal}return t.prototype.setupCodeVerifier=function(){var e=this;if(this.usePkce){var r=this.crypto.generateRandom(128),o=this.crypto.deriveChallenge(r).catch(function(n){(0,_o.log)("Unable to generate PKCE challenge. Not using PKCE",n)});return o.then(function(n){n&&(e.internal=e.internal||{},e.internal.code_verifier=r,e.extras=e.extras||{},e.extras.code_challenge=n,e.extras.code_challenge_method="S256")})}else return Promise.resolve()},t.prototype.toJson=function(){var e=this;return this.setupCodeVerifier().then(function(){return{response_type:e.responseType,client_id:e.clientId,redirect_uri:e.redirectUri,scope:e.scope,state:e.state,extras:e.extras,internal:e.internal}})},t.RESPONSE_TYPE_TOKEN="token",t.RESPONSE_TYPE_CODE="code",t}();Pe.AuthorizationRequest=Uo});var gr=x(Le=>{"use strict";s();a();Object.defineProperty(Le,"__esModule",{value:!0});Le.requireValidUrl=void 0;var Io=ce();function So(t){try{return new URL(t),t}catch{throw new Io.AppAuthError("Invalid input url ".concat(t))}}Le.requireValidUrl=So});var mt=x(C=>{"use strict";s();a();Object.defineProperty(C,"__esModule",{value:!0});C.AuthorizationRequestHandler=C.BUILT_IN_PARAMETERS=C.AuthorizationNotifier=void 0;var yt=le(),Po=gr(),Lo=function(){function t(){this.listener=null}return t.prototype.setAuthorizationListener=function(e){this.listener=e},t.prototype.onAuthorizationComplete=function(e,r,o){this.listener&&this.listener(e,r,o)},t}();C.AuthorizationNotifier=Lo;C.BUILT_IN_PARAMETERS=["redirect_uri","client_id","response_type","state","scope"];var Oo=function(){function t(e,r){this.utils=e,this.crypto=r,this.notifier=null}return t.prototype.buildRequestUrl=function(e,r){var o={redirect_uri:r.redirectUri,client_id:r.clientId,response_type:r.responseType,state:r.state,scope:r.scope};if(r.extras)for(var n in r.extras)r.extras.hasOwnProperty(n)&&C.BUILT_IN_PARAMETERS.indexOf(n)<0&&(o[n]=r.extras[n]);var i=this.utils.stringify(o),c=(0,Po.requireValidUrl)(e.authorizationEndpoint),u="".concat(c,"?").concat(i);return u},t.prototype.completeAuthorizationRequestIfPossible=function(){var e=this;return(0,yt.log)("Checking to see if there is an authorization response to be delivered."),this.notifier||(0,yt.log)(`Notifier is not present on AuthorizationRequest handler.
          No delivery of result will be possible`),this.completeAuthorizationRequest().then(function(r){r||(0,yt.log)("No result is available yet."),r&&e.notifier&&e.notifier.onAuthorizationComplete(r.request,r.response,r.error)})},t.prototype.setAuthorizationNotifier=function(e){return this.notifier=e,this},t}();C.AuthorizationRequestHandler=Oo});var At=x(ue=>{"use strict";s();a();Object.defineProperty(ue,"__esModule",{value:!0});ue.AuthorizationError=ue.AuthorizationResponse=void 0;var Co=function(){function t(e){this.code=e.code,this.state=e.state}return t.prototype.toJson=function(){return{code:this.code,state:this.state}},t}();ue.AuthorizationResponse=Co;var qo=function(){function t(e){this.error=e.error,this.errorDescription=e.error_description,this.errorUri=e.error_uri,this.state=e.state}return t.prototype.toJson=function(){return{error:this.error,error_description:this.errorDescription,error_uri:this.errorUri,state:this.state}},t}();ue.AuthorizationError=qo});var Ce=x(R=>{"use strict";s();a();var wt=R&&R.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(o[i]=n[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function o(){this.constructor=e}e.prototype=r===null?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(R,"__esModule",{value:!0});R.TestRequestor=R.FetchRequestor=R.JQueryRequestor=R.Requestor=void 0;var xt=ce(),Oe=function(){function t(){}return t}();R.Requestor=Oe;var Fo=function(t){wt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.xhr=function(r){var o=$.ajax(r);return new Promise(function(n,i){o.then(function(c,u,h){n(c)},function(c,u,h){i(new xt.AppAuthError(h))})})},e}(Oe);R.JQueryRequestor=Fo;var Bo=function(t){wt(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e.prototype.xhr=function(r){if(!r.url)return Promise.reject(new xt.AppAuthError("A URL must be provided."));var o=new URL(r.url),n={};if(n.method=r.method,n.mode="cors",r.data)if(r.method&&r.method.toUpperCase()==="POST")n.body=r.data;else{var i=new URLSearchParams(r.data);i.forEach(function(h,l){o.searchParams.append(l,h)})}if(n.headers={},r.headers)for(var c in r.headers)r.headers.hasOwnProperty(c)&&(n.headers[c]=r.headers[c]);var u=r.dataType&&r.dataType.toLowerCase()==="json";return u&&(n.headers.Accept="application/json, text/javascript, */*; q=0.01"),fetch(o.toString(),n).then(function(h){if(h.status>=200&&h.status<300){var l=h.headers.get("content-type");return u||l&&l.indexOf("application/json")!==-1?h.json():h.text()}else return Promise.reject(new xt.AppAuthError(h.status.toString(),h.statusText))})},e}(Oe);R.FetchRequestor=Bo;var Do=function(t){wt(e,t);function e(r){var o=t.call(this)||this;return o.promise=r,o}return e.prototype.xhr=function(r){return this.promise},e}(Oe);R.TestRequestor=Do});var yr=x(qe=>{"use strict";s();a();Object.defineProperty(qe,"__esModule",{value:!0});qe.AuthorizationServiceConfiguration=void 0;var Ho=Ce(),No=".well-known",jo="openid-configuration",Mo=function(){function t(e){this.authorizationEndpoint=e.authorization_endpoint,this.tokenEndpoint=e.token_endpoint,this.revocationEndpoint=e.revocation_endpoint,this.userInfoEndpoint=e.userinfo_endpoint,this.endSessionEndpoint=e.end_session_endpoint}return t.prototype.toJson=function(){return{authorization_endpoint:this.authorizationEndpoint,token_endpoint:this.tokenEndpoint,revocation_endpoint:this.revocationEndpoint,end_session_endpoint:this.endSessionEndpoint,userinfo_endpoint:this.userInfoEndpoint}},t.fetchFromIssuer=function(e,r){var o="".concat(e,"/").concat(No,"/").concat(jo),n=r||new Ho.JQueryRequestor;return n.xhr({url:o,dataType:"json",method:"GET"}).then(function(i){return new t(i)})},t}();qe.AuthorizationServiceConfiguration=Mo});var Be=x(Fe=>{"use strict";s();a();Object.defineProperty(Fe,"__esModule",{value:!0});Fe.BasicQueryStringUtils=void 0;var Ko=function(){function t(){}return t.prototype.parse=function(e,r){return r?this.parseQueryString(e.hash):this.parseQueryString(e.search)},t.prototype.parseQueryString=function(e){var r={};e=e.trim().replace(/^(\?|#|&)/,"");for(var o=e.split("&"),n=0;n<o.length;n+=1){var i=o[n],c=i.split("=");if(c.length>=2){var u=decodeURIComponent(c.shift()),h=c.length>0?c.join("="):null;h&&(r[u]=decodeURIComponent(h))}}return r},t.prototype.stringify=function(e){var r=[];for(var o in e)e.hasOwnProperty(o)&&e[o]&&r.push("".concat(encodeURIComponent(o),"=").concat(encodeURIComponent(e[o])));return r.join("&")},t}();Fe.BasicQueryStringUtils=Ko});var bt=x(j=>{"use strict";s();a();var Wo=j&&j.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(o[i]=n[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function o(){this.constructor=e}e.prototype=r===null?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(j,"__esModule",{value:!0});j.LocalStorageBackend=j.StorageBackend=void 0;var mr=function(){function t(){}return t}();j.StorageBackend=mr;var Jo=function(t){Wo(e,t);function e(r){var o=t.call(this)||this;return o.storage=r||self.localStorage,o}return e.prototype.getItem=function(r){var o=this;return new Promise(function(n,i){var c=o.storage.getItem(r);n(c||null)})},e.prototype.removeItem=function(r){var o=this;return new Promise(function(n,i){o.storage.removeItem(r),n()})},e.prototype.clear=function(){var r=this;return new Promise(function(o,n){r.storage.clear(),o()})},e.prototype.setItem=function(r,o){var n=this;return new Promise(function(i,c){n.storage.setItem(r,o),i()})},e}(mr);j.LocalStorageBackend=Jo});var wr=x(he=>{"use strict";s();a();var zo=he&&he.__extends||function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,n){o.__proto__=n}||function(o,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(o[i]=n[i])},t(e,r)};return function(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function o(){this.constructor=e}e.prototype=r===null?Object.create(r):(o.prototype=r.prototype,new o)}}();Object.defineProperty(he,"__esModule",{value:!0});he.RedirectRequestHandler=void 0;var $o=gt(),Qo=mt(),Ar=At(),Vo=Se(),De=le(),Go=Be(),Yo=bt(),Tt=function(t){return"".concat(t,"_appauth_authorization_request")},xr=function(t){return"".concat(t,"_appauth_authorization_service_configuration")},Et="appauth_current_authorization_request",Xo=function(t){zo(e,t);function e(r,o,n,i){r===void 0&&(r=new Yo.LocalStorageBackend),o===void 0&&(o=new Go.BasicQueryStringUtils),n===void 0&&(n=self.location),i===void 0&&(i=new Vo.DefaultCrypto);var c=t.call(this,o,i)||this;return c.storageBackend=r,c.locationLike=n,c}return e.prototype.performAuthorizationRequest=function(r,o){var n=this,i=this.crypto.generateRandom(10),c=Promise.all([this.storageBackend.setItem(Et,i),o.toJson().then(function(u){return n.storageBackend.setItem(Tt(i),JSON.stringify(u))}),this.storageBackend.setItem(xr(i),JSON.stringify(r.toJson()))]);c.then(function(){var u=n.buildRequestUrl(r,o);(0,De.log)("Making a request to ",o,u),n.locationLike.assign(u)})},e.prototype.completeAuthorizationRequest=function(){var r=this;return this.storageBackend.getItem(Et).then(function(o){return o?r.storageBackend.getItem(Tt(o)).then(function(n){return JSON.parse(n)}).then(function(n){return new $o.AuthorizationRequest(n)}).then(function(n){var i="".concat(r.locationLike.origin).concat(r.locationLike.pathname),c=r.utils.parse(r.locationLike,!0),u=c.state,h=c.code,l=c.error;(0,De.log)("Potential authorization request ",i,c,u,h,l);var g=u===n.state,f=null,m=null;if(g){if(l){var A=c.error_uri,T=c.error_description;m=new Ar.AuthorizationError({error:l,error_description:T,error_uri:A,state:u})}else f=new Ar.AuthorizationResponse({code:h,state:u});return Promise.all([r.storageBackend.removeItem(Et),r.storageBackend.removeItem(Tt(o)),r.storageBackend.removeItem(xr(o))]).then(function(){return(0,De.log)("Delivering authorization response"),{request:n,response:f,error:m}})}else return(0,De.log)("Mismatched request (state and request_uri) dont match."),Promise.resolve(null)}):null})},e}(Qo.AuthorizationRequestHandler);he.RedirectRequestHandler=Xo});var br=x(He=>{"use strict";s();a();Object.defineProperty(He,"__esModule",{value:!0});He.RevokeTokenRequest=void 0;var Zo=function(){function t(e){this.token=e.token,this.tokenTypeHint=e.token_type_hint,this.clientId=e.client_id,this.clientSecret=e.client_secret}return t.prototype.toJson=function(){var e={token:this.token};return this.tokenTypeHint&&(e.token_type_hint=this.tokenTypeHint),this.clientId&&(e.client_id=this.clientId),this.clientSecret&&(e.client_secret=this.clientSecret),e},t.prototype.toStringMap=function(){var e=this.toJson();return e},t}();He.RevokeTokenRequest=Zo});var Tr=x(M=>{"use strict";s();a();Object.defineProperty(M,"__esModule",{value:!0});M.TokenRequest=M.GRANT_TYPE_REFRESH_TOKEN=M.GRANT_TYPE_AUTHORIZATION_CODE=void 0;M.GRANT_TYPE_AUTHORIZATION_CODE="authorization_code";M.GRANT_TYPE_REFRESH_TOKEN="refresh_token";var en=function(){function t(e){this.clientId=e.client_id,this.redirectUri=e.redirect_uri,this.grantType=e.grant_type,this.code=e.code,this.refreshToken=e.refresh_token,this.extras=e.extras}return t.prototype.toJson=function(){return{grant_type:this.grantType,code:this.code,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,client_id:this.clientId,extras:this.extras}},t.prototype.toStringMap=function(){var e={grant_type:this.grantType,client_id:this.clientId,redirect_uri:this.redirectUri};if(this.code&&(e.code=this.code),this.refreshToken&&(e.refresh_token=this.refreshToken),this.extras)for(var r in this.extras)this.extras.hasOwnProperty(r)&&!e.hasOwnProperty(r)&&(e[r]=this.extras[r]);return e},t}();M.TokenRequest=en});var vt=x(L=>{"use strict";s();a();Object.defineProperty(L,"__esModule",{value:!0});L.TokenError=L.TokenResponse=L.nowInSeconds=void 0;var tn=10*60*-1,rn=function(){return Math.round(new Date().getTime()/1e3)};L.nowInSeconds=rn;var on=function(){function t(e){this.accessToken=e.access_token,this.tokenType=e.token_type||"bearer",e.expires_in&&(this.expiresIn=parseInt(e.expires_in,10)),this.refreshToken=e.refresh_token,this.scope=e.scope,this.idToken=e.id_token,this.issuedAt=e.issued_at||(0,L.nowInSeconds)()}return t.prototype.toJson=function(){var e;return{access_token:this.accessToken,id_token:this.idToken,refresh_token:this.refreshToken,scope:this.scope,token_type:this.tokenType,issued_at:this.issuedAt,expires_in:(e=this.expiresIn)===null||e===void 0?void 0:e.toString()}},t.prototype.isValid=function(e){if(e===void 0&&(e=tn),this.expiresIn){var r=(0,L.nowInSeconds)();return r<this.issuedAt+this.expiresIn+e}else return!0},t}();L.TokenResponse=on;var nn=function(){function t(e){this.error=e.error,this.errorDescription=e.error_description,this.errorUri=e.error_uri}return t.prototype.toJson=function(){return{error:this.error,error_description:this.errorDescription,error_uri:this.errorUri}},t}();L.TokenError=nn});var vr=x(Ne=>{"use strict";s();a();Object.defineProperty(Ne,"__esModule",{value:!0});Ne.BaseTokenRequestHandler=void 0;var sn=ce(),an=Be(),Er=vt(),cn=Ce(),un=function(){function t(e,r){e===void 0&&(e=new cn.JQueryRequestor),r===void 0&&(r=new an.BasicQueryStringUtils),this.requestor=e,this.utils=r}return t.prototype.isTokenResponse=function(e){return e.error===void 0},t.prototype.performRevokeTokenRequest=function(e,r){var o=this.requestor.xhr({url:e.revocationEndpoint,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:this.utils.stringify(r.toStringMap())});return o.then(function(n){return!0})},t.prototype.performTokenRequest=function(e,r){var o=this,n=this.requestor.xhr({url:e.tokenEndpoint,method:"POST",dataType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:this.utils.stringify(r.toStringMap())});return n.then(function(i){return o.isTokenResponse(i)?new Er.TokenResponse(i):Promise.reject(new sn.AppAuthError(i.error,new Er.TokenError(i)))})},t}();Ne.BaseTokenRequestHandler=un});var Rr=x(_r=>{"use strict";s();a();Object.defineProperty(_r,"__esModule",{value:!0})});var _t=x(y=>{"use strict";s();a();var hn=y&&y.__createBinding||(Object.create?function(t,e,r,o){o===void 0&&(o=r);var n=Object.getOwnPropertyDescriptor(e,r);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,o,n)}:function(t,e,r,o){o===void 0&&(o=r),t[o]=e[r]}),b=y&&y.__exportStar||function(t,e){for(var r in t)r!=="default"&&!Object.prototype.hasOwnProperty.call(e,r)&&hn(e,t,r)};Object.defineProperty(y,"__esModule",{value:!0});b(gt(),y);b(mt(),y);b(At(),y);b(yr(),y);b(Se(),y);b(ce(),y);b(ft(),y);b(le(),y);b(Be(),y);b(wr(),y);b(br(),y);b(bt(),y);b(Tr(),y);b(vr(),y);b(vt(),y);b(Rr(),y);b(Ce(),y)});s();a();var re=ee(Mr()),Kt=(0,re.createContext)(null);function Wr({children:t,authRepository:e}){return re.default.createElement(Kt.Provider,{value:e},t)}function B(){let t=(0,re.useContext)(Kt);if(!t)throw new Error("useAuthRepository must be used within an AuthProvider");return t}function S(){return B().useUser()}s();a();s();a();var ut=ee(Bt());s();a();var Ze="https://phantom.app",et="https://api.phantom.app/oauth2/auth",be={prod:"a61bc25e-0c4f-4ab3-aa54-b50ec746eea2",staging:"fe26708b-7db7-4146-9fbb-9a9736acfb2b"},Te={prod:"https://auth.phantom.app",staging:"https://staging-auth.phantom.app"},Wt="/login/start",Jt="/oauth2/token";var Jr="https://help.phantom.com/hc/en-us/articles/32367778944403";var zt=fe({minutes:60})-fe({minutes:15}),V="/v1/authentication-keys";s();a();var oe=t=>Buffer.from(t).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");s();a();s();a();s();a();s();a();var tt=null;function rt(t){tt=t}async function $t(){if(!tt)throw new Error("No fetch bearer token function registered. Register one with registerFetchBearerToken().");return await tt()}s();a();s();a();function Qt(...t){let e=new AbortController;for(let r of t){let o=r instanceof AbortController?r.signal:r;if(o?.aborted)return e.abort(o.reason),e.signal;o?.addEventListener("abort",()=>{e.abort(o.reason)},{once:!0})}return e.signal}var zr=2*60*1e3,$r=[];function Vt(t,e){let{fetchTimeout:r,retryDelays:o,...n}=e||{},i=e?.fetchTimeout??zr,c=e?.retryDelays??$r,u=0,h=0;return new Promise((l,g)=>{function f(){u++,h=Date.now();let T=!0,w=new AbortController,Xe=fetch(t,{...n,signal:Qt(...n.signal?[n.signal,w.signal]:[w.signal])}),Ft=setTimeout(()=>{w.abort(),T=!1,A(u)?m():g(new Error(`fetchWithTimeoutAndRetry(): Failed to get response from server due to timeout of ${i} ms, tried ${u} times.`))},i);Xe.then(z=>{clearTimeout(Ft),T&&(z.status>=200&&z.status<300?l(z):A(u,z.status)?m():l(z))}).catch(z=>{clearTimeout(Ft),A(u)?m():g(z)})}function m(){let T=c[u-1],w=h+T;setTimeout(f,Math.max(w-Date.now(),0))}function A(T,w){let Xe=w?w>=400&&w<=499:!1;return T<=c.length&&!Xe}f()})}s();a();var Ee=(t={},e={})=>{let r=new Headers(t),o=new Headers(e);for(let[n,i]of o.entries())i===void 0||i==="undefined"?r.delete(n):r.set(n,i);return r};s();a();var se=ee(Bt());s();a();s();a();function Gt(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function ot(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function Yt(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Gt(t.outputLen),Gt(t.blockLen)}function ne(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Xt(t,e){ot(t);let r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}s();a();s();a();var ve=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Zt=t=>t instanceof Uint8Array;var _e=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),U=(t,e)=>t<<32-e|t>>>e,Qr=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Qr)throw new Error("Non little-endian hardware is not supported");function Vr(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function de(t){if(typeof t=="string"&&(t=Vr(t)),!Zt(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Ri(...t){let e=new Uint8Array(t.reduce((o,n)=>o+n.length,0)),r=0;return t.forEach(o=>{if(!Zt(o))throw new Error("Uint8Array expected");e.set(o,r),r+=o.length}),e}var ie=class{clone(){return this._cloneInto()}},ki={}.toString;function er(t){let e=o=>t().update(de(o)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function Ui(t=32){if(ve&&typeof ve.getRandomValues=="function")return ve.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}var Re=class extends ie{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,Yt(e);let o=de(r);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,i=new Uint8Array(n);i.set(o.length>n?e.create().update(o).digest():o);for(let c=0;c<i.length;c++)i[c]^=54;this.iHash.update(i),this.oHash=e.create();for(let c=0;c<i.length;c++)i[c]^=106;this.oHash.update(i),i.fill(0)}update(e){return ne(this),this.iHash.update(e),this}digestInto(e){ne(this),ot(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:r,iHash:o,finished:n,destroyed:i,blockLen:c,outputLen:u}=this;return e=e,e.finished=n,e.destroyed=i,e.blockLen=c,e.outputLen=u,e.oHash=r._cloneInto(e.oHash),e.iHash=o._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},nt=(t,e,r)=>new Re(t,e).update(r).digest();nt.create=(t,e)=>new Re(t,e);s();a();s();a();function Gr(t,e,r,o){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,o);let n=BigInt(32),i=BigInt(4294967295),c=Number(r>>n&i),u=Number(r&i),h=o?4:0,l=o?0:4;t.setUint32(e+h,c,o),t.setUint32(e+l,u,o)}var ke=class extends ie{constructor(e,r,o,n){super(),this.blockLen=e,this.outputLen=r,this.padOffset=o,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=_e(this.buffer)}update(e){ne(this);let{view:r,buffer:o,blockLen:n}=this;e=de(e);let i=e.length;for(let c=0;c<i;){let u=Math.min(n-this.pos,i-c);if(u===n){let h=_e(e);for(;n<=i-c;c+=n)this.process(h,c);continue}o.set(e.subarray(c,c+u),this.pos),this.pos+=u,c+=u,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ne(this),Xt(e,this),this.finished=!0;let{buffer:r,view:o,blockLen:n,isLE:i}=this,{pos:c}=this;r[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>n-c&&(this.process(o,0),c=0);for(let f=c;f<n;f++)r[f]=0;Gr(o,n-8,BigInt(this.length*8),i),this.process(o,0);let u=_e(e),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=h/4,g=this.get();if(l>g.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)u.setUint32(4*f,g[f],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let o=e.slice(0,r);return this.destroy(),o}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:o,length:n,finished:i,destroyed:c,pos:u}=this;return e.length=n,e.pos=u,e.finished=i,e.destroyed=c,n%r&&e.buffer.set(o),e}};var Yr=(t,e,r)=>t&e^~t&r,Xr=(t,e,r)=>t&e^t&r^e&r,Zr=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),D=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),H=new Uint32Array(64),it=class extends ke{constructor(){super(64,32,8,!1),this.A=D[0]|0,this.B=D[1]|0,this.C=D[2]|0,this.D=D[3]|0,this.E=D[4]|0,this.F=D[5]|0,this.G=D[6]|0,this.H=D[7]|0}get(){let{A:e,B:r,C:o,D:n,E:i,F:c,G:u,H:h}=this;return[e,r,o,n,i,c,u,h]}set(e,r,o,n,i,c,u,h){this.A=e|0,this.B=r|0,this.C=o|0,this.D=n|0,this.E=i|0,this.F=c|0,this.G=u|0,this.H=h|0}process(e,r){for(let f=0;f<16;f++,r+=4)H[f]=e.getUint32(r,!1);for(let f=16;f<64;f++){let m=H[f-15],A=H[f-2],T=U(m,7)^U(m,18)^m>>>3,w=U(A,17)^U(A,19)^A>>>10;H[f]=w+H[f-7]+T+H[f-16]|0}let{A:o,B:n,C:i,D:c,E:u,F:h,G:l,H:g}=this;for(let f=0;f<64;f++){let m=U(u,6)^U(u,11)^U(u,25),A=g+m+Yr(u,h,l)+Zr[f]+H[f]|0,w=(U(o,2)^U(o,13)^U(o,22))+Xr(o,n,i)|0;g=l,l=h,h=u,u=c+A|0,c=i,i=n,n=o,o=A+w|0}o=o+this.A|0,n=n+this.B|0,i=i+this.C|0,c=c+this.D|0,u=u+this.E|0,h=h+this.F|0,l=l+this.G|0,g=g+this.H|0,this.set(o,n,i,c,u,h,l,g)}roundClean(){H.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var tr=er(()=>new it);var eo=[86,120,48,81,89,86,110,49,100,114,111,113,49,70,56,84,77,115,80,81,66,75,72,51,90,83,110,100,110,116,68,88,107,118,83,53,102,80,114,89,111,88,85,75,57,43,67,57,97,103,74,113,68,76,112,112,100,48,102,101,80,122,83,111,108,113,75,90,56,114,66,70,119,87,84,104,98,57,110,119,43,79,70,51,51,65,61,61],to=[87,67,49,81,97,71,70,117,100,71,57,116,81,88,86,48,97,70,82,118,97,50,86,117],ro=[87,67,49,81,97,71,70,117,100,71,57,116,84,109,57,117,89,50,85,61];function oo(t){let e=new URL(t);return e.pathname+e.search}function rr(t,e){let r=oo(t),o=JSON.stringify(Math.floor(Date.now()/1e3)),n=r+o,i=nt(tr,se.Buffer.from(String.fromCharCode(...eo)),se.Buffer.from(n)),c=new Headers(e);return c.set(se.Buffer.from(String.fromCharCode(...to),"base64").toString(),encodeURIComponent(se.Buffer.from(i).toString("base64"))),c.set(se.Buffer.from(String.fromCharCode(...ro),"base64").toString(),o),c}var G=class extends Error{constructor(e,r){super(e),this.response=r}response},no={"Content-Type":"application/json","X-Phantom-Version":Ht,"X-Phantom-Platform":Nt},ae=async t=>{let e,r;try{r=await t.clone().blob()}catch{}try{e=await t.clone().json()}catch{}let{status:o,statusText:n}=t;return{blob:r,data:e,status:o,statusText:n}},st=class t{config;constructor(e={}){this.config={withClientAuth:!0,numRetries:0,delayBetweenEachRetryMs:0,timeoutMs:null,validateStatus:!1,headers:no,withApiEnvironment:"none",fetchBearerToken:!1,...e}}fetch=async(e,r={})=>{try{if(typeof e=="function"){let h=Q()==="https://api.phantom.app"?"prod":"staging";e=e({apiEnv:h})}let o="";this.config.withApiEnvironment==="prod"?o="https://api.phantom.app":this.config.withApiEnvironment==="staging"?o="https://staging-api.phantom.app":this.config.withApiEnvironment==="default"?o=Q():this.config.withApiEnvironment==="custom"&&this.config.customApiEnv&&(o=this.config.customApiEnv);let n=new URL(`${o}${e}`);r?.params&&(n.search=new URLSearchParams(r.params).toString());let i=r;r.headers=Ee(this.config.headers,r.headers),this.config.withClientAuth&&(r.headers=rr(n.toString(),r.headers));let c=this.config.validateStatus;if(r?.validateStatus&&(c=r?.validateStatus),i.body&&typeof i.body!="string"&&(i.body=JSON.stringify(i.body)),this.config.timeoutMs&&(i.fetchTimeout=this.config.timeoutMs),this.config.numRetries&&(i.retryDelays=Array(this.config.numRetries).fill(this.config.delayBetweenEachRetryMs)),this.config.fetchBearerToken){let h=await $t();if(h)i.headers=Ee(i.headers,{authorization:`Bearer ${h}`});else throw new G("Unable to get bearer token. Full auth is required.")}let u=await Vt(n.toString(),i);if(c&&!u.ok)throw new G(`Request failed with status code ${u.status}`,await ae(u));return u}catch(o){throw o instanceof G?o:new G(o?.message,o?.response)}};auth(e){return new t({...this.config,withClientAuth:e})}bearer(e){return typeof e=="string"&&e?this.headers({authorization:`Bearer ${e}`}):typeof e=="boolean"&&e?new t({...this.config,fetchBearerToken:!0}):this}headers(e,r){let o=r?.mergeHeaders===!1?e:Ee(this.config.headers,e);return new t({...this.config,headers:o})}timeout(e){return new t({...this.config,timeoutMs:e})}retry(e,r){return new t({...this.config,numRetries:e,delayBetweenEachRetryMs:r})}validateStatus(e){return new t({...this.config,validateStatus:e})}api(e="default",r){return new t({...this.config,withApiEnvironment:e,customApiEnv:e==="custom"?r:void 0})}async get(e,r={}){r.method="GET";let o=await this.fetch(e,r);return ae(o)}async post(e,r,o={}){o.method="POST";let n=await this.fetch(e,{...o,body:r});return ae(n)}async put(e,r,o={}){o.method="PUT";let n=await this.fetch(e,{...o,body:r});return ae(n)}async patch(e,r,o={}){o.method="PATCH";let n=await this.fetch(e,{...o,body:r});return ae(n)}async delete(e,r,o={}){o.method="DELETE";let n=await this.fetch(e,{...o,body:r});return ae(n)}},E=new st;function io(t){if(t===void 0)throw new Error("rpcUrl undefined");return async(e,r)=>{let o={jsonrpc:"2.0",id:+new Date,method:e,params:r},i=(await E.post(t,o)).data;if("error"in i)throw new Error(JSON.stringify(i.error));return i.result}}async function so(t,e={}){return E.fetch(t,e)}function at(t){return t.status>199&&t.status<400}function ao(t){return t instanceof G}var co="https://time.phantom.app/utc",uo=d.number().int().positive();async function ct(){let t;try{let e=await E.get(co);if(e.status!==200)throw new Error("Failed to fetch time from server");t=uo.parse(e.data)}catch{t=Date.now()}return Math.floor(t/1e3)}var ho=60,po=()=>Math.floor(Date.now()/1e3);async function Y(t=!0){let e={alg:"ES256",type:"JWT"},r=t?await ct():po(),o={iss:Ze,aud:et,nbf:r,exp:r+ho,iat:r};return{header:e,payload:o}}function X(t){let e=oe(ut.Buffer.from(JSON.stringify(t.header))),r=oe(ut.Buffer.from(JSON.stringify(t.payload)));return[e,r,t.signature].join(".")}s();a();var nr=d.object({alg:d.string(),type:d.string(),kid:d.string()}),ir=d.object({sub:d.string(),iss:d.string(),aud:d.string(),nbf:d.number(),exp:d.number(),iat:d.number()}),fo=d.object({header:nr,payload:ir,signature:d.string()}),sr=d.object({alg:d.string(),type:d.string()}),ar=d.object({iss:d.string(),aud:d.string(),nbf:d.number(),exp:d.number(),iat:d.number()}),lo=d.object({header:sr,payload:ar}),ht=d.object({id_token:d.string(),access_token:d.string(),refresh_token:d.string(),scope:d.string(),token_type:d.string(),expires_in:d.number().gte(0)}),go=d.object({redirectTo:d.string()}),cr=d.object({at_hash:d.string(),aud:d.array(d.string()),auth_time:d.number(),exp:d.number(),iat:d.number(),iss:d.string(),jti:d.string(),rat:d.number(),sid:d.string(),sub:d.string(),email:d.string().optional()}),Ue=d.object({authenticationKeys:d.array(d.object({createdAt:d.string().datetime().nullish().default(null),updatedAt:d.string().datetime().nullish().default(null),id:d.string().uuid(),publicKey:d.string(),userId:d.string().uuid()})).optional()});s();a();var Z=ee(_t());s();a();s();a();s();a();s();a();function Rt(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function pn(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function kr(t,...e){if(!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new TypeError(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function fn(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Rt(t.outputLen),Rt(t.blockLen)}function dn(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ln(t,e){kr(t);let r=e.outputLen;if(t.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}var gn={number:Rt,bool:pn,bytes:kr,hash:fn,exists:dn,output:ln},je=gn;s();a();s();a();var yn={node:void 0,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var Ke=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),I=(t,e)=>t<<32-e|t>>>e,mn=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!mn)throw new Error("Non little-endian hardware is not supported");var Ba=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function An(t){if(typeof t!="string")throw new TypeError(`utf8ToBytes expected string, got ${typeof t}`);return new TextEncoder().encode(t)}function kt(t){if(typeof t=="string"&&(t=An(t)),!(t instanceof Uint8Array))throw new TypeError(`Expected input type is Uint8Array (got ${typeof t})`);return t}var Me=class{clone(){return this._cloneInto()}};function Ut(t){let e=o=>t().update(kt(o)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function xn(t,e,r,o){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,r,o);let n=BigInt(32),i=BigInt(4294967295),c=Number(r>>n&i),u=Number(r&i),h=o?4:0,l=o?0:4;t.setUint32(e+h,c,o),t.setUint32(e+l,u,o)}var We=class extends Me{constructor(e,r,o,n){super(),this.blockLen=e,this.outputLen=r,this.padOffset=o,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ke(this.buffer)}update(e){je.exists(this);let{view:r,buffer:o,blockLen:n}=this;e=kt(e);let i=e.length;for(let c=0;c<i;){let u=Math.min(n-this.pos,i-c);if(u===n){let h=Ke(e);for(;n<=i-c;c+=n)this.process(h,c);continue}o.set(e.subarray(c,c+u),this.pos),this.pos+=u,c+=u,this.pos===n&&(this.process(r,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){je.exists(this),je.output(e,this),this.finished=!0;let{buffer:r,view:o,blockLen:n,isLE:i}=this,{pos:c}=this;r[c++]=128,this.buffer.subarray(c).fill(0),this.padOffset>n-c&&(this.process(o,0),c=0);for(let f=c;f<n;f++)r[f]=0;xn(o,n-8,BigInt(this.length*8),i),this.process(o,0);let u=Ke(e),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=h/4,g=this.get();if(l>g.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)u.setUint32(4*f,g[f],i)}digest(){let{buffer:e,outputLen:r}=this;this.digestInto(e);let o=e.slice(0,r);return this.destroy(),o}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:r,buffer:o,length:n,finished:i,destroyed:c,pos:u}=this;return e.length=n,e.pos=u,e.finished=i,e.destroyed=c,n%r&&e.buffer.set(o),e}};var wn=(t,e,r)=>t&e^~t&r,bn=(t,e,r)=>t&e^t&r^e&r,Tn=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),K=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),W=new Uint32Array(64),Je=class extends We{constructor(){super(64,32,8,!1),this.A=K[0]|0,this.B=K[1]|0,this.C=K[2]|0,this.D=K[3]|0,this.E=K[4]|0,this.F=K[5]|0,this.G=K[6]|0,this.H=K[7]|0}get(){let{A:e,B:r,C:o,D:n,E:i,F:c,G:u,H:h}=this;return[e,r,o,n,i,c,u,h]}set(e,r,o,n,i,c,u,h){this.A=e|0,this.B=r|0,this.C=o|0,this.D=n|0,this.E=i|0,this.F=c|0,this.G=u|0,this.H=h|0}process(e,r){for(let f=0;f<16;f++,r+=4)W[f]=e.getUint32(r,!1);for(let f=16;f<64;f++){let m=W[f-15],A=W[f-2],T=I(m,7)^I(m,18)^m>>>3,w=I(A,17)^I(A,19)^A>>>10;W[f]=w+W[f-7]+T+W[f-16]|0}let{A:o,B:n,C:i,D:c,E:u,F:h,G:l,H:g}=this;for(let f=0;f<64;f++){let m=I(u,6)^I(u,11)^I(u,25),A=g+m+wn(u,h,l)+Tn[f]+W[f]|0,w=(I(o,2)^I(o,13)^I(o,22))+bn(o,n,i)|0;g=l,l=h,h=u,u=c+A|0,c=i,i=n,n=o,o=A+w|0}o=o+this.A|0,n=n+this.B|0,i=i+this.C|0,c=c+this.D|0,u=u+this.E|0,h=h+this.F|0,l=l+this.G|0,g=g+this.H|0,this.set(o,n,i,c,u,h,l,g)}roundClean(){W.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}},It=class extends Je{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}},Ur=Ut(()=>new Je),Qa=Ut(()=>new It);var pe=ee(_t()),Ir=ee(Kr()),St={generateRandom:t=>{let e=(0,Ir.randomBytes)(t);return(0,pe.bufferToString)(e)},async deriveChallenge(t){let e=Ur((0,pe.textEncodeLite)(t));return(0,pe.urlSafe)(e)}};s();a();var k=()=>{let t=Q();return t==="https://staging-api.phantom.app"?Te.staging:t==="https://api.phantom.app"?Te.prod:p.BASE_AUTH_ENDPOINT||Te.staging},Pt=()=>`${k()}${Wt}`,ze=()=>`${k()}${Jt}`;var Sr=new Z.BasicQueryStringUtils;async function ge(t,e){let{url:r,codeVerifier:o}=await Pr(t.getClientID(),t.redirectURL,e),n=e.type==="email",i=await t.fetchAuthorizationCode(t.redirectURL,r,n);return await Lt({grantType:"authorization_code",clientID:t.getClientID(),redirectURI:t.redirectURL,tokenEndpoint:ze(),code:i,codeVerifier:o})}async function Pr(t,e,r){let o=Pt(),n,i=["openid","offline_access","user","incognito","seedless"],c;switch(r.type){case"key":{n={type:"key",jwt:X(r.clientJWT)};break}case"email":{n={type:"email",provider:r.provider,existingAccessToken:r.existingAccessToken},c=r.prompt,i.push("email");break}case"session":{n={type:"session",existingAccessToken:r.existingAccessToken};break}}let h=await new Z.AuthorizationRequest({client_id:t,redirect_uri:e,scope:i.join(" "),response_type:"code"},St).toJson(),l;switch(n.type){case"key":l=`jwt:${oe(Buffer.from(n.jwt,"utf8"))}`;break;case"email":l=`sso:${n.provider}`,n.existingAccessToken&&(l=`${l}:${n.existingAccessToken}`);break;case"session":l=`session:${n.existingAccessToken}`;break}let g={redirect_uri:h.redirect_uri,client_id:h.client_id,response_type:h.response_type,state:h.state??"",scope:h.scope,login_hint:l};c&&(g.prompt=c);let f=h.extras?.code_challenge,m=h.extras?.code_challenge_method,A=h.internal?.code_verifier;if(f&&m&&(g.code_challenge=f,g.code_challenge_method=m),!f||!m||!A)throw new Error("Missing code challenge or code verifier for PKCE.");let T=Sr.stringify(g);return{url:`${o}?${T}`,codeVerifier:A}}async function Lt(t){let{grantType:e,tokenEndpoint:r,clientID:o,redirectURI:n}=t,i;e==="authorization_code"?i=new Z.TokenRequest({client_id:o,redirect_uri:n,grant_type:e,code:t.code,extras:{code_verifier:t.codeVerifier}}):i=new Z.TokenRequest({client_id:o,redirect_uri:n,grant_type:e,refresh_token:t.refreshToken});let c=await E.headers({"Content-Type":"application/x-www-form-urlencoded"},{mergeHeaders:!1}).auth(Dt()).post(r,Sr.stringify(i.toStringMap()));En(c,e);let u=ht.safeParse(c.data);if(!u.success)throw new Error("Invalid OAuth2Token response.");let{data:h}=u;return{idToken:h.id_token,accessToken:h.access_token,refreshToken:h.refresh_token,scope:h.scope,tokenType:h.token_type,expiresAt:Date.now()+h.expires_in*1e3}}async function $e(t,e){return await Lt({clientID:t.getClientID(),redirectURI:t.redirectURL,grantType:"refresh_token",tokenEndpoint:ze(),refreshToken:e})}function En(t,e){if([401,400].includes(t.status)){let r="";if(t.status===401)switch(r="Token Request Unauthorized (401): ",e){case"authorization_code":r+="Authorization code is expired or invalid.";break;case"refresh_token":r+="Refresh token is expired or invalid.";break;default:r+=`Unknown grant type [${e}]. `}if(t.status===400)switch(r="Bad Token Request (400): ",e){case"authorization_code":r="for [authorization_code]. Possible causes: 1. The authorization code is expired or invalid. 2. Redirect URI mismatch. 3. Code verifier mismatch (if using PKCE).";break;case"refresh_token":r="for [refresh_token]. Possible causes: 1. The refresh token is expired, invalid, or revoked. 2. Client ID mismatch. 3. Missing or malformed refresh token in the request.";break;default:r=`for unknown grant type [${e}]. Check the payload and OAuth provider documentation.`}throw new Error(r)}}s();a();s();a();s();a();var ye=class{subscribers={};subscribe(e,r){return this.subscribers[e]||(this.subscribers[e]=[]),this.subscribers[e].push(r),()=>{this.subscribers[e].splice(this.subscribers[e].indexOf(r),1)}}emitEvent(e,...r){(this.subscribers[e]??[]).forEach(n=>n(...r))}};var Qe=class extends ye{emit(e){e&&(this.emitEvent("user",e),this.emitEvent("userID",e.userID),this.emitEvent("accessToken",e.accessToken),e.email&&this.emitEvent("email",e.email))}emitLoggedOut(){this.emitEvent("loggedOut")}};s();a();s();a();function O(t,e="expected value not found"){if(t==null)throw new Error(e);return t}function Lr(t,e="expected value not found"){if(!t)throw new Error(e)}var Ve=async(t,e)=>{let r=k(),o=O(t.signer,"Signer is required for key-based auth.");try{let n=await o.getAuthenticationPublicKey(e),i=await Y(t.isServerTimeEnabled()),c=await o.sign(i,e),{data:u}=await E.get(`${r}${V}`,{params:{token:X(c)}}),h=Ue.safeParse(u);return h.success?(h.data.authenticationKeys??[]).some(f=>f.publicKey===n):!1}catch{return!1}};s();a();s();a();var Or="@phantom/auth",q={user:["auth",`${Or}:user`],authFactors:["auth",`${Or}:user-auth-factors`]};s();a();s();a();var Cr=async t=>{try{let e=await E.headers({"Content-Type":"application/x-www-form-urlencoded"},{mergeHeaders:!1}).bearer(t).get(`${k()}/userinfo`);return at(e)}catch{return!1}};s();a();var Ot=".phantom.auth",F=`${Ot}.tokens`,qr=`${Ot}.authentication-factors`,_n=`${Ot}.email-provider`;s();a();s();a();var Fr=t=>Buffer.from(t.replace("-","+").replace("_","/").replace(/=+$/,""),"base64");var me=t=>{let e=t.idToken.split(".");if(e.length!==3)throw new Error("Malformed ID token. Expected 3 period-delimited parts to ID token.");let r;try{let o=Fr(e[1]).toString("utf-8"),n=JSON.parse(o);r=cr.parse(n)}catch{throw new Error("Unable to parse ID token payload.")}return{accessToken:t.accessToken,userID:r.sub,email:r.email}};var J=(t,e)=>{let r=async()=>{let{storage:o,authConfig:n}=t,i=await o.get(F);if(!i)return null;if(await Cr(i.accessToken))return me(i);if(i.refreshToken)try{let c=await $e(n,i.refreshToken);return await o.set(F,c),me(c)}catch(c){let u=c.message;return u.includes("400")?Mt.write(`Failed to refresh access token: ${u}`,"Auth","error"):(v.addBreadcrumb(`Failed to refresh access token: ${u}`,"Auth","error"),v.captureError(c,"Auth")),null}return null};return t.runExclusive(async()=>{let o=await r();return e.emit(o),o})};s();a();var Ye=async(t,e,r)=>{let{storage:o,authConfig:n}=t,i,{type:c}=r;switch(c){case"key":{let h=await Rn(t,r),l=O(t.signer,"Signer is required for key-based auth."),g=await Y(t.isServerTimeEnabled()),f=await l.sign(g,h);i=await ge(n,{type:c,clientJWT:f});break}case"email":{i=await ge(n,{type:c,prompt:r.prompt,provider:r.provider});break}case"session":{i=await ge(n,{type:c,existingAccessToken:r.accessToken});break}}await o.set(F,i);let u=me(i);return e.emit(u),u},Rn=async(t,e)=>{if(e.secretIdentifier)return e.secretIdentifier;let r=await O(t.signer).getAllSecretIdentifiers();for(let o of r)if(await Ve(t,o))return o;throw new Error("Unable to log in with key-based auth. No auth factor found for login.")};var kn=zt,Un=fe({minutes:5}),In=async(t,e)=>{let r=await J(t,e);if(r)return r;if((await O(t.signer,"Signer is required for key-based auth.").getAllSecretIdentifiers()).length===0)throw new Error("Unable to log in with key-based auth. Vault is not yet onboarded.");try{return await Ye(t,e,{type:"key"})}catch(i){throw v.captureError(i instanceof Error?i:new Error("Unknown error"),"Auth"),new Error("Unable to automatically log in with key-based auth.")}},Br=(t,e)=>({queryKey:q.user,queryFn:()=>In(t,e),gcTime:kn,staleTime:Un}),Dr=async(t,e)=>{let r=Br(t,e);return await t.queryClient.fetchQuery(r)},Hr=(t,e)=>{let r=Br(t,e);return te({...r,retryOnMount:!1})};var Sn=t=>{let e=new Qe,r={getUser:()=>J(t,e),autoLogIn:()=>Dr(t,e),useUser:()=>Hr(t,e),refreshTokens:()=>Pn(t,e),logIn:o=>Ye(t,e,o),isExistingAuthFactor:o=>Ve(t,o),getAuthenticationKeys:()=>Ln(t,e),getLocalAuthenticationPublicKeys:()=>On(t),addAuthFactor:o=>Cn(t,e,o),deleteAuthFactor:o=>qn(t,e,o),deleteAllAuthFactors:()=>Fn(t,e),subscribe:(o,n)=>e.subscribe(o,n),logOut:()=>Bn(t,e)};return rt(async()=>(await r.autoLogIn())?.accessToken??null),r},Pn=async(t,e)=>{let r=await t.storage.get(F);if(!r)throw new Error("No auth tokens found.");let o=await $e(t.authConfig,r.refreshToken);return await t.storage.set(F,o),!0},Ln=async(t,e)=>({authenticationPublicKeys:(await Nr(t,e)).map(o=>o.publicKey)}),Nr=async(t,e)=>{let r=k(),o=await J(t,e);if(!o)throw new Error("User not authenticated.");let{data:n}=await E.bearer(o.accessToken).get(`${r}${V}`),i=Ue.safeParse(n);if(!i.success)throw new Error("Unable to parse auth factors response.");return i.data.authenticationKeys??[]},On=async t=>{try{let e=O(t.signer,"Signer is required for key-based auth."),r=await e.getAllSecretIdentifiers(),o={};for(let n of r)o[n]=await e.getAuthenticationPublicKey(n);return o}catch{return{}}},Cn=async(t,e,{secretIdentifier:r})=>{let o=k(),n=O(t.signer,"Signer is required for key-based auth."),i=await J(t,e);if(!i)throw new Error("User not authenticated.");let c=await Y(t.isServerTimeEnabled()),u=await n.sign(c,r);await E.bearer(i.accessToken).post(`${o}${V}`,{jwt:X(u)})},qn=async(t,e,{authenticationPublicKey:r})=>{let o=k(),n=await J(t,e);if(!n)throw new Error("User not authenticated.");await E.bearer(n.accessToken).delete(`${o}${V}/${encodeURIComponent(r)}`)},Fn=async(t,e)=>{let r=k(),o=t.storage,n=await J(t,e);if(!n)throw new Error("User not authenticated.");let i=await Nr(t,e);await Promise.all(i.map(c=>E.bearer(n.accessToken).delete(`${r}${V}/${c.id}`))),await o.remove(qr)},Bn=async({storage:t},e)=>{await t.remove(F),e.emitLoggedOut()};s();a();var Dn=(t,e)=>{let r=new URL(e);if(!r.toString().startsWith(t))throw new Error("Unexpected redirectURL. RedirectURL from auth flow must match local redirect URL.");let o=r.searchParams.get("code");if(!o)throw new Error("No authorization code");return o};s();a();var Hn=(t,e)=>{let r=new URL(e);if(!r.toString().startsWith(t))throw new Error("Unexpected redirectURL. RedirectURL from auth flow must match local redirect URL.");let o=r.searchParams.get("error"),n=r.searchParams.get("error_description");if(o)throw new Error(`${o}: ${n}`,{cause:o});return!1};s();a();var Nn=()=>Q()==="https://api.phantom.app"?be.prod:be.staging;s();a();var jn=()=>{let t=B(),{data:e}=S(),r=q.authFactors;return te({queryKey:r,queryFn:async()=>{let n=await t.getLocalAuthenticationPublicKeys();if(Object.keys(n).length===0)return{};let i=[];try{if(e){let{authenticationPublicKeys:u=[]}=await t.getAuthenticationKeys();i=u}}catch(u){u instanceof Error&&v.addBreadcrumb("Auth",`Unable to fetch existing AuthFactors for user (${e?.userID}): ${u.message}`,"error")}let c={};for(let[u,h]of Object.entries(n)){let l=i.includes(h);!l&&await t.isExistingAuthFactor(u)||(c[u]={authenticationPublicKey:h,isExistingAuthFactor:l})}return Object.keys(c).length===0&&v.addBreadcrumb("Auth",`Unable to build AuthFactors map: 
- user: ${e?.userID}
- locally available auth factors: ${Object.keys(n).length}
- auth factors registered with user: ${i.length}`,"error"),c},retryOnMount:!1})};s();a();s();a();var qt=()=>{let{data:t}=S();return!!t};function Mn(t,e){let r=qt(),o;return t.enabled===void 0?o=r:typeof t.enabled=="function"?o=n=>(Lr(typeof t.enabled=="function","expected enabled to be a function"),r&&t.enabled(n)):typeof t.enabled=="boolean"?o=r&&t.enabled:jt(t.enabled),te({...t,enabled:o},e)}s();a();s();a();var Kn=async t=>{await t.removeQueries({queryKey:q.user})},Wn=async t=>{await t.resetQueries({queryKey:q.user})},Jn=async t=>{await t.invalidateQueries({queryKey:q.user})},Ae=async t=>{await t.invalidateQueries({queryKey:q.authFactors})};var zn=()=>{let t=xe(),e=B(),r=async({secretIdentifier:o})=>{await e.addAuthFactor({secretIdentifier:o}),await Ae(t)};return we({mutationFn:async o=>{try{return await r(o)}catch(n){v.addBreadcrumb("Auth",`Could not add auth factor: ${o.secretIdentifier}`,"error");let i;throw n instanceof Error?i=n:i=new Error(`Could not add auth factor: ${o.secretIdentifier}`),v.captureError(i,"Auth"),i}}})};s();a();var $n=()=>{let t=xe(),e=B(),r=async({authenticationPublicKey:o})=>{await e.deleteAuthFactor({authenticationPublicKey:o}),await Ae(t)};return we({mutationFn:async o=>{try{return await r(o)}catch(n){v.addBreadcrumb("Auth","Could not remove auth factor!","error");let i;throw n instanceof Error?i=n:i=new Error("Could not remove auth factor!"),v.captureError(i,"Auth"),i}}})};s();a();var Qn=()=>{let{data:t}=S();return t?.accessToken};s();a();s();a();var Vn=()=>{let{data:t}=S();return t?.email};export{Ri as a,er as b,Ui as c,nt as d,ke as e,tr as f,E as g,io as h,so as i,at as j,ao as k,Ze as l,et as m,Jr as n,oe as o,fo as p,lo as q,k as r,ye as s,_n as t,Sn as u,Dn as v,Hn as w,Wr as x,B as y,S as z,Nn as A,jn as B,qt as C,Mn as D,Kn as E,Wn as F,Jn as G,Ae as H,zn as I,$n as J,Qn as K,Vn as L};
/*! Bundled license information:

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)

@noble/hashes/esm/utils.js:
  (*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) *)
*/
//# sourceMappingURL=chunk-E2H5RB2U.js.map
