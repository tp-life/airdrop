import{Cb as Zt,Gc as ee,Ma as Gt,ib as Jt,mb as H,qb as Yt,rb as Ht,sb as Qt,tb as $t,vb as At,vd as oe,wb as Xt}from"./chunk-EIQDOUTB.js";import{d as te}from"./chunk-3IV4Y5QP.js";import{$a as bt,J as V,K as J,L as u,Ya as M,Zd as jt,_a as Ut,c as Ue,r as Rt,yc as Bt}from"./chunk-D7Z6MPRS.js";import{j as zt}from"./chunk-27TD4NX4.js";import{D as gt,h as rt,u as Wt,w as Ft,z as at}from"./chunk-FBDT5S2M.js";import{W as qt,a as Mt,b as kt,w as Y}from"./chunk-TKSJVOQZ.js";import{a as Be,c as ft,d as Q,e as B,f as Dt,g as Ct,h as y}from"./chunk-UA6ADLWZ.js";import{c as Fe,f as U,h as s,l as qe,m as Buffer,n as c}from"./chunk-3KENBVE7.js";var Pe=Fe(l=>{"use strict";s();c();var _o=l&&l.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(l,"__esModule",{value:!0});l.map=l.array=l.rustEnum=l.str=l.vecU8=l.tagged=l.vec=l.bool=l.option=l.publicKey=l.i256=l.u256=l.i128=l.u128=l.i64=l.u64=l.struct=l.f64=l.f32=l.i32=l.u32=l.i16=l.u16=l.i8=l.u8=void 0;var w=Jt(),Ko=Rt(),No=_o(rt()),F=Jt();Object.defineProperty(l,"u8",{enumerable:!0,get:function(){return F.u8}});Object.defineProperty(l,"i8",{enumerable:!0,get:function(){return F.s8}});Object.defineProperty(l,"u16",{enumerable:!0,get:function(){return F.u16}});Object.defineProperty(l,"i16",{enumerable:!0,get:function(){return F.s16}});Object.defineProperty(l,"u32",{enumerable:!0,get:function(){return F.u32}});Object.defineProperty(l,"i32",{enumerable:!0,get:function(){return F.s32}});Object.defineProperty(l,"f32",{enumerable:!0,get:function(){return F.f32}});Object.defineProperty(l,"f64",{enumerable:!0,get:function(){return F.f64}});Object.defineProperty(l,"struct",{enumerable:!0,get:function(){return F.struct}});var z=class extends w.Layout{constructor(e,o,r){super(e,r),this.blob=(0,w.blob)(e),this.signed=o}decode(e,o=0){let r=new No.default(this.blob.decode(e,o),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(e,o,r=0){return this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),o,r)}};function he(t){return new z(8,!1,t)}l.u64=he;function Vo(t){return new z(8,!0,t)}l.i64=Vo;function Oo(t){return new z(16,!1,t)}l.u128=Oo;function Ro(t){return new z(16,!0,t)}l.i128=Ro;function Do(t){return new z(32,!1,t)}l.u256=Do;function Co(t){return new z(32,!0,t)}l.i256=Co;var W=class extends w.Layout{constructor(e,o,r,a){super(e.span,a),this.layout=e,this.decoder=o,this.encoder=r}decode(e,o){return this.decoder(this.layout.decode(e,o))}encode(e,o,r){return this.layout.encode(this.encoder(e),o,r)}getSpan(e,o){return this.layout.getSpan(e,o)}};function Mo(t){return new W((0,w.blob)(32),e=>new Ko.PublicKey(e),e=>e.toBuffer(),t)}l.publicKey=Mo;var Kt=class extends w.Layout{constructor(e,o){super(-1,o),this.layout=e,this.discriminator=(0,w.u8)()}encode(e,o,r=0){return e==null?this.discriminator.encode(0,o,r):(this.discriminator.encode(1,o,r),this.layout.encode(e,o,r+1)+1)}decode(e,o=0){let r=this.discriminator.decode(e,o);if(r===0)return null;if(r===1)return this.layout.decode(e,o+1);throw new Error("Invalid option "+this.property)}getSpan(e,o=0){let r=this.discriminator.decode(e,o);if(r===0)return 1;if(r===1)return this.layout.getSpan(e,o+1)+1;throw new Error("Invalid option "+this.property)}};function Wo(t,e){return new Kt(t,e)}l.option=Wo;function Fo(t){return new W((0,w.u8)(),qo,Uo,t)}l.bool=Fo;function qo(t){if(t===0)return!1;if(t===1)return!0;throw new Error("Invalid bool: "+t)}function Uo(t){return t?1:0}function Bo(t,e){let o=(0,w.u32)("length"),r=(0,w.struct)([o,(0,w.seq)(t,(0,w.offset)(o,-o.span),"values")]);return new W(r,({values:a})=>a,a=>({values:a}),e)}l.vec=Bo;function zo(t,e,o){let r=(0,w.struct)([he("tag"),e.replicate("data")]);function a({tag:i,data:m}){if(!i.eq(t))throw new Error("Invalid tag, expected: "+t.toString("hex")+", got: "+i.toString("hex"));return m}return new W(r,a,i=>({tag:t,data:i}),o)}l.tagged=zo;function we(t){let e=(0,w.u32)("length"),o=(0,w.struct)([e,(0,w.blob)((0,w.offset)(e,-e.span),"data")]);return new W(o,({data:r})=>r,r=>({data:r}),t)}l.vecU8=we;function jo(t){return new W(we(),e=>e.toString("utf-8"),e=>Buffer.from(e,"utf-8"),t)}l.str=jo;function Go(t,e,o){let r=(0,w.union)(o??(0,w.u8)(),e);return t.forEach((a,i)=>r.addVariant(i,a,a.property)),r}l.rustEnum=Go;function Jo(t,e,o){let r=(0,w.struct)([(0,w.seq)(t,e,"values")]);return new W(r,({values:a})=>a,a=>({values:a}),o)}l.array=Jo;var Nt=class extends w.Layout{constructor(e,o,r){super(e.span+o.span,r),this.keyLayout=e,this.valueLayout=o}decode(e,o){o=o||0;let r=this.keyLayout.decode(e,o),a=this.valueLayout.decode(e,o+this.keyLayout.getSpan(e,o));return[r,a]}encode(e,o,r){r=r||0;let a=this.keyLayout.encode(e[0],o,r),i=this.valueLayout.encode(e[1],o,r+a);return a+i}getSpan(e,o){return this.keyLayout.getSpan(e,o)+this.valueLayout.getSpan(e,o)}};function Yo(t,e,o){let r=(0,w.u32)("length"),a=(0,w.struct)([r,(0,w.seq)(new Nt(t,e),(0,w.offset)(r,-r.span),"values")]);return new W(a,({values:i})=>new Map(i),i=>({values:Array.from(i.entries())}),o)}l.map=Yo});s();c();s();c();var nt=U(Ue(),1);var ae=U(Rt(),1);var re=(0,nt.struct)([(0,nt.u8)("instruction"),Yt("amount")]);function ne(t,e,o,r,a=[],i=H){let m=$t([{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:e,isSigner:!1,isWritable:!1}],o,a),p=Buffer.alloc(re.span);return re.encode({instruction:Ht.Approve,amount:BigInt(r)},p),new ae.TransactionInstruction({keys:m,programId:i,data:p})}var ie=new u.PublicKey("Config1111111111111111111111111111111111111"),ze={location:0,distance:50,threshold:.2,shouldSort:!0,keys:[{name:"info.name",weight:.5},{name:"info.keybaseUsername",weight:.3},{name:"info.website",weight:.1},{name:"voteAccountPubkey",weight:.1},{name:"identityPubkey",weight:.1}]},je="https://docs.solana.com/staking",Ge="https://docs.solana.com/implemented-proposals/staking-rewards",Je={type:"SolanaNative",data:{amount:"0",balance:new Mt(0),chain:{id:M.solana.mainnetID,imageUrl:M.solana.iconUrl,name:M.solana.name,symbol:M.solana.tokenSymbol},decimals:9,key:"SolanaNative",logoUri:"https://cdn.jsdelivr.net/gh/solana-labs/token-list@main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png",name:"Solana",symbol:"SOL",tokenAddress:void 0,walletAddress:"",spamStatus:"NOT_VERIFIED"}},br=new Map([[Ut.Solana.Mainnet,Je]]),Ye="https://www.jito.network/blog/lsts-vs-native-assets/",He="https://www.jito.network/staking/?mode=unstake",Qe="https://help.phantom.com/hc/en-us/articles/29846774040467",$e="https://www.jito.network/blog/reward-bearing-vs-rebasing-solana-liquid-staking-tokens/",Xe="https://www.jito.network/interceptor",Ze="solana:101/address:J1toso1uCk3RLmjorhTtrVwY9HJ7X8V9yYac6Y7kGCPn",Ar=5,hr=3e4;s();c();function se(t,e){let o=new kt(t/100),r=new kt(e/100);return o.minus(o.times(r)).times(100).decimalPlaces(2).toNumber()}s();c();s();c();s();c();var I="staking";var ht=[I,"stakeAccounts"],wt=[I,"stakeActivationData"],Pt=[I,"convertStakeAccountList"],vt=[I,"convertStakeTransaction"],to=[I,"mintTokenTransaction"],Tt="averageValidatorApy",eo="recommendedValidators",oo="signatureStatus",ro="stakeAccountMinBalance",ao="stakeRewardsHistory",no="stakeApy",io="validatorInfo",so="voteAccounts",co="keybaseUserAvatar",it={keybaseUserAvatar(t){return[I,co,t]},signatureStatus(t){return[I,oo,t]},stakeAccounts(t,e){return[...ht,t,e]},stakeAccountMinBalance(){return[I,ro]},stakeActivationData(t){return[...wt,t]},stakeRewardsHistory(t){return[I,ao,t]},stakeApy(){return[I,no]},averageValidatorApy(){return[I,Tt]},recommendedValidators(){return[I,eo]},validatorInfo(){return[I,io]},voteAccounts(t){return[I,so,t]},convertStakeAccountList(t,e){return[...Pt,t,e]},liquidStakingSupportedTokens(){return[I,"liquidStakingSupportedTokens"]},getConvertStakeTransaction(t){return[...vt,t]},getMintTokenTransaction(t){return[...to,t]},featureUsed(){return[I,"featureUsed"]}};var st=t=>()=>{t.invalidateQueries({predicate:e=>{let o=r=>r.every((a,i)=>e.queryKey[i]===a);return o(ht)||o(wt)||o(Pt)||o(vt)}})};s();c();var ce=t=>(e,o)=>{let r=t.indexOf(e.voteAccountPubkey),a=t.indexOf(o.voteAccountPubkey);return(r>-1?r:1/0)-(a>-1?a:1/0)};s();c();function ue(t,e=9){return t.match(new RegExp(`^\\d*(\\.\\d{0,${e}})?$`))}s();c();var le={type:"fungible",isNativeOfType:"sol",chain:"solana",name:"Solana",symbol:"SOL",iconUrl:"https://cdn.jsdelivr.net/gh/solana-labs/token-list@main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png",decimals:9},lo="stake",de=t=>new xt(t,lo),xt=class extends te{createStakeAccountAndDelegateStake=e=>{this.analytics.capture("createStakeAccountAndDelegateStake",{data:{...e,...le}})};deactivateStake=()=>{this.analytics.capture("deactivateStake",{data:{...le}})}};var It=qt(Bt,t=>de(t));s();c();var ct=U(Be());s();c();var me=(t,e)=>t+e[1];function ye(t){let e=po(t),o={commissionWeight:.6,epochCreditsWeight:.1,activatedStakeWeight:.3},r=yo(e.maxEpochCredits,e.maxActivatedStake,o);return t.sort(r)}function po(t){let e={maxEpochCredits:0,maxActivatedStake:0};for(let o of t){let r=o.epochCredits.reduce(me,0);e.maxEpochCredits<r&&(e.maxEpochCredits=r),e.maxActivatedStake<o.activatedStake&&(e.maxActivatedStake=o.activatedStake)}return e}function mo(t,e,o,r,a){let i=(100-t)/100,m=e/o,p=Math.log10(r+1)/Math.log10(a+1);return{normalizedCommission:i,normalizedEpochCredits:m,normalizedActivatedStake:p}}function pe(t,e,o,r){let{commission:a,epochCredits:i,activatedStake:m}=t,{commissionWeight:p,epochCreditsWeight:A,activatedStakeWeight:S}=r,{normalizedCommission:d,normalizedEpochCredits:h,normalizedActivatedStake:b}=mo(a,i.reduce(me,0),e,m,o);return(a>10?.5:1)*(p*d+A*h+S*b)}function yo(t,e,o){return(r,a)=>{let i=pe(r,t,e,o);return pe(a,t,e,o)-i}}s();c();s();c();var So=(a=>(a[a.Always=1/0]="Always",a[a.Short=Y({days:1})]="Short",a[a.Medium=Y({days:3})]="Medium",a[a.Long=Y({days:7})]="Long",a))(So||{}),Lt=(i=>(i[i.Immediate=0]="Immediate",i[i.Short=Y({minutes:1})]="Short",i[i.Medium=Y({minutes:2.5})]="Medium",i[i.Long=Y({minutes:5})]="Long",i[i.Never=1/0]="Never",i))(Lt||{});var fo=t=>async()=>(await t.getParsedProgramAccounts(ie)).reduce((o,r)=>{if(r.account.data.parsed?.type!=="validatorInfo")return o;let a=r.pubkey.toString(),i=r.account.data.parsed.info.keys,[,m]=i;if(!m.signer)return o;let p=m.pubkey,A=r.account.data.parsed.info.configData;return o.push({identityPubkey:p,infoPubkey:a,info:A}),o},[]);function Se(t){let e=it.validatorInfo(),o=fo(t);return at({queryKey:e,queryFn:o,placeholderData:[],staleTime:1/0})}s();c();var ko=async t=>{let e=await t.getVoteAccounts();return[...e.current,...e.delinquent].map(o=>({identityPubkey:o.nodePubkey,voteAccountPubkey:o.votePubkey,commission:o.commission,lastVote:o.lastVote,epochCredits:o.epochCredits,activatedStake:o.activatedStake})).filter(o=>o.commission<99)};function fe(t){let e=it.voteAccounts(t.rpcEndpoint);return at({queryKey:e,queryFn:async()=>ko(t),placeholderData:[],staleTime:1/0})}function go(t){let{isFetched:e,isFetching:o,isPending:r,isSuccess:a,isError:i,dataUpdatedAt:m,errorUpdatedAt:p,error:A,refetch:S,data:d}=fe(t),h=Math.max(m,p),{isFetched:b,isFetching:T,isPending:f,isSuccess:P,isError:x,dataUpdatedAt:v,errorUpdatedAt:L,error:E,refetch:_,data:N}=Se(t),g=Math.max(v,L),O=Math.max(h,g),q=e&&b,D=o||T,C=a||P,et=i||x,ot=A||E,Ve=r||f,Oe=(0,ct.useCallback)(async()=>{Promise.all([S(),_()])},[_,S]);return{results:(0,ct.useMemo)(()=>{if(!d)return[];if(!N)return[];let Re=ye(d),De=new Map(Re.map(G=>[G.identityPubkey,G])),Ce=new Map(N.map(G=>[G.identityPubkey,G])),Ot=[];for(let[G,Me]of De){let We=Ce.get(G);Ot.push({...Me,...We})}return Ot},[N,d]),dataUpdatedAt:O,error:ot,isSuccess:C,isError:et,isFetched:q,isFetching:D,isPending:Ve,refetch:Oe}}s();c();function Et(t){let e=!!t?.info.meta.lockup,o=new Date((t?.info.meta.lockup?.unixTimestamp??0)*1e3);return e&&o.getTime()>Date.now()}s();c();s();c();var bo=y.object({apy:y.number()}),Ao=y.object({validators:y.array(y.string())}),ke=y.object({epoch:y.number(),effectiveSlot:y.number(),amount:y.number(),postBalance:y.number(),percentChange:y.number(),apr:y.number(),timestamp:y.number()}),ho=y.object({items:y.array(ke)}),wo=y.object({address:y.string(),chainId:bt,decimals:y.number(),logoURI:y.string(),name:y.string(),symbol:y.string()}),Po=y.object({caip19:y.string(),metadata:wo}),vo=y.object({vote_account:y.string()}),To=y.object({apy:y.string(),chainId:bt,convertRatio:y.string(),name:y.string(),stakePoolAddress:y.string(),stakePoolTokenMetadata:Po,validators:y.array(vo)}),Va=y.record(y.string(),y.array(To));s();c();s();c();var ge={transactionData:void 0,fungibleToStake:void 0,provider:void 0,convert:{validatorVote:"",stakeAccount:"",validatorName:"",eligibleAccountsCount:0},amount:"",navigateTo:null,skipDismissRouting:void 0},be=jt(t=>({...ge,resetStaking:()=>t(ge),setTransactionData:e=>t({transactionData:e}),setFungibleToStake:e=>t({fungibleToStake:e}),setProvider:e=>t({provider:e}),setConvertStakeAccount:e=>t({convert:e}),setAmount:e=>t({amount:e}),setNavigateTo:e=>t({navigateTo:e}),setSkipDismissRouting:e=>t({skipDismissRouting:e})}));s();c();var xo=["liquidStakingSupportedTokens","featureUsed",Tt],Io=t=>{let e=String(t.queryKey[1]);return xo.includes(e)};s();c();var Eo=(t,e)=>{if(t.type==="initialized")return!1;let o=t?.info?.stake?.delegation?.voter??"",r=Et(t);return t.activationState==="active"&&e.has(o)&&!r};s();c();s();c();var tt=U(rt());s();c();var _t=U(qe());var on=new u.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s");var K=new u.PublicKey("SPoo1Ku8WFXoNDMHPsrGSTSG1Y47rzgn41SLUNakuHy");var rn=_t.Buffer.from("ephemeral"),Ae=_t.Buffer.from("transient"),$=u.LAMPORTS_PER_SOL;s();c();var ut=Object.freeze({DepositStake:{index:9,layout:V.struct([V.u8("instruction")])},DepositSol:{index:14,layout:V.struct([V.u8("instruction"),V.ns64("lamports")])},WithdrawStake:{index:10,layout:V.struct([V.u8("instruction"),V.ns64("poolTokens")])},WithdrawSol:{index:16,layout:V.struct([V.u8("instruction"),V.ns64("poolTokens")])}});function lt(t,e){let o=t.layout.span,r=Buffer.alloc(o),a=Object.assign({instruction:t.index},e);return t.layout.encode(a,r),r}var X=class{static depositStake(e){let{stakePool:o,validatorList:r,depositAuthority:a,withdrawAuthority:i,depositStake:m,validatorStake:p,reserveStake:A,destinationPoolAccount:S,managerFeeAccount:d,referralPoolAccount:h,poolMint:b,referralAccount:T}=e,f=ut.DepositStake,P=lt(f),x=[{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:A,isSigner:!1,isWritable:!0},{pubkey:S,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:h,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:u.SYSVAR_CLOCK_PUBKEY,isSigner:!1,isWritable:!1},{pubkey:u.SYSVAR_STAKE_HISTORY_PUBKEY,isSigner:!1,isWritable:!1},{pubkey:H,isSigner:!1,isWritable:!1},{pubkey:u.StakeProgram.programId,isSigner:!1,isWritable:!1}];return T&&x.push({pubkey:T,isSigner:!1,isWritable:!1}),new J.TransactionInstruction({programId:K,keys:x,data:P})}static depositSol(e){let{stakePool:o,withdrawAuthority:r,depositAuthority:a,reserveStake:i,fundingAccount:m,destinationPoolAccount:p,managerFeeAccount:A,referralPoolAccount:S,poolMint:d,lamports:h,referralAccount:b}=e,T=ut.DepositSol,f=lt(T,{lamports:h}),P=[{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!0,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:A,isSigner:!1,isWritable:!0},{pubkey:S,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:H,isSigner:!1,isWritable:!1}];return a&&P.push({pubkey:a,isSigner:!0,isWritable:!1}),b&&P.push({pubkey:b,isSigner:!1,isWritable:!1}),new J.TransactionInstruction({programId:K,keys:P,data:f})}static withdrawStake(e){let{stakePool:o,validatorList:r,withdrawAuthority:a,validatorStake:i,destinationStake:m,destinationStakeAuthority:p,sourceTransferAuthority:A,sourcePoolAccount:S,managerFeeAccount:d,poolMint:h,poolTokens:b}=e,T=ut.WithdrawStake,f=lt(T,{poolTokens:b}),P=[{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!0,isWritable:!1},{pubkey:S,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:h,isSigner:!1,isWritable:!0},{pubkey:u.SYSVAR_CLOCK_PUBKEY,isSigner:!1,isWritable:!1},{pubkey:H,isSigner:!1,isWritable:!1},{pubkey:u.StakeProgram.programId,isSigner:!1,isWritable:!1}];return new J.TransactionInstruction({programId:K,keys:P,data:f})}static withdrawSol(e){let{stakePool:o,withdrawAuthority:r,sourceTransferAuthority:a,sourcePoolAccount:i,reserveStake:m,destinationSystemAccount:p,managerFeeAccount:A,solWithdrawAuthority:S,poolMint:d,poolTokens:h}=e,b=ut.WithdrawSol,T=lt(b,{poolTokens:h}),f=[{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:A,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u.SYSVAR_CLOCK_PUBKEY,isSigner:!1,isWritable:!1},{pubkey:u.SYSVAR_STAKE_HISTORY_PUBKEY,isSigner:!1,isWritable:!1},{pubkey:u.StakeProgram.programId,isSigner:!1,isWritable:!1},{pubkey:H,isSigner:!1,isWritable:!1}];return S&&f.push({pubkey:S,isSigner:!0,isWritable:!1}),new J.TransactionInstruction({programId:K,keys:f,data:T})}};s();c();var n=U(Pe());var ve=U(rt());var j=[(0,n.u64)("denominator"),(0,n.u64)("numerator")];var dt=ft().transform(t=>new ve.default(t,10)),pt=ft().transform(t=>new u.PublicKey(t)),Ho=Dt(["uninitialized","initialized","delegated","rewardsPool"]),Qo=B({rentExemptReserve:dt,authorized:B({staker:pt,withdrawer:pt}),lockup:B({unixTimestamp:Q(),epoch:Q(),custodian:pt})}),$o=B({meta:Qo,stake:B({delegation:B({voter:pt,stake:dt,activationEpoch:dt,deactivationEpoch:dt,warmupCooldownRate:Q()}),creditsObserved:Q()}).nullish().default(null)}),Te=B({type:Ho,info:Ct($o)}),xe=(0,n.struct)([(0,n.u8)("accountType"),(0,n.publicKey)("manager"),(0,n.publicKey)("staker"),(0,n.publicKey)("stakeDepositAuthority"),(0,n.u8)("stakeWithdrawBumpSeed"),(0,n.publicKey)("validatorList"),(0,n.publicKey)("reserveStake"),(0,n.publicKey)("poolMint"),(0,n.publicKey)("managerFeeAccount"),(0,n.publicKey)("tokenProgramId"),(0,n.u64)("totalLamports"),(0,n.u64)("poolTokenSupply"),(0,n.u64)("lastUpdateEpoch"),(0,n.struct)([(0,n.u64)("unixTimestamp"),(0,n.u64)("epoch"),(0,n.publicKey)("custodian")],"lockup"),(0,n.struct)(j,"epochFee"),(0,n.option)((0,n.struct)(j),"nextEpochFee"),(0,n.option)((0,n.publicKey)(),"preferredDepositValidatorVoteAddress"),(0,n.option)((0,n.publicKey)(),"preferredWithdrawValidatorVoteAddress"),(0,n.struct)(j,"stakeDepositFee"),(0,n.struct)(j,"stakeWithdrawalFee"),(0,n.option)((0,n.struct)(j),"nextStakeWithdrawalFee"),(0,n.u8)("stakeReferralFee"),(0,n.option)((0,n.publicKey)(),"solDepositAuthority"),(0,n.struct)(j,"solDepositFee"),(0,n.u8)("solReferralFee"),(0,n.option)((0,n.publicKey)(),"solWithdrawAuthority"),(0,n.struct)(j,"solWithdrawalFee"),(0,n.option)((0,n.struct)(j),"nextSolWithdrawalFee"),(0,n.u64)("lastEpochPoolTokenSupply"),(0,n.u64)("lastEpochTotalLamports")]);var Xo=(0,n.struct)([(0,n.u64)("activeStakeLamports"),(0,n.u64)("transientStakeLamports"),(0,n.u64)("lastUpdateEpoch"),(0,n.u64)("transientSeedSuffixStart"),(0,n.u64)("transientSeedSuffixEnd"),(0,n.u8)("status"),(0,n.publicKey)("voteAccountAddress")]),mt=(0,n.struct)([(0,n.u8)("accountType"),(0,n.u32)("maxValidators"),(0,n.vec)(Xo,"validators")]);s();c();var R=U(rt());function Ie(t){return isNaN(t)?0:Number(t*u.LAMPORTS_PER_SOL)}function yt(t,e){let o=e.mul(t.totalLamports),r=t.poolTokenSupply;return o.lt(r)?new R.default(0):o.div(r)}async function Vt(t,e){let[o]=await u.PublicKey.findProgramAddress([e.toBuffer(),Buffer.from("withdraw")],t);return o}async function St(t,e,o,r){let[a]=await u.PublicKey.findProgramAddress([e.toBuffer(),o.toBuffer(),r?new R.default(r).toArrayLike(Buffer,"le",4):Buffer.alloc(0)],t);return a}function Z(t){if(typeof t=="number")return Math.abs(t)/u.LAMPORTS_PER_SOL;if(typeof t=="bigint")return Math.abs(Number(t))/u.LAMPORTS_PER_SOL;let e=1;t.isNeg()&&(e=-1);let r=t.abs().toString(10).padStart(10,"0"),a=r.length-9,i=r.slice(0,a)+"."+r.slice(a);return e*parseFloat(i)}async function Zo(t,e,o,r){let[a]=await u.PublicKey.findProgramAddress([Ae,e.toBuffer(),o.toBuffer(),r.toArrayLike(Buffer,"le",8)],t);return a}function tr(t,e){return t.poolTokenSupply.isZero()||t.totalLamports.isZero()?e:e.mul(t.poolTokenSupply).div(t.totalLamports)}async function Le(t,e,o,r,a,i){let m=await t.getAccountInfo(e.validatorList),p=mt.decode(m?.data);if(!p?.validators||p?.validators.length==0)throw new Error("No accounts found");let A=await t.getMinimumBalanceForRentExemption(u.StakeProgram.space),S=new R.default(A+$),d=[];for(let v of p.validators){if(v.status!==0)continue;let L=await St(K,v.voteAccountAddress,o);if(!v.activeStakeLamports.isZero()){let _=e?.preferredWithdrawValidatorVoteAddress?.equals(v.voteAccountAddress);d.push({type:_?"preferred":"active",voteAddress:v.voteAccountAddress,stakeAddress:L,lamports:v.activeStakeLamports})}let E=v.transientStakeLamports.sub(S);if(E.gt(new R.default(0))){let _=await Zo(K,v.voteAccountAddress,o,v.transientSeedSuffixStart);d.push({type:"transient",voteAddress:v.voteAccountAddress,stakeAddress:_,lamports:E})}}d=d.sort(a||((v,L)=>L.lamports.sub(v.lamports).toNumber()));let h=await t.getAccountInfo(e.reserveStake),b=new R.default((h?.lamports??0)-A);b.gt(new R.default(0))&&d.push({type:"reserve",stakeAddress:e.reserveStake,lamports:b});let T=[],f=new R.default(r),P=e.stakeWithdrawalFee,x={numerator:P.denominator.sub(P.numerator),denominator:P.denominator};for(let v of["preferred","active","transient","reserve"]){let L=d.filter(E=>E.type==v);for(let{stakeAddress:E,voteAddress:_,lamports:N}of L){if(N.lte(S)&&v=="transient")continue;let g=tr(e,N);!i&&!x.numerator.isZero()&&(g=g.mul(x.denominator).div(x.numerator));let O=R.default.min(g,f);if(!O.lte(new R.default(0))&&(T.push({stakeAddress:E,voteAddress:_,poolAmount:O}),f=f.sub(O),f.isZero()))break}if(f.isZero())break}if(f.gt(new R.default(0)))throw new Error(`No stake accounts found in this pool with enough balance to withdraw ${Z(r)} pool tokens.`);return T}function Ee(t,e,o){let r=u.Keypair.generate();return e.push(u.SystemProgram.createAccount({fromPubkey:t,newAccountPubkey:r.publicKey,lamports:o,space:u.StakeProgram.space,programId:u.StakeProgram.programId})),r}async function _e(t,e){let o=await t.getAccountInfo(e);if(!o)throw new Error("Invalid stake pool account");return{pubkey:e,account:{data:xe.decode(o.data),executable:o.executable,lamports:o.lamports,owner:o.owner}}}async function er(t,e){let o=(await t.getParsedAccountInfo(e)).value;if(!o||!("parsed"in o.data))throw new Error("Invalid stake account");if(o.data.program!="stake")throw new Error("Not a stake account");return Te.parse(o.data.parsed)}async function Rn(t,e,o,r,a,i,m,p){let A=await t.getBalance(o,"confirmed");if(A<r)throw new Error(`Not enough SOL to deposit into pool. Maximum deposit amount is ${Z(A)} SOL.`);let d=(await _e(t,e)).account.data,h=new u.Keypair,b=[h],T=[];if(T.push(u.SystemProgram.transfer({fromPubkey:o,toPubkey:h.publicKey,lamports:r})),!a){let P=At(d.poolMint,o);T.push(Xt(o,P,o,d.poolMint)),a=P}let f=await Vt(K,e);return T.push(X.depositSol({stakePool:e,reserveStake:d.reserveStake,fundingAccount:h.publicKey,destinationPoolAccount:a,managerFeeAccount:d.managerFeeAccount,referralPoolAccount:m??a,poolMint:d.poolMint,lamports:r,withdrawAuthority:f,depositAuthority:p,referralAccount:i})),{instructions:T,signers:b}}async function Ke(t,e,o,r,a=!1,i,m,p,A){let S=await _e(t,e),d=new tt.default(Ie(r));p||(p=At(S.account.data.poolMint,o));let h=await Qt(t,p);if(h.amount<d.toNumber())throw new Error(`Not enough token balance to withdraw ${Z(d)} pool tokens.
          Maximum withdraw amount is ${Z(h.amount)} pool tokens.`);let b=await t.getMinimumBalanceForRentExemption(u.StakeProgram.space),T=await Vt(K,e),f=null;m&&(f=await er(t,m));let P=[];if(a)P.push({stakeAddress:S.account.data.reserveStake,voteAddress:void 0,poolAmount:d});else if(f&&f?.type=="delegated"){let g=f.info?.stake?.delegation.voter;if(!g)throw new Error(`Invalid stake reciever ${m} delegation`);let O=await t.getAccountInfo(S.account.data.validatorList),D=mt.decode(O?.data).validators.find(C=>C.voteAccountAddress.equals(g));if(i&&i!==g)throw new Error(`Provided withdrawal vote account ${i} does not match delegation on stake receiver account ${g},
        remove this flag or provide a different stake account delegated to ${i}`);if(D){let C=await St(K,g,e),et=await t.getAccountInfo(C);if(!et)throw new Error("Preferred withdraw valdator's stake account is invalid");let ot=yt(S.account.data,new tt.default(et.lamports-$-b));if(ot.lt(d))throw new Error(`Not enough lamports available for withdrawal from ${C},
              ${d} asked, ${ot} available.`);P.push({stakeAddress:C,voteAddress:g,poolAmount:d})}else throw new Error(`Provided stake account is delegated to a vote account ${g} which does not exist in the stake pool`)}else if(i){let g=await St(K,i,e),O=await t.getAccountInfo(g);if(!O)throw new Error("Invalid Stake Account");let q=new tt.default(O.lamports-$-b);if(q.lt(new tt.default(0)))throw new Error("Invalid Stake Account");let D=yt(S.account.data,q);if(D.lt(d))throw new Error(`Not enough lamports available for withdrawal from ${g},
            ${d} asked, ${D} available.`);P.push({stakeAddress:g,voteAddress:i,poolAmount:d})}else{let g=await Le(t,S.account.data,e,d,A,p.equals(S.account.data.managerFeeAccount));P.push(...g)}let x=[],v=u.Keypair.generate(),L=[v];x.push(ne(p,v.publicKey,o,d.toNumber()));let E=0,_=5,N=0;for(let g of P){if(N>_)break;let q=`Withdrawing \u25CE${yt(S.account.data,g.poolAmount)},
        from stake account ${g.stakeAddress?.toBase58()}`;g.voteAddress&&(q=`${q}, delegated to ${g.voteAddress?.toBase58()}`);let D;if(!m||f&&f.type==="delegated"){let C=Ee(o,x,b);L.push(C),E+=b,D=C.publicKey}else D=m;x.push(X.withdrawStake({stakePool:e,validatorList:S.account.data.validatorList,validatorStake:g.stakeAddress,destinationStake:D,destinationStakeAuthority:o,sourceTransferAuthority:v.publicKey,sourcePoolAccount:p,managerFeeAccount:S.account.data.managerFeeAccount,poolMint:S.account.data.poolMint,poolTokens:g.poolAmount.toNumber(),withdrawAuthority:T})),N++}return m&&f&&f.type==="delegated"&&L.forEach(g=>{x.concat(u.StakeProgram.merge({stakePubkey:m,sourceStakePubKey:g.publicKey,authorizedPubkey:o}).instructions)}),{instructions:x,signers:L,stakeReceiver:m,totalRentFreeBalances:E}}function or(t){let{t:e}=zt(),o=Wt(),r=It(),{mutateAsync:a}=ee(t);return Ft({mutationFn:async({stakePoolAddress:p,amount:A,accountIdentifier:S,senderAddress:d})=>{let{networkID:h,address:b}=d,T=new u.PublicKey(b),f=new u.PublicKey(b),{instructions:P,signers:x}=await Ke(t,p,T,A,!1).catch(N=>{throw gt.captureError(N,"staking"),N}),v=new J.Transaction;v.add(...P);let L=await Gt(v,{connection:t}),E={ownerAddress:b??"",networkID:h,data:{signature:""},type:"withdrawStake",display:{summary:{topLeft:{text:e("transactionsPendingWithdrawingStake")}}}};r.approved({chainType:"solana",chainName:"solana",networkId:M.getSolanaNetworkIDValue(h),type:"withdraw-liquid-stake"});let _=await a({accountIdentifier:S,feePayer:f,transaction:L,pendingTransactionInput:E,opts:{additionalSignerAccounts:x}});return r.submittedTransaction(_,{chainType:"solana",chainName:"solana",networkId:M.getSolanaNetworkIDValue(h),method:"signAndSendTransaction"}),{networkID:h,id:_}},onSuccess:p=>{Zt({connection:t,signature:p.id}).then(()=>{r.transactionStatus(p.id,{chainType:"solana",chainName:"solana",networkId:M.getSolanaNetworkIDValue(p.networkID),status:{type:"confirmed"}}),st(o)()}).catch(A=>{r.transactionStatus(p.id,{chainType:"solana",chainName:"solana",networkId:M.getSolanaNetworkIDValue(p.networkID),status:{type:"error"}}),gt.captureError(A,"staking")})}})}s();c();s();c();var ni={name:"Jito",stakePoolAddress:"Jito4APyf642JPZPx3hGc6WWJ8zPKtRbRs4P815Awbb",apy:"0.0760131222374123",convertRatio:"1.1067926864808721",stakePoolTokenMetadata:{metadata:{address:"J1toso1uCk3RLmjorhTtrVwY9HJ7X8V9yYac6Y7kGCPn",name:"Jito Staked SOL",symbol:"JitoSOL",decimals:9,logoURI:"https://storage.googleapis.com/token-metadata/JitoSOL-256.png",chainId:"solana:101"},caip19:"solana:101/address:J1toso1uCk3RLmjorhTtrVwY9HJ7X8V9yYac6Y7kGCPn"},chainId:"solana:101",validators:[{vote_account:"validator"}]},Ne={name:"Phantom Staked SOL",stakePoolAddress:"pSPcvR8GmG9aKDUbn9nbKYjkxt9hxMS7kF1qqKJaPqJ",apy:"0.0950000000000000",convertRatio:"1.0500000000000000",stakePoolTokenMetadata:{metadata:{address:oe,name:"Phantom Staked SOL",symbol:"PSOL",decimals:9,logoURI:"https://storage.googleapis.com/token-metadata/PSOL-256.png",chainId:"solana:101"},caip19:"solana:101/address:pSo1f9nQXWgXibFtKf7NWYxb5enAM4qfP6UJSiXRQfL"},chainId:"solana:101",validators:[{vote_account:"validator"}]};function rr(t){return t?t.stakePoolTokenMetadata.caip19===Ne.stakePoolTokenMetadata.caip19:!1}var mi={identityPublicKey:"7GkMBmtrTZz8QbjSe1sXvAUtz7Pp42SQxfT5ymmJD4We",voteAccountPublicKey:"J2nUHEAgZFRyuJbFjdqPrAa9gyWDuc7hErtDQHPhsYRp"};export{ze as a,je as b,Ge as c,br as d,Ye as e,He as f,Qe as g,$e as h,Xe as i,Ze as j,Ar as k,hr as l,bo as m,Ao as n,Va as o,se as p,it as q,st as r,ce as s,ue as t,It as u,be as v,Io as w,So as x,go as y,Et as z,Eo as A,Pe as B,Rn as C,or as D,rr as E,mi as F};
//# sourceMappingURL=chunk-HIWDTKJJ.js.map
