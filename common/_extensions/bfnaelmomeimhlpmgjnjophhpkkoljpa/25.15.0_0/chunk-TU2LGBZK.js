import{b as je}from"./chunk-PLQQKT2M.js";import{a as Oe}from"./chunk-NUJWAPIJ.js";import{b as Ve}from"./chunk-KQPLPV6X.js";import{a as Be}from"./chunk-DZ3GQOT6.js";import{Id as Ne,Sb as ee,Tb as P,Xc as ze,tc as Le}from"./chunk-EIQDOUTB.js";import{b as Ee}from"./chunk-NEKSPHVV.js";import{h as ke}from"./chunk-65FAE5DM.js";import{e as $e}from"./chunk-DBO6DP4Z.js";import{c as te,j as Ue}from"./chunk-5W7YPRT3.js";import{Ya as K,eb as Pe,wd as Me,yc as we}from"./chunk-D7Z6MPRS.js";import{K as xe}from"./chunk-E2H5RB2U.js";import{a as qe}from"./chunk-CWJVYWRL.js";import{Ea as De,Q as z,d as Z,ea as Qe,j as Ie,q as E,s as Y,v as R,w as i,x as g}from"./chunk-27TD4NX4.js";import{L as Se}from"./chunk-YJV3X2ON.js";import{D as Ae}from"./chunk-FBDT5S2M.js";import{T as Te}from"./chunk-TKSJVOQZ.js";import{a as Fe,x as J}from"./chunk-UA6ADLWZ.js";import{f as Ce,h as D,n as L}from"./chunk-3KENBVE7.js";D();L();var e=Ce(Fe());D();L();var s=Ce(Fe()),_e=({width:f,trackColor:v=Y.colors.legacy.bgArea,spinnerColor:n=Y.colors.legacy.accentPrimary})=>s.default.createElement("svg",{width:f,height:f,viewBox:"0 0 26 26"},s.default.createElement("g",null,s.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13 23.413c5.751 0 10.413-4.662 10.413-10.413S18.751 2.587 13 2.587 2.587 7.249 2.587 13 7.249 23.413 13 23.413zm0 2.315c7.03 0 12.727-5.699 12.727-12.728S20.03.273 13 .273C5.97.273.273 5.97.273 13 .273 20.03 5.97 25.728 13 25.728z",fill:v})),s.default.createElement("g",null,s.default.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.382 24.125a1.157 1.157 0 01.623-1.513 10.412 10.412 0 005.607-13.617 1.157 1.157 0 112.136-.89 12.726 12.726 0 01-6.853 16.643 1.157 1.157 0 01-1.513-.623z",fill:n})));_e.defaultProps={width:44};var oe=({diameter:f,color:v,trackColor:n,position:k})=>s.default.createElement(s.default.Fragment,null,s.default.createElement("style",null,`@keyframes rotate {
            100% {
              transform: rotate(360deg);
            }
          }`),s.default.createElement("div",{style:{position:k,width:`${f}px`,height:`${f}px`,animation:"rotate 0.5s linear infinite"}},s.default.createElement(_e,{width:f,spinnerColor:v,trackColor:n})));oe.defaultProps={diameter:44};var Bt=({onClose:f,onClickBuy:v})=>{let{t:n}=Ie(),[k,x]=(0,e.useState)(void 0),ne=qe(),d=Ue(),{quickSelectDenominations:He,minPurchaseAmountUsd:N,maxPurchaseAmountUsd:U,purchaseType:$,fungible:We,ownerPublicKey:B,purchaseAmount:c,setState:l,paymentMethod:q,provider:V,checkoutQuoteType:Xe,redirectURL:re}=d,p=parseFloat(c),m=$==="currency",{name:O,symbol:r,decimals:ae,caip19:C,logoURI:Ge}=We||{},h=C?.chainId,j=we(),{data:Je=""}=Me({select:t=>t?.name}),{data:ie}=Le({query:{data:C}}),a=ie?ie?.usd:void 0,{currencySymbol:Ke,currencyCode:T,toUsd:w,fromUsd:A}=Ee(),I=(0,e.useMemo)(()=>{if(k)return!1;let t=c.length>0,o=p>0,y=Number.isFinite(p);return t&&o&&y},[k,c,p]),Ze=(0,e.useMemo)(()=>{if(!a)return`??? ${r}`;if(m){let o=ze.get(h).formDisplayPrecision,y=w(p),Q=P(y,a,o),F=Ne(Q,o);return c===""?`0 ${r}`:F.length+(r?.length??0)<15?`~${F} ${r}`:`~${F.substring(0,8)}... ${r}`}let t=c===""?0:ee(p,a);return e.default.createElement(Oe,{value:t,font:"caption",color:"textSecondary"})},[r,h,c,p,m,w,a]),[Ye,_]=(0,e.useState)(500),Re=Te({purchaseAmount:c,purchaseType:$},Ye),{purchaseAmount:S,purchaseType:se}=Re,M=(0,e.useCallback)(t=>{let o=parseFloat(t),y=m?T?.toUpperCase():r,Q=m?Number(A(N)):P(N,a??0,te),F=m?Number(A(U)):P(U,a??0,te),it=o<Q,st=o>F,ve=it?n("buyAssetScreenMinPurchasePriceInterpolated",{amount:`${Q} ${y}`}):st?n("buyAssetScreenMaxPurchasePriceInterpolated",{amount:`${F} ${y}`}):void 0;return ve==null?{status:"pass"}:{status:"fail",message:ve}},[A,m,n,T,r,N,a,U]),et=(0,e.useCallback)(({value:t})=>M(t),[M]),de=(0,e.useCallback)(t=>{let o=M(t);_(500),l({...d,purchaseAmount:t,checkoutQuoteType:"recommended"}),x(o?o.message:void 0)},[d,l,M]),tt=(0,e.useCallback)(t=>{j.capture("fiatOnrampAmountSelected",{data:{networkId:h,chainId:K.getChainID(h),asset:{name:O,symbol:r,type:"fungible"},amount:t}}),_(100),l({...d,purchaseAmount:t,purchaseType:"currency",checkoutQuoteType:"recommended"}),x(void 0)},[d,r,O,h,l,j]),ot=(0,e.useCallback)(t=>{if(t.preventDefault(),!a)return;let o=m?P(w(p),a,ae):A(ee(p,a));_(100),l({...d,purchaseAmount:o.toString(),purchaseType:m?"token":"currency"}),x(void 0)},[d,ae,A,p,l,m,w,a]),{data:[me,ue,ce]}=Se(["enable-fiat-ramp-optimize-defaults","enable-fiat-ramp-optimize-default-payment-method","enable-fiat-ramp-enhancements"]),H=(0,e.useMemo)(()=>({...se==="currency"?{fiatAmount:S}:{tokenAmount:S},token:C,fiatCurrencyCode:T,destinationAddress:{address:B,chainId:C?.chainId,resourceType:"address"},optimizeDefaults:me,optimizeDefaultPaymentMethod:ue,enableFiatRampEnhancements:ce}),[C,S,se,T,B,ce,me,ue]),W=Xe==="selected",X=!W&&I&&!!S,{data:G,isLoading:le,isError:pe}=$e("web-embedded",J,Z.language,{...H,paymentMethodId:q?.id,providerId:V?.id},X),u=W?q:G?.paymentMethod,b=W?V:G?.provider,fe=(0,e.useCallback)(()=>{l({...d,paymentMethod:u}),ne.toStack("fiat-ramp-detail")},[ne,d,u,l]),ye=(0,e.useMemo)(()=>X&&le?{id:"recommended-quote-loading",topLeft:n("buyThirdPartyScreenLoadingQuote"),end:e.default.createElement(oe,{diameter:20}),disabled:!0}:!I||!u||!b||pe?{type:"drawer",id:"no-quote",topLeft:()=>e.default.createElement(e.default.Fragment,null,e.default.createElement(R.CreditCard,{size:18}),e.default.createElement(g,{font:"caption"},n("buyThirdPartyScreenChoseQuote"))),disabled:!0,onClick:()=>null}:{type:"drawer",id:"selected-quote",onClick:fe,topLeft:{text:u?.name,before:u?.assets?.icon?e.default.createElement("img",{src:u?.assets?.icon,width:24,height:24}):void 0},topRight:{text:b?.name}},[fe,I,X,pe,le,u,b,n]),[nt,ge]=(0,e.useState)(!1),he=I&&(!!G||!!q&&!!V),rt=(0,e.useMemo)(()=>({...H,paymentMethodId:u?.id||"",providerId:b?.id||"",redirectURL:re}),[H,u?.id,b?.id,re]),at=xe(),be=async t=>{if(he){t&&t.preventDefault(),j.capture("fiatOnrampBuyClickedByUser",{data:{networkId:h,chainId:K.getChainID(h),asset:{name:O,symbol:r,type:"fungible"},purchaseType:$,amount:S,paymentMethod:u?.id,provider:b?.id}}),l({...d,price:a??0}),ge(!0);try{let{url:o,sessionId:y}=await Be("web-embedded",J,Z.language,rt,at);v?v(o,y,Pe(C),b):self.open(o,"_blank")?.focus()}catch(o){Ae.captureError(o,"onRamp")}ge(!1)}};return e.default.createElement(i,{justifyContent:"space-between",height:"100%"},e.default.createElement(i,null,e.default.createElement(i,{alignItems:"center",gap:32},e.default.createElement(g,{font:"heading3"},n("buyAssetInterpolated",{tokenSymbol:r})),e.default.createElement(Ve,{image:{type:"fungible",src:Ge,fallback:r??""},size:96})),e.default.createElement(i,{direction:"row",gap:8,alignItems:"center",justifyContent:"flex-start",marginTop:24,padding:16,borderRadius:16,backgroundColor:"bgArea"},e.default.createElement(g,{font:"body"},Je),e.default.createElement(g,{font:"caption",color:"textSecondary"},"(",ke(B,4),")")),e.default.createElement("form",{onSubmit:void 0,className:E({marginTop:8})},e.default.createElement(Qe,{value:c,onChangeText:de,placeholder:n("amount"),id:"purchaseAmount",label:n("amount"),end:m?T:r,showLabel:!1,validator:et,setValue:de}),e.default.createElement(i,{justifyContent:"space-between",direction:"row",alignItems:"center",marginTop:8},e.default.createElement(i,null,e.default.createElement(i,{onPress:ot,gap:4},a?e.default.createElement(g,{color:"textSecondary",font:"caption"},Ze,a===0?null:e.default.createElement(R.Swap2Vertical,{size:12,className:E({marginLeft:4})})):e.default.createElement(g,null,`??? ${r}`))),e.default.createElement(i,{direction:"row",gap:8},He.map(t=>e.default.createElement(z,{size:"micro",key:t,theme:c===t?"primary":"secondary",onClick:()=>tt(t)},Ke,e.default.createElement(g,{font:"label"},t))))))),e.default.createElement(i,null,ye&&e.default.createElement(De,{rows:[ye]}),e.default.createElement(i,{gap:8,marginTop:12,direction:"row",justifyContent:"space-between",className:je},e.default.createElement(z,{theme:"secondary",onClick:f},n("commandCancel")),e.default.createElement(z,{theme:"primary",disabled:!he||nt,onClick:be},n("commandBuy")))))};export{Bt as a};
//# sourceMappingURL=chunk-TU2LGBZK.js.map
