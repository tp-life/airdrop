import{d as N,l as At}from"./chunk-KGDIAQCZ.js";import{a as Et}from"./chunk-TLXUERY6.js";import{b as E}from"./chunk-A3P4N2T2.js";import{a as v,e as Ot}from"./chunk-5UQNMD2N.js";import{a as wt}from"./chunk-BU5U5Q5F.js";import{e as bt}from"./chunk-VSDQKS4O.js";import{a as Oe,k as F,l as D,n as yt,q as je,r as _t}from"./chunk-MXDITV4U.js";import{b as w}from"./chunk-R56TBW5W.js";import{g as lt,i as ie,k as _e}from"./chunk-KWSTGWJV.js";import{a as Z,c as me,d as Ee,f as A,g as R}from"./chunk-2L5V4MTR.js";import{Ab as Ye,Ba as Ue,Bb as gt,Ca as ve,Da as Ve,N as ht,Na as We,Vb as ze,Wa as be,mb as we,pb as p,rc as St,sb as O,tb as He,ub as $e,uc as It,vb as qe,vc as Ct,xb as pt,yb as ft,zb as Tt}from"./chunk-762Y5MQL.js";import{G as te}from"./chunk-L4N7WJIQ.js";import{F as Q,Q as Be,c as Re,da as dt,j as Me,pa as Ne}from"./chunk-LBCQTFOD.js";import{D as B,N as Ge,a as mt,b as ut,c as ct,d as J,e as X,z as xe}from"./chunk-V63HWKAL.js";import{a as ui}from"./chunk-B75PPTYD.js";import{f as mi,h as s,m as _,o as b}from"./chunk-UGZFXKPB.js";_();b();Ne();Ge();_();b();var ki={Failed:"-1",Waiting:"1",Pending:"2",Succeed:"3"},ue={ESTIMATE:1,EXCEED_ESTIMATE:2,UNTIMED:3,TIMEOUT:4},Li={FromIsBtcChain:1,FromIsNotBtcChain:2,FromIsEthChainFacetCoin:3},G={SINGLE_TIPS:1,GAS:2,BRIDGE:3},re={SINGLE:1,CROSS_FROM_SWAP:2,CROSS_BRIDGE_SWAP:3,CROSS_TO_SWAP:4};_();b();var ke={SUCCESS:"success",FAIL:"fail",REJECT:"reject",TXHASH:"txhash",APPROVE:"approve",CONNECT:"connect",APP_STATUS:"appStatus",CLOSE:"close"},ci=Object.values(ke),Qe=class{constructor(){s(this,"toast",!0);s(this,"setToast",e=>{this.toast=e});s(this,"chainList",[]);s(this,"setChainList",e=>{this.chainList=e});s(this,"quote",{});s(this,"updateQuote",e=>{this.quote={...this.quote,...e}});s(this,"portal","");s(this,"setPortal",e=>{this.portal=e||""});s(this,"swapParams",{});s(this,"setSwapParams",({fromAmount:e,...t})=>{this.swapParams={...t,fromAmount:Oe(e)?e:"1"}});s(this,"status","");s(this,"reset",()=>{this.to={},this.from={},this.events={},this.swapParams={}});s(this,"on",(e,t)=>{if(!ci.includes(e))return new Error("Not support event!!");if(typeof t!="function")return{};this.events[e]||(this.events[e]=[]);let i=`${e}${this.events[e].length}`;return this.events[e].push({cb:t,eventId:i}),{eventId:i,remove:()=>{this.remove(e,i)}}});s(this,"emit",(e,...t)=>{let i=this.events[e];i&&i.length&&i.forEach(r=>{let{cb:o}=r;o&&o.apply(this,t)})});s(this,"remove",(e,t="")=>{let i=this.events[e];i&&t&&i.forEach((r,o)=>{r.eventId===t&&i.splice(o,1)})});s(this,"removeAll",()=>{this.events={}});this.events={}}static init(e){return this.instance||(this.instance=new Qe(e)),this.instance}},Ae=Qe;s(Ae,"instance",null);var li=new Ae,Ke=li;_();b();Ge();var ce=({fromAmount:l,fromSymbol:e,equal:t="=",toAmount:i,toSymbol:r})=>J.formatRange({leftNumber:J.formatCurrency(l,{code:e,isSymbol:!1}),sign:` ${t} `,rightNumber:J.formatCurrency(i,{code:r,isSymbol:!1})}),le=({fromAmount:l,fromSymbol:e,equal:t="=",toAmount:i,toSymbol:r})=>J.formatRange({leftNumber:J.formatCurrency(l,{code:E(e),isSymbol:!1}),sign:` ${t} `,rightNumber:J.formatCurrency(i,{code:E(r),isSymbol:!1})}),oe=({amount:l,symbol:e,extra:t})=>`${l} ${e} ${t}`,he=(l,e)=>ct.isRTL?`${e}${l}`:`${l}${e}`;_();b();var pe=mi(ui());function fe({type:l,title:e,exploreUrl:t,onURLClick:i,showClose:r}){let o=t?pe.default.createElement(Ot,{className:"color-959dad",href:t,onClick:i},pe.default.createElement("div",{className:"inline-flex align-items-center"},pe.default.createElement("div",{className:"font-12 color-0569ff font-bold"},w("swaptrade_toast_anchor_view_in_explorer")),pe.default.createElement(Et,{className:"okx-defi-dex-link color-0569ff",size:20}))):void 0,n=5;l==="success"?te.success({title:e,desc:o,duration:n}):l==="failed"?te.error({title:e,desc:o,duration:n}):l==="info"?te.info({title:e,desc:o,duration:n,showClose:r}):l==="expired"?te.info({title:e,desc:o,duration:n,icon:"okds-clock"}):l==="warn"&&te.warn({title:e,desc:o,duration:n,showClose:r})}function se({title:l,exploreUrl:e="",onURLClick:t=()=>{}}){fe({type:"success",title:l,exploreUrl:e,onURLClick:t})}function Le({title:l,exploreUrl:e="",onURLClick:t=()=>{}}){fe({type:"failed",title:l,exploreUrl:e,onURLClick:t})}function Je({title:l,exploreUrl:e="",onURLClick:t=()=>{},showClose:i=!0}){fe({type:"info",title:l,exploreUrl:e,onURLClick:t,showClose:i})}function kt({title:l,exploreUrl:e="",onURLClick:t=()=>{}}){fe({type:"expired",title:l,exploreUrl:e,onURLClick:t})}function Lt({title:l,exploreUrl:e="",onURLClick:t=()=>{},showClose:i=!0}){fe({type:"warn",title:l,exploreUrl:e,onURLClick:t,showClose:i})}_();b();var ne=class{constructor(e){s(this,"orderId","--");s(this,"chainId","--");s(this,"defiPlatformInfo","--");s(this,"fromAmount","--");s(this,"fromTokenSymbol","--");s(this,"price","--");s(this,"status","--");s(this,"time","--");s(this,"toAmount","--");s(this,"toTokenSymbol","--");s(this,"userWalletAddress","--");s(this,"exploreUrl","--");s(this,"isExchanged",!1);s(this,"swapType","--");s(this,"toChainId","--");_e(this),Object.assign(this,e)}get computedFromAmount(){return`${R(this.fromAmount,{needPlaceholder:!0,needBillionMillionUnit:!0})}`}get computedToAmount(){return A(this.toAmount)}get computedToNetWorkPath(){let{fromChainName:e,toChainName:t}=this;return e===t?t:`${e} ${w("swaptrade_order_info_label_network_to")} ${t}`}updateFromJson(e){Object.assign(this,e)}toJSON(){return ie(this)}};var{BigNumber:Xe}=Z,Dt=20,H=[],d={Pending:"0",Failed:"-1",Succeed:"1",Waiting:"100",SpeedingUp:"-4",Canceling:"-3",Canceled:"-2",PendingWithdrawn:"10",PendingCanRedeem:"11",PendingRedeeming:"12"},{Pending:pi,SpeedingUp:fi,Canceling:Ti,PendingWithdrawn:gi,PendingCanRedeem:Si,PendingRedeeming:Ii}=d,Ci=[pi,fi,Ti,gi,Si,Ii],c={SingleChain:"1",CrossBridge:"2",CrossChain:"3",FromBridge:"3-1",BridgeTo:"3-2",FromBridgeTo:"3-3",GasStation:"4",GasStationCross:"5",LimitOrder:"6",MemeMode:"7"};var U={from:1,bridge:2,fromSwapTimeout:3},yi={FAIL:"-1",NO_SELECTED:"0",WAITING_FOR_FINAL:"1",WAITING_FOR_TRANSFER:"2",TRANSFER_SUCCEED:"3"},{NO_SELECTED:_i,TRANSFER_SUCCEED:bi}=yi,wi=10,Pt={curPageNum:1,pageSize:wi,total:0},Ei={[c.SingleChain]:"swaptrade_order_swap_trade_type_swap",[c.CrossBridge]:"swaptrade_order_swap_trade_type_bridge",[c.CrossChain]:"swaptrade_order_swap_trade_type_cross_chain",[c.GasStation]:"swaptrade_dialog_tab_gasstation",[c.GasStationCross]:"swaptrade_dialog_tab_gasstation",[c.LimitOrder]:"swaptrade_dialog_tab_gasstation",[c.MemeMode]:"swaptrade_history_modal_label_meme_mode"};function $({childOrderId:l,status:e,exploreUrl:t,orderFailReason:i,toastGuideUrl:r,fromTokenIcon:o,fromChainLogoUrl:n,fromAmountIn:a,fromTokenSymbol:m,fromChainName:u,toTokenIcon:f,toChainLogoUrl:h,toAmountOut:I,toTokenSymbol:g,toChainName:k,originalTokenSymbol:T,refundAmount:P,refundSymbol:C,refundChain:L,errorCode:S,guideUrl:y},M,W={}){let x=M==="from",ee=x?a:I,ae=P?A(P):"",z=x?R(a):A(I,{needBillionMillionUnit:!1});W?.useCurrencyInputFormat&&(z=R(ee));let de=W?.isMemeModeOrder&&W?.assetDelay&&e===d.Succeed?"999999":S;return{key:`${l}${M}`,status:e,exploreUrl:t,orderFailReason:i,toastGuideUrl:r,originalTokenSymbol:T,fromChainName:u,fromTokenSymbol:m,toChainName:k,chainName:x?u:k,chainLogo:x?n:h,symbol:x?m:g,symbolLogo:x?o:f,amount:ee==="-1"?"":z,errorCode:de,guideUrl:y,refund:{amount:ae,symbol:C,chain:L},...W}}var Ze=class{constructor(e){s(this,"detail",{data:null,loading:!1,error:!1});s(this,"history",{list:[],loading:!1,loadMore:!1,hasMore:!1,error:null,pageInfo:{...Pt},chainId:-1});s(this,"limitHistory",{...this.history});s(this,"limitDetail",{...this.detail});s(this,"pendingOrders",[]);s(this,"modal",{orderId:"",visible:!1});s(this,"expireTime",0);s(this,"fromStepCountDownTimeGroup",{estimatedTime:0,estimatedTimeTotal:0});s(this,"bridgeStepCountDownTimeGroup",{estimatedTime:0,originEstimatedTime:0});s(this,"timeoutTimestamp",0);s(this,"timer",null);s(this,"timeOutTimer",null);s(this,"detailShowSource","");s(this,"showModal",e=>{let t=typeof e=="string"?e:"";this.modal={visible:!0,orderId:t,defaultOrderId:t},this.setHistoryTab(this.commonStore?.currentTab===p.BRIDGE?p.SWAP:this.commonStore?.currentTab)});s(this,"updateModal",e=>{this.modal.orderId=typeof e=="string"?e:""});s(this,"closeModal",()=>{this.modal.visible=!1,this.setDetailShowSource()});s(this,"setDetailShowSource",(e="")=>{this.detailShowSource=e});s(this,"setDetail",e=>{this.detail={...this.detail,...e}});s(this,"setLimitDetail",e=>{this.limitDetail={...this.limitDetail,...e}});s(this,"getStepCountDownTimeGroup",({estimatedTime:e,originEstimatedTime:t,expireTime:i,extraEstimatedTime:r,extraOriginEstimatedTime:o})=>{let n=Math.min(e,i),a=t||e;return this.computedMainOrderType===c.BridgeTo&&(n=e+Math.min(r,i),a+=o),{estimatedTime:n,estimatedTimeTotal:a}});s(this,"setSwapExpireTime",e=>{let t=!this.computedCurrentHistoryTabIsLimit&&Number(e.estimatedTime),i=Number(e.fromEstimatedTime)||0,r=Number(e.bridgeEstimatedTime)||0,o=Number(e.originFromEstimatedTime)||0,n=Number(e.originBridgeEstimatedTime)||0;this.fromStepCountDownTimeGroup=this.getStepCountDownTimeGroup({expireTime:t,estimatedTime:i,originEstimatedTime:o}),this.bridgeStepCountDownTimeGroup=this.getStepCountDownTimeGroup({expireTime:t,estimatedTime:r,originEstimatedTime:n,extraEstimatedTime:i,extraOriginEstimatedTime:o}),this.expireTime=t,this.expireTime>0&&(this.timer=setInterval(()=>{let a=this.computedStepStatus.bridgeStatus,m=this.computedStepStatus.fromSwapStatus,u=this.detail?.data?.status===d.Canceling,f=h=>h===d.SpeedingUp||h===d.Pending;this.expireTime<1?(clearInterval(this.timer),this.bridgeStepCountDownTimeGroup.estimatedTime=0,this.fromStepCountDownTimeGroup.estimatedTime=0):(this.expireTime-=1,this.fromStepCountDownTimeGroup.estimatedTime>0&&f(m)&&!u&&(this.fromStepCountDownTimeGroup.estimatedTime-=1),this.bridgeStepCountDownTimeGroup.estimatedTime>0&&f(a)&&!u&&(this.bridgeStepCountDownTimeGroup.estimatedTime-=1))},1e3))});s(this,"setSwapTimeout",e=>{this.timeOutTimer&&clearInterval(this.timeOutTimer),this.timeoutTimestamp=Date.now()>e?0:e||0,this.timeoutTimestamp>0&&(this.timeOutTimer=setInterval(()=>{Date.now()>this.timeoutTimestamp&&(this.timeoutTimestamp=0,clearInterval(this.timeOutTimer))},1e3))});s(this,"removePendingOrder",e=>{let t=this.pendingOrders,i=t.findIndex(({orderId:o})=>o===e);i>-1&&t.splice(i,1),this.setPendingOrders([...t])});s(this,"updateDetailByData",e=>{let t=this.detail.data,i=r=>r&&{...r,fromAmountIn:r?.fromAmount,toAmountOut:r?.toAmount};if(t&&e&&e.orderId===t.orderId){let{fromChildOrder:r,bridgeChildOrder:o,toChildOrder:n}=e;this.setDetail({data:Be(t,{...e,fromChildOrderDetailVo:i(r),bridgeChildOrderDetailVo:i(o),toChildOrderDetailVo:i(n)})})}});s(this,"fetchHistory",lt(function*(t={},i=!1){let r=this.accountStore.computedAccountWalletAddressesArray;if(this.computedIsLimitOrSwapLabel.chainId!==-1&&Object.assign(t,{chainId:this.computedIsLimitOrSwapLabel.chainId}),this.computedIsLimitOrSwapLabel.loading||this.computedIsLimitOrSwapLabel.loadMore||Q(r))return;this.setSwapOrLimitHistory(i?{loadMore:!0}:{loading:!0});let n=this.rootStore.widgetConfigStore?.getOrdersQueryParams()||{},a={...t,pageSize:this.history.pageInfo.pageSize,accountId:this.accountStore.computedAccountId,...n},m={...t,pageSize:this.limitHistory.pageInfo.pageSize,accountId:this.accountStore.computedAccountId,statusType:He.ALL},u=this.computedCurrentHistoryTabIsLimit?m:a,f=this.computedCurrentHistoryTabIsLimit?Ye:pt,[h,I]=yield B(N.get(f,{params:u}));if(this.setSwapOrLimitHistory(i?{loadMore:!1}:{loading:!1}),h){this.setSwapOrLimitHistory({error:h});return}this.setSucResult(I,i)}).bind(this));s(this,"setSucResult",(e,t)=>{let{data:{dataList:i,pageSize:r,totalCount:o,curPageNum:n,maxPageNum:a}}=e,m=t?this.computedIsLimitOrSwapLabel.list.concat(i):i;this.setSwapOrLimitHistory({list:m,pageInfo:{...this.computedIsLimitOrSwapLabel.pageInfo,total:o,pageSize:r,curPageNum:n},hasMore:a>n})});s(this,"updateSwapAndLimitDataList",e=>{this.computedIsLimitOrSwapLabel.list.forEach((t,i)=>{String(t?.orderId)===String(e?.orderId)&&(this.computedIsLimitOrSwapLabel.list[i]={...t,...e})})});s(this,"setChainId",async e=>{this.resetHistoryList(),this.setSwapOrLimitHistory({chainId:e}),await this.fetchHistory()});s(this,"resetHistoryList",()=>{this.setSwapOrLimitHistory({pageInfo:{...Pt},list:[],error:null,loading:!1,loadMore:!1,hasMore:!1,chainId:-1})});s(this,"getLocalPriceFee",(e,t,i=!0)=>{let{symbol:r,usdToThisRate:o}=this.commonStore.nowCurrencyUnit||{};if(e&&t&&o){let n=Z.mul(Z.mul(e,t),o);return i?`(${Ee(n,r)})`:Ee(n,r)}return""});s(this,"getDexGasStationFeeDetailTip",(e,t)=>{if(!this.computedIsGasStation||t!==d.Succeed||!e)return"";let{approveTokenAmount:i,gasTokenPriceUSD:r,gasTokenSymbol:o,swapGasFeeAmount:n,transferApproveTokenGasFeeAmount:a}=e||{};return w("swaptrade_swapforgas_tooltips_desc_gasswap_netfee",{value1:this.getLocalPriceFee(i,r,!1),approveFee:A(i),token1:o,value2:this.getLocalPriceFee(a,r,!1),transferFee:A(a),token2:o,value3:this.getLocalPriceFee(n,r,!1),swapFee:A(n),token3:o})});s(this,"checkSwapAgainBtn",({isOrderFinalized:e,isNotGasStationTrade:t,isMemeModeOrder:i})=>{if(wt())return!1;let r=t&&e;return i?r&&We():r});s(this,"emitOrder",e=>{if(e){let{status:t,orderId:i}=e;t===d.Succeed||t===O.SUCCEED?Ke.emit(ke.SUCCESS,{status:0,data:ie(e),message:xe("transaction success")}):(t===d.Failed||t===O.FAILED)&&Ke.emit(ke.FAIL,{data:{orderId:i},status:-1,message:xe("transaction fail")})}});s(this,"onSocket",(e,t=!0)=>{(e?.type==="1"||e?.type==="3")&&e?.dexData&&e.dexData.type!=="approve"&&e.dexData.type!=="register"&&(this.updateSwapAndLimitDataList(e.dexData),this.updateSwapAndLimitDetail(e.dexData),this.updateLimitOuterOrderList(e.dexData),this.updatePendingOrdersByData(e.dexData),this.emitOrder(e.dexData),this.toastSwapAndLimitOrder(t,e.dexData))});s(this,"updateSwapAndLimitDetail",e=>{e.swapTradeType!==c.LimitOrder?this.updateDetailByData(e):this.updateLimitDetailByData(e)});s(this,"updateLimitOuterOrderList",e=>{this.commonStore?.computedCurrentTabIsLimit&&this.rootStore.limitOrderListStore.updateLimitOuterListData(e)});s(this,"toastSwapAndLimitOrder",(e,t)=>{e&&!this.commonStore?.computedCurrentTabIsLimit?this.toastOrder(t):e&&this.commonStore?.computedCurrentTabIsLimit&&this.toastLimitOrder(t)});s(this,"onSocketError",async()=>{let{computedAccountId:e}=this.accountStore,{visible:t,orderId:i}=this.modal;if(!t){let[r]=await B(this.updatePendingOrders(e));r&&ut.error("history detail onSocketError",{error:r})}t&&i&&await B(this.updateDetail(i,!0))});s(this,"historyTab","");s(this,"setHistoryTab",e=>{this.historyTab=e});_e(this,{},{autoBind:!0}),this.rootStore=e,this.commonStore=e.commonStore,this.accountStore=e.accountStore,this.fromToStore=e.fromToStore,this.tokenModalStore=e.tokenModalStore}get computedHistoryList(){return this.history.list.map(e=>new ne(ie(e)))}get computedLimitHistoryList(){return this.limitHistory.list.map(e=>new ne(ie(e)))}get computedTimeGroup(){let e=this.computedCurrentHistoryTabIsLimit?this.computedLimitHistoryList:this.computedHistoryList,t=this.computedCurrentHistoryTabIsLimit?"createTime":"time";return e.reduce((i,r)=>{let o=i.find(n=>n.time===X(r?.[t],{format:"yyyyMMdd"}));return o?o.list.push(r):i.push({time:X(r?.[t],{format:"yyyyMMdd"}),list:[r]}),i},[])}get noData(){return this.computedCurrentHistoryTabIsLimit?!this.computedLimitHistoryList.length:!this.computedHistoryList.length}setHistory(e){this.history={...this.history,...e}}setLimitHistory(e){this.limitHistory={...this.limitHistory,...e}}setPendingOrders(e){this.pendingOrders=e}fetchDetail(e){return this.computedCurrentHistoryTabIsLimit?N.get(gt,{params:{orderId:e}}).then(({data:t})=>t):N.get(ft,{params:{orderId:e}}).then(({data:t})=>t)}fetchPendingOrders(e){let i=this.rootStore.widgetConfigStore?.getOrdersQueryParams()||{};return N.post(Tt,{accountId:e,...i}).then(({data:r})=>r)}async updatePendingOrders(e){if(mt())return;let t;if(this.commonStore?.computedCurrentTabIsLimit){let[,i]=await B(N.get(Ye,{params:{accountId:this.accountStore.computedAccountId,chainId:"",pageNum:1,pageSize:10,statusType:He.PENDING}}));t=i?.data?.dataList}else{let[,i]=await B(this.fetchPendingOrders(e));t=i}Array.isArray(t)?this.setPendingOrders(t):this.setPendingOrders([])}updatePendingOrdersByData(e){if(!e)return;let t=this.pendingOrders,i=t.findIndex(({orderId:n})=>n===e.orderId),r=i>-1,o=e.swapTradeType===c.LimitOrder?e.status===O.PENDING:Ci.includes(e.status);o?(r&&t.splice(i,1),t.push(e)):!o&&r&&t.splice(i,1),this.setPendingOrders([...t])}async updateDetail(e,t){t||this.setLimitOrSwapDetail({data:null,loading:!0,error:!1});let[i,r]=await B(this.fetchDetail(e));clearInterval(this.timer),i||!r?this.setLimitOrSwapDetail({data:null,error:!0}):(this.setLimitOrSwapDetail({data:r,error:!1}),this.setSwapExpireTime(r),this.setSwapTimeout(Number(r.timeoutTimestamp))),this.setLimitOrSwapDetail({loading:!1})}setLimitOrSwapDetail(e){this.computedCurrentHistoryTabIsLimit?this.setLimitDetail(e):this.setDetail(e)}updateLimitDetailByData(e){let t=this.limitDetail.data,i={data:Be({},t,{...e})};this.setLimitDetail(i)}get computedIsLimitOrSwapLabel(){return this.computedCurrentHistoryTabIsLimit?this.limitHistory:this.history}setSwapOrLimitHistory(e){this.computedCurrentHistoryTabIsLimit?this.setLimitHistory(e):this.setHistory(e)}get computedIsSingleChain(){return[c.SingleChain,c.GasStation,c.MemeMode].includes(Me(this,"detail.data.swapTradeType",""))}get computedIsGasStation(){return[c.GasStation,c.GasStationCross].includes(Me(this,"detail.data.swapTradeType",""))}get computedMainOrderType(){let e=this.detail.data,t="";if(!e)return t;let{swapTradeType:i,hiddenFromOrder:r,toChildOrderDetailVo:o}=e;return i!==c.CrossChain?t=i:r==="1"?t=c.BridgeTo:o?t=c.FromBridgeTo:t=c.FromBridge,t}get computedStepStatus(){let e=this.detail.data,t=r=>r?[d.Waiting,d.Pending].includes(r)?d.Pending:r:"",i=this.computedMainOrderType===c.BridgeTo?t(e?.bridgeChildOrderDetailVo?.status||""):e?.bridgeChildOrderDetailVo?.status||"";return[c.BridgeTo,c.CrossBridge].includes(this.computedMainOrderType)&&[d.Failed,d.Canceled].includes(e?.status)&&(i=e?.status),{fromSwapStatus:t(e?.fromChildOrderDetailVo?.status||""),bridgeStatus:i,toSwapStatus:e?.toChildOrderDetailVo?.status||""}}get computedRatio(){let e=this.detail?.data;if(!e)return{fromRatio:0,bridgeRatio:0};let{status:t}=e,i=this.computedStepStatus.bridgeStatus,r=this.computedStepStatus.fromSwapStatus;if(t===d.Succeed||t===d.Canceled||t===d.Failed&&this.computedMainOrderType===c.BridgeTo)return{fromRatio:1,bridgeRatio:1};let n=(this.fromStepCountDownTimeGroup.estimatedTimeTotal-this.fromStepCountDownTimeGroup.estimatedTime)/this.fromStepCountDownTimeGroup.estimatedTimeTotal;n=n>.8||this.fromStepCountDownTimeGroup.estimatedTimeTotal===0?.8:n;let a=(this.bridgeStepCountDownTimeGroup.estimatedTimeTotal-this.bridgeStepCountDownTimeGroup.estimatedTime)/this.bridgeStepCountDownTimeGroup.estimatedTimeTotal;return a=a>.8||this.bridgeStepCountDownTimeGroup.estimatedTimeTotal===0?.8:a,r!==d.Pending&&r!==d.SpeedingUp&&r!==d.Canceling&&(n=1),this.computedMainOrderType===c.FromBridgeTo&&i!==d.Pending&&i!==d.SpeedingUp&&i!==d.Canceling&&(a=0),i===d.Succeed&&(a=1),{fromRatio:n,bridgeRatio:a}}get computedFoldTipToast(){let e=this.detail?.data;if(!e)return{foldTipType:""};let{bridgeChildOrderDetailVo:t}=e,i=[],r=[],o=!1,n=!1,a=0,m=this.fromStepCountDownTimeGroup.estimatedTime,u=this.bridgeStepCountDownTimeGroup.estimatedTime,f=this.computedMainOrderType===c.FromBridge;this.computedSubOrders.forEach((k,T)=>{(k.tipType===U.from||k.tipType===U.bridge)&&i.push(k),k.errorCode!=="0"&&T<this.computedSubOrders.length-1&&r.push(k)});let h=-1;i.length>0&&(h=i[0]?.tipType),h===U.bridge&&(a=u),h===U.from&&(a=m),f&&h===U.bridge&&(a=0),h===U.from?n=m===0:h===U.bridge&&(n=u===0);let I={...t,refund:{amount:t?.refundAmount?A(t.refundAmount):"",symbol:t?.refundSymbol,chain:t?.refundChain}},g=h===U.bridge?I:i?.[0];return r.length>0&&(g=r[r.length-1],o=!0),{foldTipType:h,currentProcessIsTimeOut:n,tipCountDownTime:a,filterProcessItem:g,needShowErrorTip:o}}get computedSubOrders(){let e=this.detail.data;if(!e)return[];let{fromChildOrderDetailVo:t,bridgeChildOrderDetailVo:i}=e,{toChildOrderDetailVo:r,status:o,assetDelay:n}=e,a=this.computedStepStatus.bridgeStatus,m=this.computedStepStatus.fromSwapStatus,u=this.computedMainOrderType===c.BridgeTo,f=[t?.errorCode,i?.errorCode,r?.errorCode].filter(Boolean).some(C=>C!=="0"),h=this.computedMainOrderType===c.FromBridgeTo,I=this.computedMainOrderType===c.FromBridge,g=a===d.Pending||a===d.SpeedingUp||this.computedMainOrderType===c.CrossBridge&&o!==d.Failed&&o!==d.Canceled&&o!==d.Succeed||u&&a===d.Waiting?U.bridge:0,k=m===d.Pending||m===d.SpeedingUp?U.from:0,T={bridgeInfo:i?.bridgeOrderInfoVo,dexBridgeShadowTokenPair:i?.dexBridgeShadowTokenPairInfoVo,dexBridgeShadowTokenPairChainId:i?.toChainId,tipInfo:{toTokenSymbol:t?.toTokenSymbol},bridgeTipInfo:{bridgeName:i?.bridgeOrderInfoVo?.bridgeName||"",toChainName:i?.toChainName||""}};t={...t,status:this.computedStepStatus.fromSwapStatus};let P=i?.status;if(i={...i,status:this.computedStepStatus.bridgeStatus},this.computedIsSingleChain||this.computedMainOrderType===c.GasStationCross){let C=!1;this.timeoutTimestamp?C=!this.expireTime&&t.status===d.Pending:C=t.status===d.Pending;let L=this.computedMainOrderType===c.MemeMode;return[$(t,"from",{isFromStart:!0,hasTimeoutTips:C,timeoutType:G.SINGLE_TIPS,hasErrorCode:f}),$(t,"to",{...T,hiddenExploreUrl:!0,subOrderType:re.SINGLE,isMemeModeOrder:L,assetDelay:n,hasErrorCode:f})]}else if(this.computedMainOrderType===c.CrossBridge){let C=this.expireTime<1&&(i.status===d.Waiting||i.status===d.Pending);return[$(t,"to",{...T,tipType:g,useCurrencyInputFormat:!0,hasTimeoutTips:C,timeoutType:G[i.status===d.Pending?"BRIDGE":"GAS"],hasErrorCode:f}),$(i,"to",{...T,officialBridgeTime:i?.officialBridgeTime,hasErrorCode:f,subOrderType:re.CROSS_BRIDGE_SWAP})]}else if([c.BridgeTo,c.FromBridge,c.FromBridgeTo].includes(this.computedMainOrderType)){let C=this.expireTime<1&&r?.status===d.Pending,L=!this.fromStepCountDownTimeGroup.estimatedTime&&(t.status===d.Pending||P===d.Waiting),S=!1,y;u&&!this.bridgeStepCountDownTimeGroup.estimatedTime?P===d.Waiting?(S=!0,y=G.GAS):P===d.Pending&&(S=!0,y=G.BRIDGE):h&&t?.status===d.Succeed&&!this.bridgeStepCountDownTimeGroup.estimatedTime&&(i.status===d.Waiting?(S=!0,y=G.GAS):i.status===d.Pending&&(S=!0,y=G.BRIDGE));let M=[$(t,"from",{isFromStart:!0,ratio:this.computedRatio.fromRatio,showProgressBar:!0,tipType:k,hasTimeoutTips:L,timeoutType:G.SINGLE_TIPS,...T,hasErrorCode:f}),$(t,"to",{ratio:this.computedRatio.bridgeRatio,tipType:I&&L?0:g,showProgressBar:h||u,countDownTime:!u&&this.fromStepCountDownTimeGroup.estimatedTime,hasTimeoutTips:S,timeoutType:I?G.SINGLE_TIPS:y,...T,subOrderType:re.CROSS_FROM_SWAP,hasErrorCode:f}),$(i,"to",{...T,countDownTime:this.bridgeStepCountDownTimeGroup.estimatedTime,hasTimeoutTips:I?!1:C,timeoutType:G.SINGLE_TIPS,subOrderType:re.CROSS_BRIDGE_SWAP,hasErrorCode:f})];return u&&M.shift(),(u||h)&&M.push($(r,"to",{subOrderType:re.CROSS_TO_SWAP,hasErrorCode:f})),M}return[]}get computedDataDetail(){return this.computedCurrentHistoryTabIsLimit?this.limitDetail:this.detail}get computedLimitOrderInfo(){if(!this.limitDetail?.data)return null;let{swapTradeType:e,createTime:t,fromChildOrderDetailVO:i,price:r,transactionPrice:o,surplus:n,surplusUsdValue:a,totalGasFee:m,totalGasFeeUsdValue:u,transactionTime:f,exploreUrl:h,expireTime:I,userWalletAddress:g,failureReason:k,status:T,dealWarnTag:P,remainTime:C,timeoutToast:L}=this.limitDetail?.data,{fromTokenSymbol:S,toTokenSymbol:y,fromAmount:M,toAmount:W,fromChainLogoUrl:x,toChainLogoUrl:ee,fromTokenIcon:ae,toTokenIcon:z,fromChainName:de,failureReason:De}=i,Pe=[O.CANCELLED,O.EXPIRED,O.SUCCEED,O.FAILED].includes(T),j=k||De,K=R(M,{noNeedThousandth:!0}),Te=F(W,{needBillionMillionUnit:!1}),ge={fromAmount:1,fromSymbol:S,toAmount:F(o,{needBillionMillionUnit:!1}),toSymbol:y},Se={fromAmount:1,fromSymbol:y,toAmount:F(Xe(1).div(o).toString(),{needBillionMillionUnit:!1}),toSymbol:S},Ie={fromAmount:1,fromSymbol:S,toAmount:F(r,{needBillionMillionUnit:!1}),toSymbol:y},Ce={fromAmount:1,fromSymbol:y,toAmount:F(Xe(1).div(r).toString(),{needBillionMillionUnit:!1}),toSymbol:S};return{type:e,typeKey:"swaptrade_orders_text_limit_order",status:T,isSuccess:T===O.SUCCEED,isFailed:T===O.FAILED,isSupplyFailed:T===O.FAILED&&j===qe.NO_SUPPLY,isOtherFailed:T===O.FAILED&&j!==qe.NO_SUPPLY&&!!j,fromTokenGroupLabel:`${he("-",K)} ${S}`,fromTokenGroupLabelEquation:`${he("-",K)} ${E(S)}`,toTokenGroupLabel:`${he("+",Te)} ${y}`,toTokenGroupLabelEquation:`${he("+",Te)} ${E(y)}`,fromChainLogoUrl:x,fromTokenIcon:ae,toChainLogoUrl:ee,toTokenIcon:z,createTime:t?X(t,{format:"yyyyMMddHHmmss"}):"",expireTime:I?X(I,{format:"yyyyMMddHHmmss"}):"",txTime:f?X(f,{format:"yyyyMMddHHmmss"}):"",networksName:de,networksLogo:x,price:ce(Ie),reversePrice:ce(Ce),priceEquation:le(Ie),reversePriceEquation:le(Ce),execPrice:o?ce(ge):we,reverseExecPrice:ce(Se),execPriceEquation:o?le(ge):we,reverseExecPriceEquation:le(Se),fee:m?oe({amount:F(m),symbol:S,extra:this.getLocalPriceFee(1,u,!0)}):we,surplus:n?oe({amount:F(n),symbol:y,extra:this.getLocalPriceFee(1,a,!0)}):"",originAddress:g,formatAddress:`${g.substr(0,6)}...${g.substr(g.length-4)}`,exploreUrl:h,fromTokenSymbol:S,failureReason:j,dealWarnTag:P,remainTime:C,timeoutToast:L,showSwapAgainBtn:Pe}}get computedLimitFromToInfo(){let e=this.limitDetail?.data;if(!e)return null;let{fromChildOrderDetailVO:t,userWalletAddress:i,swapTradeType:r}=e,{fromChainId:o,fromTokenContractAddress:n,toChainId:a,toTokenContractAddress:m}=t;return{apiRequestParams:{fromChainId:o,toChainId:a,userWalletAddress:i,swapTradeType:r},locationParams:{from:{chainId:o,tokenContractAddress:n},to:{chainId:a,tokenContractAddress:m}}}}get computedSwapFromToInfo(){let e=this.detail?.data;if(!e)return null;let{fromChainId:t,fromTokenAddress:i,toChainId:r,toTokenAddress:o,swapTradeType:n,from:a}=e;return{apiRequestParams:{fromChainId:t,toChainId:r,userWalletAddress:a,swapTradeType:n},locationParams:{from:{chainId:t,tokenContractAddress:i},to:{chainId:r,tokenContractAddress:o},inputAmount:this.computedIfSwapFailedAmount||ht}}}get computedFromToInfo(){return this.computedCurrentHistoryTabIsLimit?this.computedLimitFromToInfo:this.computedSwapFromToInfo}getForRefuelFromPrice(e){return e&&!me(e)?A(e):"--"}getReceiveTokenPrice(e){return e&&!me(e)?A(e):"--"}getExplorerUrl(e){return this.computedIsSingleChain?e?.exploreUrl:""}getOrderFinnishedTime(e,t,i){return[d.Succeed].includes(i)?yt(t-e):"--"}getFormattedNetworkFee(e){return e?A(e):""}getFormattedOtherFees(e){return e?A(e):""}getOtherFees(e,t){return e&&t?.fromTokenSymbol?`${e} ${t.fromTokenSymbol}`:""}getBridgeFee(e,t){return e?`${e} ${t?.toTokenSymbol}`:""}getBridgeFeeUsd(e,t,i){return _t(e(t).toString(),i)}getEstimateBridgeFeeAmount(e,t){return e?`${A(e)} ${t}`:""}getEstimateBridgeFeeAmountUsd(e,t,i){return e?Ee(i(e).toString(),t):""}getToSwapFee(e,t,i,r){return e?oe({amount:e,symbol:t,extra:this.getLocalPriceFee(i,r)}):""}getFromToPrice(e){return e&&!me(e)&&e!=="-1"?A(Xe("1").div(e).toString(10),{needBillionMillionUnit:!1}):"--"}getToFromPrice(e){return e&&!me(e)&&e!=="-1"?A(e,{needBillionMillionUnit:!1}):"--"}getGasToken(e,t,i,r,o){return!e||e===_i?null:{amount:t,symbol:i,status:e,exploreUrl:r,logoUrl:o}}get computedOrderInfo(){if(!this.detail.data)return null;let{swapTradeType:e,time:t,fromChainName:i,fromChainLogoUrl:r,fromChildOrderDetailVo:o,toChainName:n,toChainLogoUrl:a,networkFee:m,nativeTokenSymbol:u,otherFees:f,from:h,forRefuelFromAmount:I,fromTokenSymbol:g,toTokenSymbol:k,bridgeChildOrderDetailVo:T,receiveTokenStatus:P,receiveTokenExploreUrl:C,receiveTokenAmount:L,receiveTokenSymbol:S,abnormalStatus:y,hiddenFromOrder:M,bridgeFee:W,bridgeFeeUsd:x,estimateBridgeFeeAmount:ee,estimateBridgeFeeAmountUsd:ae,toSwapFee:z,toChainNativeTokenSymbol:de,hiddenOtherFee:De,toChildOrderDetailVo:Pe,price:j,receiveWalletAddress:K,gasStationActivityReward:Te,fromGasTokenPriceUsd:ge,toGasTokenPriceUsd:Se,receiveTokenLogoUrl:Ie,errorCode:Ce,status:ye,orderCompletionTime:Mt,orderId:Bt,specialOrderType:Nt,mevInfo:xt,fromSwapMevInfo:Gt,toSwapMevInfo:Ut,assetDelay:vt,assetDelayTime:Vt,isMemeTimeOut:Wt,totalSlippage:Ht,dexGasStationFeeDetailVO:Fe,freeGas:et,estimatedTime:$t,serviceFeeUsd:qt,serviceFeeRate:Yt,isDisplayServiceFee:zt}=this.detail.data,jt=String(et)===At.FREE,Kt=this.detail.data?.defiPlatformInfo,{currencyConversion:tt,computedNowCurrencySymbol:it,currencyConversionWithSymbol:Qt}=this.commonStore,Jt=Qt(qt),Xt=Z.thousandFormat(Number(Yt),{style:"percent"}),Zt=String(zt)==="1",rt=[{chainName:i,chainLogo:r}];this.computedIsSingleChain||rt.push({chainName:n,chainLogo:a});let ot=this.getFormattedNetworkFee(m),ei=this.getFormattedOtherFees(f),ti=je(W),ii=je(z),st=e===c.MemeMode,ri=[d.Succeed,d.Failed,d.Canceled].includes(ye),oi=![c.GasStation,c.GasStationCross].includes(e),si=this.checkSwapAgainBtn({isOrderFinalized:ri,isNotGasStationTrade:oi,isMemeModeOrder:st}),ni=()=>{if(this.computedIsGasStation&&Fe){let{gasTokenSymbol:ai,gasTokenPriceUSD:di,totalGasFeeAmount:nt}=Fe||{},at=A(nt);return at?oe({amount:at,symbol:ai,extra:this.getLocalPriceFee(nt,di)}):"--"}return ot?oe({amount:ot,symbol:u,extra:this.getLocalPriceFee(m,this.computedIsGasStation?"":ge)}):"--"};return{isSingleChain:this.computedIsSingleChain,type:e,typeKey:Ei[e],time:X(t,{format:"yyyyMMddHHmmss"}),networks:rt,assetDelay:vt,assetDelayTime:Vt,isMemeTimeOut:Wt,isMemeModeOrder:st,networkFee:ni(),otherFees:this.getOtherFees(ei,T),bridgeFee:this.getBridgeFee(ti,T),bridgeName:T?.bridgeOrderInfoVo?.bridgeName,bridgeLogo:T?.bridgeOrderInfoVo?.bridgeLogo,bridgeFeeUsd:this.getBridgeFeeUsd(tt,x,it),estimateBridgeFeeAmount:this.getEstimateBridgeFeeAmount(ee,u),estimateBridgeFeeAmountUsd:this.getEstimateBridgeFeeAmountUsd(ae,it,tt),toSwapFee:this.getToSwapFee(ii,de,z,Se),fromToPrice:this.getFromToPrice(j),toFromPrice:this.getToFromPrice(j),from:h,receiveWalletAddress:K,fromSymbol:g,toSymbol:k,omittedFrom:`${h.substr(0,6)}...${h.substr(h.length-4)}`,omittedTo:`${K.substr(0,6)}...${K.substr(K.length-4)}`,gasToken:this.getGasToken(P,L,S,C,Ie),abnormalStatus:y,hiddenFromOrder:M,hiddenOtherFee:De,hasToChildOrderDetailVo:!!Pe,forRefuelFromPrice:this.getForRefuelFromPrice(I),receiveTokenPrice:this.getReceiveTokenPrice(L),receiveTokenStatus:P,gasStationActivityReward:Te,exploreUrl:this.getExplorerUrl(o),errorCode:Ce,orderFinishedTime:this.getOrderFinnishedTime(t,Mt,ye),status:ye,showSwapAgainBtn:si,orderId:Bt,fromChainName:i,specialOrderType:Nt,mevInfo:xt,fromSwapMevInfo:Gt,toSwapMevInfo:Ut,totalSlippage:Ht,defiPlatformInfo:Kt,isIntentOrder:jt,dexGasStationFeeDetailTips:this.getDexGasStationFeeDetailTip(Fe,ye),freeGas:et,estimatedTime:$t,serviceFeeUsd:Jt,serviceFeeRate:Xt,isDisplayServiceFee:Zt}}get computedPendingOrdersCount(){return this.pendingOrders.filter(t=>t.status!==d.PendingCanRedeem).length}get computedOrdersHasFacetSwap(){let e=this.pendingOrders.find(t=>t.status==d.PendingCanRedeem);return{showTip:!!e,data:e||{}}}get computedPendingTimingStatus(){return this.timeoutTimestamp?this.expireTime!==0&&this.timeoutTimestamp?ue.ESTIMATE:!this.expireTime&&this.timeoutTimestamp?ue.EXCEED_ESTIMATE:!this.expireTime&&!this.timeoutTimestamp?ue.TIMEOUT:1:ue.TIMEOUT}toastOrder(e){if(e){let{status:t,orderId:i,fromAmount:r,fromTokenSymbol:o,toAmount:n,toTokenSymbol:a,fromChildOrder:m,receiveTokenStatus:u,type:f,swapTradeType:h,isMemeTimeOut:I,exploreUrl:g,assetDelay:k}=e,T=`${i}_${t}`;if(We()||H.includes(T))return;let P=h===c.MemeMode,C=()=>{H.unshift(T),H=H.slice(0,Dt)},L=u!==bi;if(t===d.Pending&&m?.status===d.Pending){if(C(),P&&I){Lt({title:w("swaptrade_history_modal_error_likely_fail",{num:r,token1:o,token2:a})});return}se({title:w("wallet_swap_toast_swap_submitted")})}else if(t===d.Succeed&&L){let S=this.computedSubOrders;if(C(),P&&k){se({title:w("swaptrade_history_modal_tips_swap_update",{num1:r,token1:o,num2:n,token2:a}),exploreUrl:g});return}se({title:w("swaptrade_toast_swap_success",{fromCount:R(r,{needBillionMillionUnit:!0}),fromToken:E(o),toCount:A(n),toToken:E(a)}),exploreUrl:S[S.length-1]?.exploreUrl})}else if(t===d.Failed&&L){let y=this.computedSubOrders.filter(M=>M.status===d.Failed);C(),Le({title:f==="gasStation"?w("swaptrade_gasstation_toast_refill_failed",{nativeToken:E(a)}):w("wallet_swap_toast_swap_failed"),exploreUrl:y[y.length-1]?.exploreUrl})}else t===d.Canceled&&L&&(se({title:w("swaptrade_placeorder_toast_transaction_canceled")}),C())}}toastLimitOrder(e){if(e){let{status:t,orderId:i,fromChildOrderDetailVO:r,failureReason:o}=e,{fromAmount:n,fromTokenSymbol:a,toAmount:m,toTokenSymbol:u,failureReason:f,exploreUrl:h}=r,I=`${i}_${t}`;if(H.includes(I))return;let g=()=>{H.unshift(I),H=H.slice(0,Dt)};t===O.OPEN?(g(),Je({title:w("swaptrade_orders_notif_limitorder_submitted",{sellValue:R(n,{needBillionMillionUnit:!0}),sellToken:E(a),receiveValue:F(m),receiveToken:E(u)})})):t===O.SUCCEED?(g(),se({title:w("swaptrade_orders_notif_limitorder_success",{sellValue:R(n,{needBillionMillionUnit:!0}),sellToken:a,receiveValue:F(m),receiveToken:u}),exploreUrl:h})):t===O.FAILED&&o?(g(),Le({title:w("swaptrade_orders_notif_limitorder_failed",{sellValue:R(n,{needBillionMillionUnit:!0}),sellToken:E(a),receiveValue:F(m),receiveToken:E(u)})})):t===O.FAILED&&f?(g(),Le({title:w("swaptrade_orders_notif_limitorder_failed",{sellValue:R(n,{needBillionMillionUnit:!0}),sellToken:E(a),receiveValue:F(m),receiveToken:E(u)}),exploreUrl:h})):t===O.CANCELLED?(Je({title:w("swaptrade_orders_notif_limitorder_canceled",{sellValue:R(n,{needBillionMillionUnit:!0}),sellToken:E(a),receiveValue:F(m),receiveToken:E(u)})}),g()):t===O.EXPIRED&&(kt({title:w("swaptrade_orders_notif_limitorder_expired",{sellValue:R(n,{needBillionMillionUnit:!0}),sellToken:E(a),receiveValue:F(m),receiveToken:E(u)}),exploreUrl:h}),g())}}get computedCurrentHistoryTabIsLimit(){return this.historyTab===p.LIMIT_ORDER}get computedOrigin(){return this.historyTab===p.LIMIT_ORDER?p.LIMIT_ORDER:[c.SingleChain,c.GasStation].includes(this.computedMainOrderType)?p.SWAP:p.BRIDGE}get computedIfSwapFailedAmount(){let e=this.detail?.data;return e?.status===d.Failed&&!this.computedCurrentHistoryTabIsLimit&&Oe(e?.fromAmount)?e.fromAmount:""}},Sr=Ze;_();b();var br="",wr="hide_detail_alert";_();b();Ne();Ge();_();b();function Ft(l){return![...Object.values(l?.from||{}),...Object.values(l?.to||{})].some(e=>e)}_();b();Ne();var vr=(l,e)=>!!l.find(i=>Number(e)===Number(i.chainId)),Rt=l=>{if(!l)return!1;let{fromChainId:e,toChainId:t,fromTokenAddress:i,toTokenAddress:r}=l,o=[D(e)&&i,D(t)&&r];return!!dt(o,Boolean)};var Ai=()=>({from:{chainId:null,tokenContractAddress:null},to:{chainId:null,tokenContractAddress:null}}),eo={BRIDGE:"bridge",SWAP:"swap"},Y=class{constructor(e,t={},i={}){s(this,"setTab",e=>{this.tab=e});s(this,"hasFromToToken",e=>this.tab===p.LIMIT_ORDER?!Q(e?.data?.fromToken)&&!Q(e?.data?.toToken):!Q(e?.data?.fromTokenInfo)&&!Q(e?.data?.toTokenInfo));s(this,"getWidgetVersionParams",()=>!this.config.widgetVersion||this.tab===p.LIMIT_ORDER?{}:this.tab===p.BRIDGE?{widgetVersion:this.config.widgetVersion}:{widgetVersion:this.config.widgetVersion,widgetChainIds:this.config.widgetChainIds});s(this,"fetchSingleChainTokens",async({fromTokenAddress:e,toTokenAddress:t,chainId:i})=>{let[r,o]=await B(N.get(St,{params:{fromTokenAddress:e,toTokenAddress:t,chainId:i,...this.getWidgetVersionParams()}}));return[r,o]});s(this,"generateSingleChainTokenPair",async({walletChainId:e,...t})=>{let r={chainId:D(t.fromChainId)?t.fromChainId:t.toChainId,fromTokenAddress:t.fromTokenAddress,toTokenAddress:t.toTokenAddress};if(D(r.chainId)){let[a,m]=await this.fetchSingleChainTokens(r);if(!a&&this.hasFromToToken(m))return[a,m]}if(D(e)){let[a,m]=await this.fetchSingleChainTokens({chainId:e});if(!a&&this.hasFromToToken(m))return[a,m]}let[o,n]=await this.fetchSingleChainTokens({chainId:be});return[o,n]});s(this,"fetchCrossChainTokens",async({fromChainId:e,toChainId:t,fromTokenAddress:i,toTokenAddress:r})=>{let[o,n]=await B(N.get(ze,{params:{chainId:e,toChainId:t,fromTokenAddress:i,toTokenAddress:r,...this.getWidgetVersionParams()}}));return[o,n]});s(this,"generateCrossChainTokenPair",async({walletChainId:e,...t})=>{if(D(t.fromChainId)||D(t.toChainId)){let o={...t},{hasFrom:n,hasTo:a}=Y.checkTokenParams({chainId:t.fromChainId,tokenContractAddress:t.fromTokenAddress},{chainId:t.toChainId,tokenContractAddress:t.toTokenAddress});bt(t.fromChainId,t.toChainId)&&(n?o={fromChainId:t.fromChainId,fromTokenAddress:t.fromTokenAddress}:a&&(o={toChainId:t.toChainId,toTokenAddress:t.toTokenAddress}));let[m,u]=await this.fetchCrossChainTokens(o);if(!m&&this.hasFromToToken(u))return[m,u]}if(D(e)){let[o,n]=await this.fetchCrossChainTokens({fromChainId:e});if(!o&&this.hasFromToToken(n))return[o,n]}let[i,r]=await this.fetchCrossChainTokens({fromChainId:be});return[i,r]});s(this,"fetchLimitOrderRecommendTokens",async({fromChainId:e,toChainId:t,fromTokenAddress:i,toTokenAddress:r})=>{let[o,n]=await B(N.get(It,{params:{fromChainId:e,toChainId:t,fromTokenAddress:i,toTokenAddress:r}}));return[o,n]});s(this,"generateLimitOrderTokenPair",async({walletChainId:e,...t})=>{let i=D(t.fromChainId),o=D(t.toChainId)?t.fromChainId===t.toChainId:!0;if(i&&o){let[m,u]=await this.fetchLimitOrderRecommendTokens(t);if(!m&&this.hasFromToToken(u))return[m,u]}if(D(e)){let[m,u]=await this.fetchLimitOrderRecommendTokens({fromChainId:e});if(!m&&this.hasFromToToken(u))return[m,u]}let[n,a]=await this.fetchLimitOrderRecommendTokens({fromChainId:be,fromTokenAddress:""});return[n,a]});s(this,"getTokenPairByResponseData",e=>this.tab===p.LIMIT_ORDER?{from:e?.fromToken,to:e?.toToken}:{from:e?.fromTokenInfo,to:e?.toTokenInfo});s(this,"generateTokenAndTabConfig",({error:e,data:t})=>{if(e)return{error:e,from:null,to:null,tab:this.tab};let{from:i,to:r}=this.getTokenPairByResponseData(t);return{error:null,from:i,to:r,tab:this.tab}});s(this,"checkInputAmount",e=>{let t=Z.BigNumber(e);return!t.isNaN()&&t.isFinite()&&t.gt(0)?t.toString():""});s(this,"generateInitConfigByParams",async({from:e,to:t,inputAmount:i,walletChainId:r})=>{let o=this.checkInputAmount(i),n={fromChainId:e.chainId,toChainId:t.chainId,fromTokenAddress:e.tokenContractAddress,toTokenAddress:t.tokenContractAddress,walletChainId:r};if(this.tab===p.BRIDGE){let[a,m]=await this.generateCrossChainTokenPair(n);return{...this.generateTokenAndTabConfig({error:a,data:m.data}),inputAmount:o}}if(this.tab===p.SWAP){let[a,m]=await this.generateSingleChainTokenPair(n);return{...this.generateTokenAndTabConfig({error:a,data:m.data}),inputAmount:o}}if(this.tab===p.LIMIT_ORDER){let[a,m]=await this.generateLimitOrderTokenPair(n);return{...this.generateTokenAndTabConfig({error:a,data:m.data}),inputAmount:o}}return{error:new Error("tab is not valid"),from:null,to:null,tab:this.tab,inputAmount:o}});this.setTab(e),this.dexParams=t,this.config=i}makeDexParams(){let{dexParams:e}=this;return Ft(e)?this.readInfoFromLocalStorage():e}async initTokenPair(e){let t=this.makeDexParams(),{from:i,to:r,tab:o,inputAmount:n,error:a}=await this.generateInitConfigByParams({...t,walletChainId:e});return{from:i,to:r,tab:o,inputAmount:n,error:a}}async switchTabAndInitToken(e){let t=this.makeDexParams(),{from:i,to:r,tab:o,inputAmount:n,error:a}=await this.generateInitConfigByParams({...t,tab:e});return{from:i,to:r,tab:o,inputAmount:n,error:a}}readInfoFromLocalStorage(){let e=Ai(),t;switch(this.tab){case p.SWAP:t=v.get(Ue);break;case p.BRIDGE:t=v.get(ve);break;case p.LIMIT_ORDER:t=v.get(Ve)||v.get($e)?.LIMIT_ORDER;break;default:break}let i={from:{...e.from,...t?.from},to:{...e.to,...t?.to}};return t?.from?.tokenContractAddress?i:e}writeTabInfoToLocalStorage(e){Y.writeTabInfoToLocalStorage(this.tab,e)}static writeTabInfoToLocalStorage(e,t){switch(e){case p.SWAP:v.set(Ue,t);break;case p.BRIDGE:v.set(ve,t);break;case p.LIMIT_ORDER:v.set(Ve,t);break;default:break}}},q=Y;s(q,"checkTokenParams",(e,t)=>{let i=Rt({fromChainId:e?.chainId,toChainId:t?.chainId,fromTokenAddress:e?.tokenContractAddress,toTokenAddress:t?.tokenContractAddress}),r=D(e?.chainId)&&!!e?.tokenContractAddress,o=D(t?.chainId)&&!!t?.tokenContractAddress;return{isValid:i,hasFrom:r,hasTo:o}}),s(q,"judgeTabTypeByChainId",async e=>{let[t,i]=await B(N.get(Ct));if(t)return p.SWAP;let{swap:r=[],bridge:o=[]}=i.data;return r.includes(Re(e))?p.SWAP:o.includes(Re(e))?p.BRIDGE:p.SWAP}),s(q,"judgeTabTypeByParams",async(e,t)=>{let{isValid:i,hasFrom:r,hasTo:o}=Y.checkTokenParams(e,t);if(!i)return p.SWAP;let n=e?.chainId,a=t?.chainId;if(r&&o)return n===a?p.SWAP:p.BRIDGE;let m;return r&&!o&&(m=n),!r&&o&&(m=a),await Y.judgeTabTypeByChainId(m)}),s(q,"formatDialogParams",e=>({from:{chainId:e?.fromChainId,tokenContractAddress:e?.fromTokenAddress},to:{chainId:e?.toChainId,tokenContractAddress:e?.toTokenAddress}})),s(q,"getDialogInitTab",async e=>{let{from:t,to:i}=Y.formatDialogParams(e);return await Y.judgeTabTypeByParams(t,i)});var to=q;export{vr as a,eo as b,to as c,ki as d,ue as e,Li as f,G as g,re as h,ke as i,Ke as j,ce as k,le as l,he as m,se as n,Le as o,d as p,c as q,U as r,Sr as s,br as t,wr as u};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-J4KP2IFN.js.map
