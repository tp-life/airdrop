import{b as c}from"./chunk-G4TAWZEB.js";import{ga as H,ia as O}from"./chunk-NTISK7TT.js";import{na as j,oa as st}from"./chunk-KSCBZ3RY.js";import{d as E,f as at}from"./chunk-37O7OMRA.js";import{F as C,Q as D,pa as rt}from"./chunk-LBCQTFOD.js";import{N as ot,m as N}from"./chunk-V63HWKAL.js";import{a as nt}from"./chunk-5LMNZ6ME.js";import{f as et,m as a,o as n}from"./chunk-UGZFXKPB.js";a();n();rt();at();var W="txHistoryRejectValues",it={hideValuelessNft:"hideValuelessNft"},Lt={NORMAL:0,RISKY:1,VALUELESS:2},A={[it.hideValuelessNft]:!0},v=async()=>{try{return await E().getSelectedWallet()}catch{return null}},q=()=>{try{let t=localStorage.getItem(W);return t?JSON.parse(t)??{}??{}:{}}catch{return{}}},J=(t={})=>{try{let e=JSON.stringify(t);return localStorage.setItem(W,e),!0}catch{return!1}},mt=async(t,e)=>{try{let r=await v();if(!r)return!1;let o=q(),s={[r]:{[t]:e}};return J(D({},o,s))}catch{return!1}},K=async()=>{let t=await v();if(!t)return{};let e=q(),r=e?.[t]??{};if(C(r)){let o={[t]:A};return J(D({},e,o)),A}return r};a();n();var U=et(nt());a();n();ot();a();n();st();a();n();function lt(t){return async(e,r)=>{await e(p({...t,dates:c().stringDates,needMore:!0})),await e(w(!0));let o=r();e(R(P(o)))}}var d=j({name:"txHistory",initialState:{filters:{status:[1,2,3,4],dates:c().stringDates,mainCoinId:"",init:!0,needMore:!0},txList:[],initLoading:!0,scrollLoading:!1,filterLoading:!1,lastRowId:""},reducers:{setInitLoading:(t,e)=>{t.initLoading=e.payload},setScrollLoading:(t,e)=>{t.scrollLoading=e.payload},setFilterLoading:(t,e)=>{t.filterLoading=e.payload},setFilters:(t,e)=>{t.filters={...t.filters,...e.payload,init:!1}},setLastRowId:(t,e)=>{t.lastRowId=e.payload},setTxList:(t,e)=>{t.txList=e.payload},mergeTxList:(t,e)=>{t.txList=[...t.txList,...e.payload]},resetFilters(t){t.filters={status:[1,2,3,4],dates:c().stringDates,mainCoinId:"",init:!0,needMore:!0}},resetTxHistory:t=>{t.txList=[],t.initLoading=!1,t.scrollLoading=!1,t.filterLoading=!1,t.lastRowId=""}}}),{actions:ct,reducer:dt}=d,ht=dt,Mt=t=>t[d.name].txList,S=t=>t[d.name].filters,P=t=>{let e=S(t),{dates:[r,o],mainCoinId:s}=e;return{startDate:new Date(`${r} 00:00:00`).getTime(),endDate:new Date(`${o} 23:59:59`).getTime(),mainCoinId:s,status:[1,2,3,4]}},Y=t=>t[d.name].initLoading,$=t=>t[d.name].scrollLoading,b=t=>t[d.name].lastRowId,Ct=t=>t[d.name].filterLoading,{setFilters:p,setTxList:F,mergeTxList:V,setInitLoading:T,setScrollLoading:I,setFilterLoading:w,resetTxHistory:Nt,setLastRowId:f,resetFilters:jt}=ct;var k=({scrollLoad:t,lastRowId:e,scrollLoading:r,initLoading:o,needMore:s,fromCoinDetail:i})=>!(t&&((i?!e:!e&&!s)||r||o)),B=(t,{needMore:e,fromCoinDetail:r,hasViewMore:o,rowId:s})=>{e&&!r&&!o&&(t(p({dates:c(N.subtract(180,"d"))?.stringDates,needMore:!1})),t(f(s)))},G=async(t,{reqParams:e,lastRowId:r,scrollLoad:o,fromCoinDetail:s})=>{if(o&&(t(I(!0)),e.lastRowId=r),!s)try{let i=await K();e.hideValuelessNft=i?.hideValuelessNft??!0}catch(i){console.error(i)}return e};var R=(t,e={initLoad:!1,scrollLoad:!1,autoRefresh:!1,fromCoinDetail:!1,hasMoreData:!0,hasInitData:!0})=>async(r,o)=>{let s={...t},{initLoad:i,scrollLoad:u,fromCoinDetail:g,hasMoreData:_,hasInitData:z}=e,Q=g?O:H,L=o(),h=b(L),{needMore:y}=S(L),X=Y(L),Z=$(L);if(!(!_&&(z||!y)||!k({scrollLoad:u,lastRowId:h,scrollLoading:Z,initLoading:X,needMore:y,fromCoinDetail:g}))){i&&(r(T(!0)),r(f(""))),await G(r,{reqParams:s,lastRowId:h,scrollLoad:u,fromCoinDetail:g});try{let m=await Q(s),l=m?.content;(0,U.isEmpty)(l)&&(l=[]),r(u?V(l):F(l));let M=l.length,tt=m.hasViewMore?l[M-1]?.rowId:"";r(f(tt)),B(r,{needMore:y,fromCoinDetail:g,hasViewMore:m.hasViewMore,rowId:l[M-1]?.rowId})}catch{r(u?V([]):F([]))}i&&r(T(!1)),u&&r(I(!1)),r(w(!1))}};export{it as a,Lt as b,mt as c,K as d,R as e,lt as f,ht as g,Mt as h,S as i,P as j,Y as k,$ as l,b as m,Ct as n,p as o,F as p,T as q,Nt as r,f as s,jt as t};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-DD7QHK7G.js.map
