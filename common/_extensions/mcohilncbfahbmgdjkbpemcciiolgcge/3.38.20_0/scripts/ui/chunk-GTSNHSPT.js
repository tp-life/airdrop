import{a as de}from"./chunk-LRVKM4IV.js";import{p as v,q as ee,r as T}from"./chunk-PVSNAFN3.js";import{o as Ve}from"./chunk-A3FIPWG3.js";import{ac as Ke,bb as re,ob as te}from"./chunk-NTISK7TT.js";import{c as ne,d as ae,g as se}from"./chunk-MXRUZQZ7.js";import{a as qe}from"./chunk-QZUNX5I4.js";import{La as W,Pa as He,ta as z,ua as X,ya as Le}from"./chunk-KSCBZ3RY.js";import{c as O,d as I,f as Pe}from"./chunk-37O7OMRA.js";import{a as ce,b as oe,c as ie,d as le,e as ue}from"./chunk-DHNKVM4B.js";import{c as C,e as A}from"./chunk-VL5VJIZ7.js";import{$ as q,Oc as Y,Uc as J,W as M,Wa as G,Wc as De,Xc as Z,Y as P,Ya as Q,Yc as Ue,Z as H,_ as K,ca as V,rc as B,xc as Re,zc as w}from"./chunk-YILNSICT.js";import{H as x}from"./chunk-L4N7WJIQ.js";import{pa as je,x as U}from"./chunk-LBCQTFOD.js";import{N as $e,w as F}from"./chunk-V63HWKAL.js";import{a as Ge,b as Qe,c as ze}from"./chunk-ZZ2UZY4M.js";import{a as ke}from"./chunk-B75PPTYD.js";import{c as D,f as E,m as d,o as f}from"./chunk-UGZFXKPB.js";var ge=D((mr,ye)=>{"use strict";d();f();var me="%[a-f0-9]{2}",fe=new RegExp(me,"gi"),pe=new RegExp("("+me+")+","gi");function j(e,r){try{return decodeURIComponent(e.join(""))}catch{}if(e.length===1)return e;r=r||1;var t=e.slice(0,r),n=e.slice(r);return Array.prototype.concat.call([],j(t),j(n))}function Xe(e){try{return decodeURIComponent(e)}catch{for(var r=e.match(fe),t=1;t<r.length;t++)e=j(r,t).join(""),r=e.match(fe);return e}}function Ye(e){for(var r={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},t=pe.exec(e);t;){try{r[t[0]]=decodeURIComponent(t[0])}catch{var n=Xe(t[0]);n!==t[0]&&(r[t[0]]=n)}t=pe.exec(e)}r["%C2"]="\uFFFD";for(var a=Object.keys(r),c=0;c<a.length;c++){var s=a[c];e=e.replace(new RegExp(s,"g"),r[s])}return e}ye.exports=function(e){if(typeof e!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch{return Ye(e)}}});var xe=D(u=>{"use strict";d();f();var Je=Ge(),Ze=ge(),Ie=Qe(),ve=ze(),er=e=>e==null,k=Symbol("encodeFragmentIdentifier");function rr(e){switch(e.arrayFormat){case"index":return r=>(t,n)=>{let a=t.length;return n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[l(r,e),"[",a,"]"].join("")]:[...t,[l(r,e),"[",l(a,e),"]=",l(n,e)].join("")]};case"bracket":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[l(r,e),"[]"].join("")]:[...t,[l(r,e),"[]=",l(n,e)].join("")];case"colon-list-separator":return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,[l(r,e),":list="].join("")]:[...t,[l(r,e),":list=",l(n,e)].join("")];case"comma":case"separator":case"bracket-separator":{let r=e.arrayFormat==="bracket-separator"?"[]=":"=";return t=>(n,a)=>a===void 0||e.skipNull&&a===null||e.skipEmptyString&&a===""?n:(a=a===null?"":a,n.length===0?[[l(t,e),r,l(a,e)].join("")]:[[n,l(a,e)].join(e.arrayFormatSeparator)])}default:return r=>(t,n)=>n===void 0||e.skipNull&&n===null||e.skipEmptyString&&n===""?t:n===null?[...t,l(r,e)]:[...t,[l(r,e),"=",l(n,e)].join("")]}}function tr(e){let r;switch(e.arrayFormat){case"index":return(t,n,a)=>{if(r=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),!r){a[t]=n;return}a[t]===void 0&&(a[t]={}),a[t][r[1]]=n};case"bracket":return(t,n,a)=>{if(r=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"colon-list-separator":return(t,n,a)=>{if(r=/(:list)$/.exec(t),t=t.replace(/:list$/,""),!r){a[t]=n;return}if(a[t]===void 0){a[t]=[n];return}a[t]=[].concat(a[t],n)};case"comma":case"separator":return(t,n,a)=>{let c=typeof n=="string"&&n.includes(e.arrayFormatSeparator),s=typeof n=="string"&&!c&&m(n,e).includes(e.arrayFormatSeparator);n=s?m(n,e):n;let o=c||s?n.split(e.arrayFormatSeparator).map(p=>m(p,e)):n===null?n:m(n,e);a[t]=o};case"bracket-separator":return(t,n,a)=>{let c=/(\[\])$/.test(t);if(t=t.replace(/\[\]$/,""),!c){a[t]=n&&m(n,e);return}let s=n===null?[]:n.split(e.arrayFormatSeparator).map(o=>m(o,e));if(a[t]===void 0){a[t]=s;return}a[t]=[].concat(a[t],s)};default:return(t,n,a)=>{if(a[t]===void 0){a[t]=n;return}a[t]=[].concat(a[t],n)}}}function We(e){if(typeof e!="string"||e.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function l(e,r){return r.encode?r.strict?Je(e):encodeURIComponent(e):e}function m(e,r){return r.decode?Ze(e):e}function Ae(e){return Array.isArray(e)?e.sort():typeof e=="object"?Ae(Object.keys(e)).sort((r,t)=>Number(r)-Number(t)).map(r=>e[r]):e}function he(e){let r=e.indexOf("#");return r!==-1&&(e=e.slice(0,r)),e}function nr(e){let r="",t=e.indexOf("#");return t!==-1&&(r=e.slice(t)),r}function Ee(e){e=he(e);let r=e.indexOf("?");return r===-1?"":e.slice(r+1)}function we(e,r){return r.parseNumbers&&!Number.isNaN(Number(e))&&typeof e=="string"&&e.trim()!==""?e=Number(e):r.parseBooleans&&e!==null&&(e.toLowerCase()==="true"||e.toLowerCase()==="false")&&(e=e.toLowerCase()==="true"),e}function Fe(e,r){r=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},r),We(r.arrayFormatSeparator);let t=tr(r),n=Object.create(null);if(typeof e!="string"||(e=e.trim().replace(/^[?#&]/,""),!e))return n;for(let a of e.split("&")){if(a==="")continue;let[c,s]=Ie(r.decode?a.replace(/\+/g," "):a,"=");s=s===void 0?null:["comma","separator","bracket-separator"].includes(r.arrayFormat)?s:m(s,r),t(m(c,r),s,n)}for(let a of Object.keys(n)){let c=n[a];if(typeof c=="object"&&c!==null)for(let s of Object.keys(c))c[s]=we(c[s],r);else n[a]=we(c,r)}return r.sort===!1?n:(r.sort===!0?Object.keys(n).sort():Object.keys(n).sort(r.sort)).reduce((a,c)=>{let s=n[c];return Boolean(s)&&typeof s=="object"&&!Array.isArray(s)?a[c]=Ae(s):a[c]=s,a},Object.create(null))}u.extract=Ee;u.parse=Fe;u.stringify=(e,r)=>{if(!e)return"";r=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},r),We(r.arrayFormatSeparator);let t=s=>r.skipNull&&er(e[s])||r.skipEmptyString&&e[s]==="",n=rr(r),a={};for(let s of Object.keys(e))t(s)||(a[s]=e[s]);let c=Object.keys(a);return r.sort!==!1&&c.sort(r.sort),c.map(s=>{let o=e[s];return o===void 0?"":o===null?l(s,r):Array.isArray(o)?o.length===0&&r.arrayFormat==="bracket-separator"?l(s,r)+"[]":o.reduce(n(s),[]).join("&"):l(s,r)+"="+l(o,r)}).filter(s=>s.length>0).join("&")};u.parseUrl=(e,r)=>{r=Object.assign({decode:!0},r);let[t,n]=Ie(e,"#");return Object.assign({url:t.split("?")[0]||"",query:Fe(Ee(e),r)},r&&r.parseFragmentIdentifier&&n?{fragmentIdentifier:m(n,r)}:{})};u.stringifyUrl=(e,r)=>{r=Object.assign({encode:!0,strict:!0,[k]:!0},r);let t=he(e.url).split("?")[0]||"",n=u.extract(e.url),a=u.parse(n,{sort:!1}),c=Object.assign(a,e.query),s=u.stringify(c,r);s&&(s=`?${s}`);let o=nr(e.url);return e.fragmentIdentifier&&(o=`#${r[k]?l(e.fragmentIdentifier,r):e.fragmentIdentifier}`),`${t}${s}${o}`};u.pick=(e,r,t)=>{t=Object.assign({parseFragmentIdentifier:!0,[k]:!1},t);let{url:n,query:a,fragmentIdentifier:c}=u.parseUrl(e,t);return u.stringifyUrl({url:n,query:ve(a,r),fragmentIdentifier:c},t)};u.exclude=(e,r,t)=>{let n=Array.isArray(r)?a=>!r.includes(a):(a,c)=>!r(a,c);return u.pick(e,n,t)}});d();f();var i=E(ke()),y=E(Ke()),L=E(qe()),_e=E(Ve()),h=E(xe());$e();He();Y();Le();Q();d();f();var Te=()=>!!(window.navigator&&window.navigator.hid);Pe();d();f();Ue();De();var Ce=()=>({syncMpcWallet:async r=>{let t=r?.walletIdentities?.length||0,n=r?.mpcId||"",{data:a}=await J(Z.syncMpcwallet,{mpcId:n,deriveIndex:t});return a}});d();f();je();Y();Q();Re();var be=(e,r)=>{if(!e||!Array.isArray(e))return[];let{hasBackup:t,keyringType:n}=r||{};return e.filter(({hasBackup:a,keyringIdentityType:c})=>{let s=!0;return typeof t=="boolean"&&(s=t===a),n&&(s=(typeof n=="string"?[n]:n)?.includes(c)),s})},Me=e=>e?.reduce((r,{walletIdentities:t,...n})=>[...r,...t.map((a={})=>({...n,...a}))],[]),Oe=e=>e.map(r=>{let{walletIdentities:t}=r;return{...r,hasBackup:!t?.[0]?.needBackup}}),ar=(e={},r)=>{let t=[B.SEGWIT_NESTED,B.SEGWIT_NESTED_49],n={};return Object.keys(e).forEach(c=>{let s=r[c],o=t.find(g=>g!==s),p=Object.entries(e[c]).map(([g,Be])=>({addressType:g,...Be}));n[c]=p.filter(({addressType:g})=>g!==o)}),n},Se=(e=[])=>e.map(r=>{let{walletIdentities:t}=r;return{...r,walletIdentities:t.map(n=>{let{walletId:a,accountsMap:c,addressType:s,segwitAddressType:o,...p}=n;return{walletId:a,selectedAddressType:s,addressType:ar(n?.accountsMap,o),segwitAddressType:o,...p}})}});var sr=[P,V,H,K,q],kr=(e,r=M,t)=>{if(sr.includes(r)&&t){let a=G(r),c=e?.addressType?.[a]||[];return U(c,s=>s.addressType===t)?.address}return e?.account?.[r]};var cr="syncMpcWalletErrorCode";var or=re(({keyring:e})=>{let{keyringIdentities:r}=e;return{keyringIdentities:r}},({keyringIdentities:e})=>Se(e)),R=e=>{let r=(0,y.useSelector)(or);return(0,i.useMemo)(()=>{let n=Oe(r);return e?be(n,e):n},[e,r])},S=e=>{let r=R(e);return(0,i.useMemo)(()=>Me(r||[]),[r])},ir=()=>(0,y.useSelector)(te),N=(e,r=!0)=>{let t=ir(),n=e||t,a=S();return(0,i.useMemo)(()=>r===!1&&!e?null:a.find(c=>c?.walletId===n),[a,n,r,e])},st=(e,r)=>N(e,!1)?.account?.[r],ct=(e,r)=>{let t=S(r);return(0,i.useMemo)(()=>Array.isArray(e)?t.filter(({walletId:n})=>e.includes(n)):t,[e,t])},ot=()=>{let e=S();return(0,i.useCallback)(r=>e?.find(t=>t.walletId===r),[e])},it=e=>N(e)?.keyringIdentityType===w.MPC,lt=e=>{let r=N(e);return ue(r?.initialType)},ut=e=>{let r=R(),{keyringId:t}=N()||{},n=e||t;return(0,i.useMemo)(()=>r?.find(a=>a.keyringId===n),[r,n])},_=()=>{let e=R();return(0,i.useCallback)(r=>e?.find(t=>t.keyringId===r),[e])};var Ne=()=>{let e=(0,y.useDispatch)(),{successHaptic:r,impactHaptic:t}=de();return(0,i.useCallback)(async n=>{try{t();let{walletId:a}=await I().addNewWallet(n);return await W(e),r(),x.success({title:F("wallet_addacount_toast_account_created")}),a}catch(a){return a.message===z&&x.error(F("wallet_home_toast_network_error")),a.message===X&&x.error(F("extension_wallet_addwallet_toast_wallets_added",{amount:1e3})),""}},[])},lr=()=>{let e=(0,L.useHistory)();return(0,i.useCallback)(async r=>{let t=r?.walletIdentities?.[0]?.walletId;if(!Te()){e.push(`${T}/${C.ledger}?${h.default.stringify({baseChain:M,type:A.addAccount,walletId:t})}`);return}let n=`${ee}?${h.default.stringify({type:A.addAccount,walletId:t})}`;await se.hasConnectedLedger()?e.push(n):ae.openModal(ne.hardWareNotConnected,{walletName:r.keyringName,onButtonClick:()=>{globalThis.platform.openExtensionInBrowser(v)},onExtButtonClick:()=>{globalThis.platform.openExtensionInBrowser(`${n}&hideBack=1`)}})},[])},ur=()=>{let e=(0,L.useHistory)(),r=lr(),t=S()?.length;return(0,i.useCallback)(async n=>{if(t===1e3){x.error(F("extension_wallet_addwallet_toast_wallets_added",{amount:1e3}));return}let{initialType:a}=n,c=n?.walletIdentities?.[0]?.walletId;switch(!0){case ce(a):{r(n);break}case oe(a):{globalThis.platform.openExtensionInBrowser(`${T}/${C.trezor}?${h.default.stringify({type:A.addAccount,walletId:c,hideBack:1})}`);break}case ie(a):{e.push(`${T}/${C.keystone}?${h.default.stringify({walletId:c,type:A.addAccount})}`);break}case le(a):{let{onekeyInfo:s}=n,{firstEvmAddress:o,connectId:p}=s;e.push(`${T}/${C.onekey}?${h.default.stringify({firstEvmAddress:o,connectId:p,type:A.addAccount})}`);break}default:break}},[])},dt=()=>{let e=_(),r=Ne(),t=ur(),n=Ne(),{syncMpcWallet:a}=Ce();return(0,i.useCallback)(async c=>{if(c&&typeof c=="string"){let s=e(c),o=s?.walletIdentities?.[0]?.walletId;if(s?.keyringIdentityType===w.MNEMONIC)return await r(o);if(s?.keyringIdentityType===w.HARDWARE)return t(s);if(s?.keyringIdentityType===w.MPC){try{await a(s)}catch{return Promise.reject(new Error(cr))}return await n(o)}return Promise.reject()}return Promise.reject()},[e,r,t,n,a])},dr=()=>{let e=_();return(0,i.useCallback)(r=>new Promise((t,n)=>{let a=e(r);O().getMnemonicByWalletId(a?.walletIdentities?.[0]?.walletId,(c,s)=>{if(c){n(c);return}t(s)})}),[])},ft=(e,r=!0)=>{let t=dr(),[n,a]=(0,i.useState)(null);return(0,i.useEffect)(()=>{(async()=>{if(e){let c=await t(e);a(c)}})()},[e]),r?n?.split(" "):n},fr=()=>(0,i.useCallback)((e,r={})=>new Promise((t,n)=>{O().getBackupPrivateKeys(e,(a,c)=>{if(a){n(a);return}let s=c;Array.isArray(r?.exclude)&&(s=s?.filter(({coinId:o})=>!r?.exclude?.includes(o))),t(s)})}),[]),pt=(e,r={})=>{let[t,n]=(0,i.useState)([]),a=fr();return(0,_e.useDeepCompareEffect)(()=>{(async()=>{if(e){let c=await a(e,r);n(c)}})()},[e,r]),t},pr=()=>{let e=_();return(0,i.useCallback)(r=>new Promise((t,n)=>{let a=e(r);O().getBackupData(a?.walletIdentities?.[0]?.walletId,(c,s)=>{if(c){n(c);return}t(s)})}),[])},mt=e=>{let[r,t]=(0,i.useState)([]),n=pr();return(0,i.useEffect)(()=>{(async()=>{if(e){let a=await n(e);t(a)}})()},[e]),r},yt=()=>{let e=(0,y.useDispatch)(),r=_();return(0,i.useCallback)(async t=>{let n=r(t);await I().backupMnemonic(n?.walletIdentities?.[0]?.walletId),await W(e)},[])},gt=()=>{let e=(0,y.useDispatch)();return(0,i.useCallback)(async(r,t)=>{await I().updateKeyringIdentityName(r,t),await W(e)},[])},wt=()=>{let e=(0,y.useDispatch)();return(0,i.useCallback)(async(r,t)=>{await I().updateWalletIdentityName(r,t),await W(e)},[])},It=()=>{let e=(0,y.useDispatch)();return(0,i.useCallback)(async(r,t)=>{await I().updateKeyringIdentitiesOrder(r,t),await W(e)},[e])};export{xe as a,Te as b,kr as c,cr as d,R as e,S as f,ir as g,N as h,st as i,ct as j,ot as k,it as l,lt as m,ut as n,_ as o,dt as p,ft as q,fr as r,pt as s,mt as t,yt as u,gt as v,wt as w,It as x};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-GTSNHSPT.js.map
