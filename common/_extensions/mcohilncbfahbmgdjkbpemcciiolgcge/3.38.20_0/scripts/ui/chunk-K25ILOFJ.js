import{b as Ae}from"./chunk-6A6OIVCT.js";import{a as tt}from"./chunk-AWNSSJAG.js";import{a as nt}from"./chunk-QCAVIM5G.js";import{a as se}from"./chunk-BGIT66CC.js";import{a as ot}from"./chunk-SEL5SOAI.js";import{a as ce}from"./chunk-EMVP43OQ.js";import{a as $e,j as et,k as ie}from"./chunk-JKOFAFN3.js";import{a as Ze}from"./chunk-TEHSOGCP.js";import{a as ae}from"./chunk-L5MAEEVU.js";import{a as rt}from"./chunk-JYZR3KF2.js";import{b as le}from"./chunk-UYBGGUFD.js";import{a as xe}from"./chunk-3RJOXTRR.js";import{f as Ne}from"./chunk-NNO7KFUF.js";import{d as G}from"./chunk-4NCQWC2K.js";import{j as Qe}from"./chunk-ERN756XV.js";import{h as Ye,i as Je}from"./chunk-OCTREJ3R.js";import{a as re}from"./chunk-A52XYJMT.js";import{h as ne}from"./chunk-GTSNHSPT.js";import{o as Dt}from"./chunk-A3FIPWG3.js";import{H as Ve,Ha as K,Ia as Ie,Ja as Y,Ka as ve,La as qe,Ma as Ke,V as He,ac as oe}from"./chunk-NTISK7TT.js";import{E as P}from"./chunk-CU7RFE6B.js";import{La as ee,Pa as Ge}from"./chunk-KSCBZ3RY.js";import{d as Re,f as Bt}from"./chunk-37O7OMRA.js";import{e as Xe}from"./chunk-DHNKVM4B.js";import{c as je}from"./chunk-TU7CE5HJ.js";import{Aa as Le,B as q,Gb as be,Ib as v,Mb as Te,Nb as ye,Pb as Be,V as Ee,Xc as Me,Ya as he,Yc as bt,aa as $,fc as Se}from"./chunk-YILNSICT.js";import{c as De}from"./chunk-L4N7WJIQ.js";import{K as Z,f as Fe,pa as ke}from"./chunk-LBCQTFOD.js";import{N as Ce,l as Oe,w as b}from"./chunk-V63HWKAL.js";import{a as R}from"./chunk-B75PPTYD.js";import{T as ge,V as Ue,_ as We,aa as _e,t as we,u as ze,v as te}from"./chunk-2AWSM2JA.js";import{b as Mt}from"./chunk-CEF6LCM2.js";import{f as N,m as s,o as c}from"./chunk-UGZFXKPB.js";s();c();var Pe=N(R());s();c();var z=N(R());he();s();c();var at=N(oe());s();c();Bt();function me(t){return async()=>await Re().handleTxBySigner(t)}he();function Rt({walletId:t,method:n,message:r,onConfirm:o}){let e=(0,at.useDispatch)();return async()=>{let i=await e(me({walletId:t,localType:$,method:n,params:{message:r}})),{publicKey:l,signature:m}=i||{},p=qe(ve(l),m);return o(p)}}var it=Rt;var st=t=>{let{walletId:n,method:r,params:o,source:e,onConfirm:a,onCancel:i}=t,l=e==="dapp",[m,p]=(0,z.useState)({}),d=typeof o?.message=="string"?o?.message:new TextDecoder().decode(o?.message),f=it({walletId:n,method:r,message:d,onConfirm:a}),h,y,w;l||(h=f,y=!0,w=i);let T=ce(t),I=G(Le)||{},g=re(I?.localType,n),S=(0,z.useMemo)(()=>({method:r,dappData:JSON.stringify({message:d}),dappInfo:l?T:{},from:g,chainIndex:I.chainId}),[g]),C=ne(n),D=nt({unapproved:t,onConfirm:h,onConfirmReplace:y,onCancel:w,preExecInfo:m}),A=se({initialType:C.initialType}),M=(0,z.useMemo)(()=>[A()].filter(Boolean),[A]);return z.default.createElement(ie,{preExecParams:S,buttonGroup:D,txType:et.signMessage,handleCancel:w,walletAccount:C,onUpdatePreExecInfo:p,chainHeaderTips:M,localType:I?.localType,slot:{advanced:z.default.createElement(ot,{message:d})}})};s();c();var At=N(R());s();c();var B=N(R()),pe=N(Dt());ke();Ce();Ee();s();c();Ce();var Gt=({feeLoading:t,estimateFailed:n,isSufficientGas:r,isSufficientBalance:o,onCancel:e,onConfirm:a,chainConfirmDisabled:i=!1,coinWithBalance:l={},preExecInfo:m={}})=>{let{isBalanceLoading:p}=l,f=i||t||n||(!r||!o)||m?.canConfirm===!1,{loading:h,onClick:y}=xe(e),w={onClick:y,loading:h,actionType:Ne.ACTION_TYPE.CANCEL,btnText:b("wallet_dapp_connection_btn_reject")},{loading:T,onClick:I}=xe(a),g={disabled:f,loading:T||p,onClick:I,actionType:Ne.ACTION_TYPE.CONFIRM};return{buttonGroup:[w,g],handleCancel:e}},ct=Gt;s();c();var L=N(R());Ce();s();c();var J={root:"_root_b2owh_1",text:"_text_b2owh_4",currentChainText:"_currentChainText_b2owh_7",switchNetwork:"_switchNetwork_b2owh_12"};function zt({origin:t,providerType:n,chainName:r,onClick:o,onClose:e,onNetworkChange:a}){let[i,l]=(0,L.useState)(!1);return L.default.createElement(je.Box,{className:J.root},L.default.createElement(De,{closable:!1,desc:L.default.createElement("span",{className:J.text},L.default.createElement("span",{className:J.currentChainText},b("wallet_extension_approval_toast_current_switch",{network:r})),L.default.createElement("span",{className:J.switchNetwork,onClick:()=>{l(!0),o&&o()}},b("wallet_extension_approval_textbtn_current_switch")))}),L.default.createElement(Ae,{origin:t,visible:i,onClose:()=>{l(!1),e&&e()},onNetworkChange:a,providerType:n},L.default.createElement(Ae.Header,{title:b("wallet_extension_sonic_desc_switch_network")})))}var lt=zt;s();c();ke();s();c();var x=N(R());Se();s();c();var mt=N(Mt());bt();Se();async function pt(t){let{SolWallet:n}=await Qe(),r=new n,o=[];try{let e=(t||[]).filter(Boolean);e.length>0&&(o=await r.deserializeMessages({data:e}))}catch{}return(o||[]).reduce(({totalPriorityFee:e,priorityFees:a},i,l)=>{let{deserialized:m,computeUnitLimit:p,computeUnitPrice:d}=i||{};if(m){let f=Ke(p,d);e=v(e,f),a[l]=f}else a[l]="0";return{totalPriorityFee:e,priorityFees:a}},{totalPriorityFee:"0",priorityFees:[]})}var Ut="SetComputeUnitLimit",Wt="SetComputeUnitPrice";function ut(t,n,r){if(Te(n||0,0)||Te(r||0,0)||t.some(l=>{try{let m=We.decodeInstructionType(l);return m===Ut||m===Wt}catch{return!1}}))return t;let e=[...t],a=_e.setComputeUnitPrice({microLamports:n});e.unshift(a);let i=_e.setComputeUnitLimit({units:r});return e.unshift(i),e}async function Vt(t,n,r){let o=new Ue(Me.requestSolanaMethodUrlToFullnode);o._rpcRequest=He;let e=await Promise.all((t.message?.addressTableLookups||[]).map(m=>o.getAccountInfo(m.accountKey).then(p=>new ge({key:m.accountKey,state:ge.deserialize(p.data)})))),a=ze.decompile(t.message,{addressLookupTableAccounts:e});a.instructions=ut(a.instructions,n,r);let i=new te(a.compileToV0Message(e)),l=Y(i);return K(i,l)}async function ft(t,n,r){return new Promise(o=>{try{let e=mt.base.fromBase58(t);try{e=we.from(e)}catch{e=te.deserialize(e)}if(e.signatures&&e.signatures.length>1){o(t);return}if(e instanceof we){e.instructions=ut(e.instructions,n,r);let a=Y(e);o(K(e,a))}else e instanceof te?Vt(e,n,r).then(o).catch(()=>{o(t)}):o(t)}catch{o(t)}})}function Ht({coinId:t,transactions:n,address:r,replace:o,disabled:e,unitLimits:a,signInfo:i}){let[l,m]=(0,x.useState)(0),[p,d]=(0,x.useState)(null),[f,h]=(0,x.useState)([]),[y,w]=(0,x.useState)("0"),[T,I]=(0,x.useState)([]),[g,S]=(0,x.useState)(!1),C=p?.fee||"0",[D,A]=(0,x.useState)(n||[]),M=rt(),F=G(t),{disabledSignInfo:V=!1,disabledPreExecute:U=!1}=e||{},O=E=>{m(E?u=>u+1:u=>u-1)};return(0,x.useEffect)(()=>{a&&h(a)},[a]),(0,x.useEffect)(()=>{i&&d(i)},[i]),(0,x.useEffect)(()=>{(async function(){if(!(V||!t)){O(!0);try{let{data:u={}}=await Ve({coinId:t,address:r}),{info:k={}}=u;d(k),S(!1)}catch{S(!0)}finally{O(!1)}}})()},[r,t,V]),(0,x.useEffect)(()=>{(async function(){if(!(U||!t)&&!(!o||!F?.chainId)){O(!0);try{let u=await M({coinId:t,from:r,chainId:F.chainId,simulateTransactionParamList:(n||[]).map(({serializedMessage:k})=>({transaction:k,sigVerify:!1,replaceRecentBlockhash:!0}))});h(u.unitLimits),S(!1)}catch{S(!0)}finally{O(!1)}}})()},[n,o,r,F?.chainId,U,t]),(0,x.useEffect)(()=>{(async function(){if(!(o&&(!p||!f?.length))){O(!0);try{let u=n||[];o&&(u=await Promise.all(u.map(async(H,j)=>{let{serializedMessage:Q,...X}=H,fe=await ft(Q,p.computeUnitPrice,f[j]);return{...X,serializedMessage:fe}})));let{totalPriorityFee:k,priorityFees:ue}=await pt(u.map(({serializedMessage:H})=>H));w(k),A(u),I(ue),S(!1)}catch{S(!0)}finally{O(!1)}}})()},[n,o,p,f]),{loading:l>0,baseFee:C,totalPriorityFee:y,priorityFees:T,totalFee:v(be(C,(n||[]).length),y),signInfo:p,estimateFailed:g,replacedTransactions:D}}var dt=Ht;Se();var vt=({from:t,coinId:n,preExecInfo:r,walletId:o,transactions:e,addPriorityFee:a})=>{let i=r?.loading,l=r?.unitGasLimitList||[],m=l.find(F=>Z(F)||Be(F,"0")),{loading:p,totalFee:d,baseFee:f,priorityFees:h,estimateFailed:y,signInfo:w,replacedTransactions:T}=dt({coinId:n,transactions:e||[],address:t,replace:a,unitLimits:l,disabled:{disabledPreExecute:!0}}),I=w?.solRent||"0",g=y||!i&&!!m,S=Ze(n,o)||{},{coinAmountInt:C}=S,D=Z(C)||ye(C,d)||i,A=Z(C)||ye(C,v(d,I))||i;return{loading:p,networkFeeProps:{loading:p,networkFee:d,estimateFailed:g,coinId:n},isSufficientGas:D,baseFee:f,priorityFees:h,networkFee:d,estimateFailed:g,estimateFailedMsg:m?.msg,isSufficientBalance:A,selfRent:I,replacedTransactions:T,coinWithBalance:S}},Ct=vt;function qt({txId:t,coinId:n,walletId:r,transactions:o=[],dappInfo:e={},showDappInfo:a=!0,addPriorityFee:i=!0,showSwitchNetwork:l=!0,onConfirm:m,onCancel:p,onAddressCopy:d=Fe,onNetworkChange:f,method:h}){let y=le(q),w=n||y?.coinId,T=G(w)||{},I=T.localType,g=ne(r),S=re(I,r),[C,D]=(0,B.useState)({}),A=(0,B.useMemo)(()=>o.map(W=>{try{if(W.serializedMessage)return W;let de=Y(W);return{instanceType:de,serializedMessage:K(W,de),needToReplaceRecentBlockhash:!W.recentBlockhash}}catch{return null}}).filter(Boolean),[o.length]),{networkFee:M,isSufficientGas:F,networkFeeProps:V,estimateFailed:U,estimateFailedMsg:O,loading:E,isSufficientBalance:u,selfRent:k,replacedTransactions:ue,coinWithBalance:H}=Ct({from:S,coinId:w,walletId:r,transactions:A,addPriorityFee:i,preExecInfo:C}),j=(0,pe.useMemoizedFn)(()=>!u&&F?{message:b("walletextension_toast_text_reserve_rent_exempt",{number:Oe.div(k,10**T?.decimals)}),level:761}:null),Q=se({initialType:g.initialType}),X=(0,pe.useMemoizedFn)(()=>C?.needFillUp?{message:b("wallet_extension_trade_text_insufficient_funds_sol"),level:770,type:$e.FEE_BALANCE_INSUFFICIENT,txId:t,coinId:T?.coinId,address:S,walletId:r}:null),fe=(0,B.useMemo)(()=>[j(),Q(),X()].filter(Boolean),[j,Q,X]),Ft=(0,B.useMemo)(()=>({dappData:JSON.stringify(A.map(W=>({transaction:W.serializedMessage,sigVerify:!1,replaceRecentBlockhash:!0}))),from:S,dappInfo:a?e:{},chainIndex:T?.chainId,method:h,forceLoading:!0}),[T?.chainId]),kt=(0,pe.useMemoizedFn)(async()=>{await m({serviceCharge:M,replacedTransactions:ue,serializedTransactions:A})}),{handleCancel:Ot,buttonGroup:Et}=ct({feeLoading:E,estimateFailed:U,isSufficientGas:F,isSufficientBalance:u,onCancel:p,onConfirm:kt,chainConfirmDisabled:Xe(g.initialType),coinWithBalance:H,preExecInfo:C}),Lt={txId:t,baseCoin:T,estimateFailed:U,isSufficientBalance:u,isSufficientGas:F,estimateFailedMsg:O,coinWithBalance:H};return B.default.createElement(ie,{slot:{top:l&&B.default.createElement(lt,{providerType:q,chainName:T?.chainName,onNetworkChange:f})},chainHeaderTips:fe,networkFeeProps:V,preExecParams:Ft,onAddressCopy:d,walletAccount:g,handleCancel:Ot,buttonGroup:Et,localType:T?.localType,txState:Lt,onUpdatePreExecInfo:D})}var ht=qt;s();c();var Tt=N(R()),yt=N(oe());Ge();function Kt({walletId:t,localType:n,id:r,origin:o}){let e=(0,yt.useDispatch)(),a=ae(t);return(0,Tt.useCallback)(async()=>{a({trade:"contract_interaction",all_confirmation:"cancel",network:n,dapp_url:o}),await e(Ye(r)),await ee(e)},[a,r,n,o])}var St=Kt;s();c();var wt=N(R()),gt=N(oe());Ge();function Yt({coinId:t,id:n,walletId:r,localType:o,origin:e}){let a=(0,gt.useDispatch)(),i=ae(r);return(0,wt.useCallback)(async({replacedTransactions:l,serviceCharge:m})=>{let p={coinId:t,replacedTransactions:l,serviceCharge:m};i({page_type:"contract_interaction",all_confirmation:"confirm",network:o,dapp_url:e}),await a(Je(n,p)),await ee(a)},[i,o,e])}var _t=Yt;s();c();Ee();function Jt(t){let r=le(q)?.coinId,{coinId:o,showSwitchNetwork:e=!0}=t?.params?.extParams||{};return{coinId:o||r,showSwitchNetwork:e}}var It=Jt;s();c();var Nt=N(oe());he();function jt({coinId:t,walletId:n,method:r,okxArgs:o,onConfirm:e}){let a=(0,Nt.useDispatch)();return async({replacedTransactions:i,serviceCharge:l,serializedTransactions:m})=>{let f=await a(me({walletId:n,localType:$,method:r,params:{message:m,okxArgs:o},extraParams:{coinId:t,replacedTransactions:i,serviceCharge:l}})),h;if(r===P.SIGN_ALL_TRANSACTIONS)h=(f.signedTransactionResults||[]).map(({serializedTransaction:y,type:w})=>Ie(y,w));else if(r===P.SIGN_TRANSACTION){let{instanceType:y}=m[0]||{};h=Ie(f.serializedTransaction,y)}else r===P.SIGN_AND_SEND_TRANSACTION&&(h=f);return e(h)}}var xt=jt;var Pt=t=>{let{id:n,coinId:r,method:o,params:e,walletId:a,origin:i,source:l,dappInfo:m,showDappInfo:p=!0,addPriorityFee:d=!0,showSwitchNetwork:f,onConfirm:h,onCancel:y,onAddressCopy:w,okxArgs:T}=t,{coinId:I,showSwitchNetwork:g}=It(t),S=ce(t),C=r||I,A=(G(C)||{}).localType,M=e?.message||[],F=_t({coinId:C,id:n,walletId:a,localType:A,origin:i}),V=St({walletId:a,localType:A,id:n,origin:i}),U=tt({walletId:a}),O=xt({coinId:C,walletId:a,method:o,okxArgs:T,onConfirm:h}),E,u,k;return l==="dapp"?(E=F,u=V,k=U):(E=O,u=y,k=w),At.default.createElement(ht,{method:o,coinId:C,showSwitchNetwork:typeof f=="boolean"?f:g,txId:n,walletId:a,transactions:M,dappInfo:m||S,showDappInfo:p,addPriorityFee:d,onConfirm:E,onCancel:u,onAddressCopy:k})};function Qt(t){switch(t.method){case P.SIGN_TRANSACTION:case P.RPC_SIGN_TRANSACTION:case P.SIGN_AND_SEND_TRANSACTION:case P.RPC_SIGN_AND_SEND_TRANSACTION:case P.SIGN_ALL_TRANSACTIONS:case P.RPC_SIGN_ALL_TRANSACTIONS:return Pe.default.createElement(Pt,{...t});case P.SIGN_MESSAGE:case P.RPC_SIGN_MESSAGE:return Pe.default.createElement(st,{...t});default:return""}}var fr=Qt;export{pt as a,fr as b};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-K25ILOFJ.js.map
