import{a as R,b as L}from"./chunk-TSEGNZ5Z.js";import{b as q}from"./chunk-JSZHIX5F.js";import{a as G}from"./chunk-RTOXOPRM.js";import{c as C,m as p,n as f,o as P}from"./chunk-UGZFXKPB.js";var X=C(a=>{p();P();var k=a&&a.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,o)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),$=a&&a.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Z=a&&a.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&k(e,r,t);return $(e,r),e},Y=a&&a.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&k(e,r,t)};Object.defineProperty(a,"__esModule",{value:!0});a.validSignedTransaction=a.getHardwareTransaction=a.getMPCSignedMessage=a.getUnsignedMessage=a.getMPCTransaction=a.verifySignatureV2=a.verifySignature=a.signMessage2=a.signMessage=a.signByTxId=a.tokenTransfer=a.tokenTransferContract=a.getTransferData=a.assetTransfer=a.assetTransferContract=a.transfer=a.transferContract=a.getTxIdBySignedTx=a.signRawTransaction=a.createRawTransaction=a.toHexAddress=a.validateAddress=a.addressFromPublic=a.addressFromPrivate=a.computeAddress=a.getPubKeyFromPriKey=a.ADDRESS_PREFIX=a.ADDRESS_PREFIX_BYTE=a.HEX_ADDRESS_SIZE=void 0;var s=R(),i=L(),H=Z(q()),E=i.protocol.Transaction.Contract.ContractType;a.HEX_ADDRESS_SIZE=21;a.ADDRESS_PREFIX_BYTE=65;a.ADDRESS_PREFIX="41";var B=`TRON Signed Message:
32`,D=`Ethereum Signed Message:
32`;function U(r){return s.signUtil.secp256k1.publicKeyCreate(r,!1)}a.getPubKeyFromPriKey=U;function v(r){r.length===65&&(r=r.slice(1));let e=s.base.keccak256(r),t=[];return t.push(a.ADDRESS_PREFIX_BYTE),t.push(...e.slice(12)),f.Buffer.from(t)}a.computeAddress=v;function z(r){let e=U(s.base.fromHex(r)),t=v(e);return s.base.toBase58Check(t)}a.addressFromPrivate=z;function Q(r){let e=s.base.fromHex(r);if(e.length!==64){let n=s.signUtil.secp256k1.publicKeyConvert(e,!1);e=f.Buffer.from(n.slice(1))}let t=v(e);return s.base.toBase58Check(t)}a.addressFromPublic=Q;function ee(r){try{if(s.base.isHexString(r)||r.startsWith(a.ADDRESS_PREFIX)&&r.length==a.HEX_ADDRESS_SIZE*2){let t=s.base.fromHex(r);return t.length!=a.HEX_ADDRESS_SIZE?!1:t[0]===a.ADDRESS_PREFIX_BYTE}let e=s.base.fromBase58Check(r);return e.length!==a.HEX_ADDRESS_SIZE?!1:e[0]===a.ADDRESS_PREFIX_BYTE}catch{return!1}}a.validateAddress=ee;function te(r){if(s.base.isHexString(r))return r;let e=s.base.fromBase58Check(r);return s.base.toHex(e)}a.toHexAddress=te;function w(r,e){return i.protocol.Transaction.raw.create({refBlockBytes:s.base.fromHex(r.refBlockBytes),refBlockHash:s.base.fromHex(r.refBlockHash),expiration:r.expiration,timestamp:r.timeStamp,feeLimit:r.feeLimit,contract:e})}a.createRawTransaction=w;function _(r,e){let t=i.protocol.Transaction.create({rawData:r}),n=i.protocol.Transaction.raw.encode(r).finish(),o=s.base.sha256(n);if(!e)return{raw:s.base.toHex(n),hash:s.base.toHex(o)};let{signature:c,recovery:u}=s.signUtil.secp256k1.sign(f.Buffer.from(o),s.base.fromHex(e),!0),g=f.Buffer.concat([Uint8Array.from(c),Uint8Array.of(u)]);t.signature.push(g);let l=i.protocol.Transaction.encode(t).finish();return s.base.toHex(l)}a.signRawTransaction=_;function re(r){let e=i.protocol.Transaction.decode(s.base.fromHex(r)),t=i.protocol.Transaction.raw.encode(e.rawData).finish();return s.base.toHex(s.base.sha256(t))}a.getTxIdBySignedTx=re;function S(r){return s.base.isHexString(r)||r.startsWith(a.ADDRESS_PREFIX)&&r.length==a.HEX_ADDRESS_SIZE*2?s.base.fromHex(r):s.base.fromBase58Check(r)}function O(r){let e=[],t=i.protocol.TransferContract.create({ownerAddress:S(r.fromAddress),toAddress:S(r.toAddress),amount:s.Long.fromString(r.amount)}),n=i.protocol.Transaction.Contract.create({type:E.TransferContract,parameter:i.google.protobuf.Any.create({type_url:"type.googleapis.com/protocol.TransferContract",value:i.protocol.TransferContract.encode(t).finish()})});return e.push(n),e}a.transferContract=O;function se(r,e){let t=O(r),n=w(r,t);return _(n,e)}a.transfer=se;function K(r){let e=[],t=i.protocol.TransferAssetContract.create({assetName:s.base.fromHex(r.assetName),ownerAddress:S(r.fromAddress),toAddress:S(r.toAddress),amount:s.Long.fromString(r.amount)}),n=i.protocol.Transaction.Contract.create({type:E.TransferAssetContract,parameter:i.google.protobuf.Any.create({type_url:"type.googleapis.com/protocol.TransferAssetContract",value:i.protocol.TransferAssetContract.encode(t).finish()})});return e.push(n),e}a.assetTransferContract=K;function ne(r,e){let t=K(r),n=w(r,t);return _(n,e)}a.assetTransfer=ne;function I(r){let e="0x"+s.base.toHex(S(r.toAddress)).slice(2),t=s.base.keccak256(f.Buffer.from("transfer(address,uint256)")).slice(0,4);return f.Buffer.concat([t,s.abi.RawEncode(["address","uint256"],[e,r.amount])])}a.getTransferData=I;function F(r){let e=[],t=i.protocol.TriggerSmartContract.create({ownerAddress:S(r.fromAddress),contractAddress:S(r.contractAddress),data:I(r),callValue:0,callTokenValue:0}),n=i.protocol.Transaction.Contract.create({type:E.TriggerSmartContract,parameter:i.google.protobuf.Any.create({type_url:"type.googleapis.com/protocol.TriggerSmartContract",value:i.protocol.TriggerSmartContract.encode(t).finish()})});return e.push(n),e}a.tokenTransferContract=F;function ae(r,e){let t=F(r),n=w(r,t);return _(n,e)}a.tokenTransfer=ae;function N(r,e){let t=f.Buffer.from(s.base.fromHex(r)),n=f.Buffer.from(s.base.fromHex(e)),{signature:o,recovery:c}=s.signUtil.secp256k1.sign(t,n,!1),u=[];return u.push(...o),u.push(c),s.base.toHex(u)}a.signByTxId=N;function oe(r,e,t,n=!0){if(r==="v2"){let o=f.Buffer.from(`TRON Signed Message:
${e.length.toString()}${e}`,"utf-8"),c=s.base.keccak256(o);if(!t)return s.base.toHex(c);let u=f.Buffer.from(s.base.fromHex(t)),{v:g,r:l,s:b}=H.ecdsaSign(H.toBuffer(c),u);return H.makeSignature(g,l,b)}else if(r==="hex"){let o=f.Buffer.from(s.base.fromHex(e)),c=f.Buffer.from(n?B:D),u=f.Buffer.concat([c,o],c.length+o.length),g=s.base.keccak256(u);if(!t)return s.base.toHex(g);let l=f.Buffer.from(s.base.fromHex(t)),{v:b,r:h,s:T}=H.ecdsaSign(H.toBuffer(g),l);return H.makeSignature(b,h,T)}else if(r==="legacy"){let o=JSON.parse(e);if("txID"in o){if(!t)return o.txID;let c=N(o.txID,t);return o.signature=[c],JSON.stringify(o)}else throw new Error("message must be hex or transaction object")}else if(r==="protobuf"){let o=JSON.parse(e),c=s.base.fromHex(o.raw_data_hex),u=i.protocol.Transaction.raw.decode(Uint8Array.from(c)),g=i.protocol.Transaction.create({rawData:u}),l=s.base.sha256(c),{signature:b,recovery:h}=s.signUtil.secp256k1.sign(f.Buffer.from(l),s.base.fromHex(t),!0),T=f.Buffer.concat([Uint8Array.from(b),Uint8Array.of(h)]);g.signature.push(T);let A=i.protocol.Transaction.encode(g).finish();return s.base.toHex(A)}else throw new Error("message must be hex or transaction object")}a.signMessage=oe;function ce(r,e){let t=JSON.parse(r),n=s.base.fromHex(t.raw_data_hex),o=i.protocol.Transaction.raw.decode(Uint8Array.from(n)),c=i.protocol.Transaction.create({rawData:o}),u=s.base.sha256(n),{signature:g,recovery:l}=s.signUtil.secp256k1.sign(f.Buffer.from(u),s.base.fromHex(e),!0),b=f.Buffer.concat([Uint8Array.from(g),Uint8Array.of(l)]);c.signature.push(b);let h=i.protocol.Transaction.encode(c).finish();return s.base.toHex(h)}a.signMessage2=ce;function ie(r,e,t=!0){let n=s.base.fromHex(r),o=s.base.fromHex(e),c=f.Buffer.from(t?B:D),u=f.Buffer.concat([c,n],c.length+n.length),g=s.base.keccak256(u),l=s.base.stripHexPrefix(e).substring(128,130)=="1c"?1:0,b=s.signUtil.secp256k1.recover(o,l,g,!1);if(b==null)return null;let h=v(b);return s.base.toBase58Check(h)}a.verifySignature=ie;function ue(r,e,t=!0){let n=f.Buffer.from(`TRON Signed Message:
${r.length.toString()}${r}`,"utf-8"),o=s.base.keccak256(n),c=s.base.fromHex(e),u=s.base.stripHexPrefix(e).substring(128,130)=="1c"?1:0,g=s.signUtil.secp256k1.recover(c,u,o,!1);if(g==null)return null;let l=v(g);return s.base.toBase58Check(l)}a.verifySignatureV2=ue;function fe(r,e,t){let n=s.base.fromHex(r),o=i.protocol.Transaction.create({rawData:i.protocol.Transaction.raw.decode(n)}),c=s.base.fromHex(e),u=c.slice(0,32),g=c.slice(32,64),l=s.base.sha256(n),b=s.signUtil.secp256k1.getV(f.Buffer.from(l),s.base.toHex(u),s.base.toHex(g),s.base.fromHex(t)),h=f.Buffer.concat([Uint8Array.from(c),Uint8Array.of(b)]);o.signature.push(h);let T=i.protocol.Transaction.encode(o).finish();return s.base.toHex(T)}a.getMPCTransaction=fe;function ge(r,e,t=!0){if(r==="hex"){let n=f.Buffer.from(s.base.fromHex(e)),o=f.Buffer.from(t?B:D),c=f.Buffer.concat([o,n],o.length+n.length),u=s.base.keccak256(c);return s.base.toHex(u)}else if(r==="legacy"){let n=JSON.parse(e);if("txID"in n)return n.txID;throw new Error("message must be hex or transaction object")}else if(r==="protobuf"){let n=JSON.parse(e),o=s.base.fromHex(n.raw_data_hex),c=s.base.sha256(o);return s.base.toHex(c)}else throw new Error("message must be hex or transaction object")}a.getUnsignedMessage=ge;function le(r,e,t,n,o){let c=s.base.fromHex(e),u=c.slice(0,32),g=c.slice(32,64);if(n==="hex"){let l=s.signUtil.secp256k1.getV(s.base.fromHex(r),s.base.toHex(u),s.base.toHex(g),s.base.fromHex(t))+27;return H.makeSignature(l,u,g)}else if(n==="legacy"){let l=JSON.parse(o),b=s.signUtil.secp256k1.getV(s.base.fromHex(r),s.base.toHex(u),s.base.toHex(g),s.base.fromHex(t),!1);return l.signature=[s.base.toHex(f.Buffer.concat([Uint8Array.from(c),Uint8Array.of(b)]))],JSON.stringify(l)}else if(n==="protobuf"){let l=JSON.parse(o),b=s.base.fromHex(l.raw_data_hex),h=i.protocol.Transaction.raw.decode(Uint8Array.from(b)),T=i.protocol.Transaction.create({rawData:h}),A=s.signUtil.secp256k1.getV(s.base.fromHex(r),s.base.toHex(u),s.base.toHex(g),s.base.fromHex(t),!0),J=f.Buffer.concat([Uint8Array.from(c),Uint8Array.of(A)]);T.signature.push(J);let W=i.protocol.Transaction.encode(T).finish();return s.base.toHex(W)}}a.getMPCSignedMessage=le;function de(r,e){let t=s.base.fromHex(r),n=i.protocol.Transaction.create({rawData:i.protocol.Transaction.raw.decode(t)});n.signature.push(s.base.fromHex(e));let o=i.protocol.Transaction.encode(n).finish();return s.base.toHex(o)}a.getHardwareTransaction=de;function ye(r,e){let t=i.protocol.Transaction.decode(s.base.fromHex(r)),n=i.protocol.Transaction.raw.create(t.rawData),o=i.protocol.Transaction.raw.encode(n).finish(),c=s.base.sha256(o),u=t.signature[0];if(u=u.slice(0,u.length-1),e&&!s.signUtil.secp256k1.verifyWithNoRecovery(c,u,s.base.fromHex(e)))throw Error("signature error");return t}a.validSignedTransaction=ye;Y(j(),a)});var j=C(x=>{p();P();var be=x&&x.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var o=Object.getOwnPropertyDescriptor(e,t);(!o||("get"in o?!e.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,o)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),he=x&&x.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),me=x&&x.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&be(e,r,t);return he(e,r),e};Object.defineProperty(x,"__esModule",{value:!0});x.TrxWallet=void 0;var y=G(),m=R(),d=me(X());function V(r){if(!m.base.validateHexString(r))return!1;let e=m.base.fromHex(r.toLowerCase());return e.length==32&&!e.every(t=>t===0)}var M=class extends y.BaseWallet{async getDerivedPath(e){return`m/44'/195'/0'/0/${e.index}`}static toHexAddress(e){return d.toHexAddress(e)}static toBase58Address(e){let t=m.base.fromHex(e);return m.base.toBase58Check(t)}async getNewAddress(e){try{if(!V(e.privateKey))return Promise.reject(y.NewAddressError);let t=e.privateKey;e.privateKey.startsWith("0x")&&(t=m.base.stripHexPrefix(e.privateKey)),e.privateKey.startsWith("0X")&&(t=e.privateKey.substring(2));let n=t,o=d.getPubKeyFromPriKey(m.base.fromHex(n)),u={address:d.addressFromPrivate(n),publicKey:m.base.toHex(o)};return Promise.resolve(u)}catch{return Promise.reject(y.NewAddressError)}}async validPrivateKey(e){let n={isValid:V(e.privateKey),privateKey:e.privateKey};return Promise.resolve(n)}async validAddress(e){let t=e.address,n=!1;try{n=d.validateAddress(t)}catch{}return Promise.resolve({isValid:n,address:t})}async signTransaction(e){try{let t=e.privateKey,n=e.data;if(n.type==="transfer"){let o=n.data,c=d.transfer(o,t);return Promise.resolve(c)}else if(n.type==="assetTransfer"){let o=n.data,c=d.assetTransfer(o,t);return Promise.resolve(c)}else if(n.type==="tokenTransfer"){let o=n.data,c=d.tokenTransfer(o,t);return Promise.resolve(c)}else return Promise.reject(y.SignTxError)}catch{}return Promise.reject(y.SignTxError)}async signMessage(e){try{let t=m.base.stripHexPrefix(e.data.message),n=d.signMessage(e.data.type,t,e.privateKey,!0);return Promise.resolve(n)}catch{}return Promise.reject(y.SignMsgError)}static signRawTransaction(e){try{let t=m.base.stripHexPrefix(e.data.message),n=d.signMessage2(t,e.privateKey);return Promise.resolve(n)}catch{}return Promise.reject(y.SignMsgError)}async verifyMessage(e){let t=e.signature,n=e.data,o=e.address||"";return await this.ecRecover(n,t).then(c=>new Promise(function(u,g){u(o.toLowerCase()===c.toLowerCase())}))}async ecRecover(e,t){let n=d.verifySignature(e.message,t);return Promise.resolve(n||"")}getAddressByPublicKey(e){return Promise.resolve(d.addressFromPublic(e.publicKey))}async getMPCRawTransaction(e){try{return this.signTransaction(e)}catch{return Promise.reject(y.GetMpcRawTransactionError)}}async getMPCTransaction(e){try{let t=d.getMPCTransaction(e.raw,e.sigs,e.publicKey);return Promise.resolve(t)}catch{return Promise.reject(y.GetMpcTransactionError)}}async getMPCRawMessage(e){try{let t=d.getUnsignedMessage(e.data.type,e.data.message,!0);return Promise.resolve({hash:t})}catch{return Promise.reject(y.GetMpcRawTransactionError)}}async getMPCSignedMessage(e){try{return Promise.resolve(d.getMPCSignedMessage(e.hash,e.sigs,e.publicKey,e.type,e.message))}catch{return Promise.reject(y.GetMpcTransactionError)}}async calcTxHash(e){try{if(typeof e.data=="string")return Promise.resolve(d.getTxIdBySignedTx(e.data));{let t=await this.signTransaction(e);return Promise.resolve(t.hash)}}catch{return Promise.reject(y.CalcTxHashError)}}async getHardWareRawTransaction(e){try{return this.signTransaction(e)}catch{return Promise.reject(y.GetHardwareRawTransactionError)}}async getHardWareSignedTransaction(e){try{let t=d.getHardwareTransaction(e.raw,e.sig);return Promise.resolve(t)}catch{return Promise.reject(y.GetHardwareSignedTransactionError)}}async getHardWareMessageHash(e){try{let t=m.base.stripHexPrefix(e.data.message),n=d.getUnsignedMessage(e.data.type,t,!0);return Promise.resolve(n)}catch{}return Promise.reject(y.GetHardWareMessageHashError)}async validSignedTransaction(e){try{let t=e.data?e.data.publicKey:void 0,n=d.validSignedTransaction(e.tx,t);return Promise.resolve((0,y.jsonStringifyUniform)(n))}catch{return Promise.reject(y.validSignedTransactionError)}}};x.TrxWallet=M});export{j as a,X as b};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-5YFV2FPZ.js.map
