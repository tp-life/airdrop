import{a as ke}from"./chunk-2ZHRF3EM.js";import{a as be}from"./chunk-ATT4JLQO.js";import{b as Te,d as xe}from"./chunk-BNCPRLHO.js";import{b as Ee}from"./chunk-Y4NQNAEQ.js";import{a as bt}from"./chunk-J7ZUOIII.js";import{a as ct}from"./chunk-Q2BK5I52.js";import{b as Xt,c as te,d as ee,e as oe,f as re,g as se,l as ae,m as ie,n as ne,o as le}from"./chunk-XZVVM3AM.js";import{a as xt,b as ge}from"./chunk-5OABWI4F.js";import{P as Ut,k as X}from"./chunk-FJBNQZUR.js";import{a as Pe}from"./chunk-MM3T4QJL.js";import{a as fe}from"./chunk-7MPV4FXR.js";import{a as _e,b as ue,c as de,d as ye,e as we}from"./chunk-MAPEPGBY.js";import{a as j}from"./chunk-DKN2AV5Y.js";import{h as Rt}from"./chunk-P7X44DVV.js";import{a as he}from"./chunk-RJO5LUBF.js";import{l as Yt,m as Ht,n as Gt,o as $t}from"./chunk-DRPGNVVL.js";import{a as it}from"./chunk-UEENMIFU.js";import{b as nt,c as lt}from"./chunk-3OMHZBKM.js";import{h as Y,i as H}from"./chunk-A264YTOP.js";import{C as jt,F as Pt,L as qt,Ra as Jt,a as K,ha as Qt,x as zt,y as Zt}from"./chunk-PVSNAFN3.js";import{q as A}from"./chunk-GBQG32PI.js";import{o as Tt}from"./chunk-A3FIPWG3.js";import{ac as Et,nb as ce,rb as at}from"./chunk-NTISK7TT.js";import{a as me}from"./chunk-J4UWPXXS.js";import{a as kt}from"./chunk-QZUNX5I4.js";import{ta as Vt,ya as He}from"./chunk-KSCBZ3RY.js";import{d as V,f as ht}from"./chunk-37O7OMRA.js";import{g as pe}from"./chunk-35FUKWV2.js";import{c as d}from"./chunk-TU7CE5HJ.js";import{Ic as Kt,Oc as Ge,gc as Q,hc as Ke,ic as st,m as St,n as Lt,o as Bt,oc as Ot,q as wt,u as rt,z as gt}from"./chunk-YILNSICT.js";import{D as Z,H as J,d as Ft,o as Wt,q as z,r as Dt}from"./chunk-L4N7WJIQ.js";import{F as et,pa as Ve}from"./chunk-LBCQTFOD.js";import{N as ot,w as s}from"./chunk-V63HWKAL.js";import{H as Ye,T as Mt,U as vt,ca as f}from"./chunk-2EJYCNYZ.js";import{a as q}from"./chunk-B75PPTYD.js";import{f as E,m,o as p}from"./chunk-UGZFXKPB.js";m();p();var r=E(q()),ut=E(Et()),At=E(kt()),$=E(Tt()),Be=E(Ye());ot();ht();m();p();var R=E(q()),mt=E(Tt());ht();Ke();gt();m();p();var M=E(q());ot();m();p();var G={root:"_root_15akf_1",image:"_image_15akf_4",title:"_title_15akf_7",desc:"_desc_15akf_15",btns:"_btns_15akf_23","cancel-width":"_cancel-width_15akf_26",cancelWidth:"_cancel-width_15akf_26"};function Ct({type:a,step:o,onCancel:t,onRetry:T}){let y=pe({light:"./static/images/passkey-light-big.png",dark:"./static/images/passkey-dark-big.png"}),e={["create"]:{title:{text:"wallet_extension_biometrics_drawer_title_verification",keys:{num:1,total:2},color:"var(--okd-color-content-primary)"},desc:"wallet_extension_biometrics_drawer_desc_verification",cancel:"commonall_text_btn_cancel",onCancel:t},["verify"]:{title:{text:a==="create"?"wallet_extension_biometrics_drawer_title_verification":"wallet_extension_biometrics_drawer_title_unlock",keys:{num:2,total:2},color:"var(--okd-color-content-primary)"},desc:a==="create"?"wallet_extension_biometrics_drawer_desc_verification":"wallet_extension_biometrics_drawer_desc_unlock",cancel:"commonall_text_btn_cancel",onCancel:t},["error"]:{title:{text:"wallet_extension_biometrics_drawer_title_fail_setup",color:"var(--okd-color-semantic-negative)"},desc:"wallet_extension_biometrics_drawer_desc_fail_setup",confirm:"commonall_emptystate_text_try_again",onConfirm:T,cancel:"commonall_text_btn_cancel",onCancel:t},["init"]:null,["success"]:null}[o];return e?M.default.createElement(d.Container,{className:G.root},M.default.createElement(d.FlexBox,{className:G.image,align:d.ALIGN.center,justify:"center"},M.default.createElement(Ft,{src:y,width:120,height:120})),M.default.createElement(A.Text,{strong:700,className:G.title,style:{color:e.title.color}},s(e.title.text,e.title.keys)),M.default.createElement(A.Text,{strong:400,className:G.desc},s(e.desc)),M.default.createElement(d.FlexBox,{className:G.btns,align:d.ALIGN.center,justify:"center"},M.default.createElement(f,{block:e.confirm,category:f.CATEGORY.fill,type:f.TYPE.gray,size:f.SIZE.lg,onClick:()=>{e.onCancel()},className:fe({[G.cancelWidth]:!e.confirm})},s(e.cancel)),e.confirm?M.default.createElement(f,{block:!0,category:f.CATEGORY.fill,type:f.TYPE.highlight,size:f.SIZE.lg,onClick:()=>{e.onConfirm()}},s(e.confirm)):null)):null}function Nt(){let[a]=lt(nt.credentialId),[o,t]=(0,R.useState)("init"),[T,y]=(0,R.useState)("init"),l=(0,R.useRef)(null),e=(0,R.useRef)(_=>_),h=async _=>{try{y("create"),t("create"),e.current=_,await bt(500);let{password:N,credential:v,credentialId:I}=await de();if(t("verify"),!await ye({credential:v,password:N})){t("error"),await _(null);return}l.current?.destroy(),t("success"),await _({password:N,credentialId:I})}catch{t("error"),await _(null)}},x=async _=>{try{y("verify"),t("verify"),e.current=_;let{password:N}=await we(a);await V().verifyPassword(N),l.current?.destroy(),t("success"),await _(!!N)}catch{t("error"),await _(!1)}},b=()=>{t("init"),y("init"),l.current?.destroy()},C=()=>{T==="create"&&h(e.current),T==="verify"&&x(e.current)},c=async()=>{Q()!==rt&&(l.current||(l.current=Wt.action({mask:!1})),await bt(100),l.current.update({visible:!0,mask:!0,onClose:()=>{b()},children:R.default.createElement(Ct,{step:o,type:T,onRetry:()=>{C()},onCancel:()=>{b()}})}))};return(0,mt.useUpdateEffect)(()=>{if(o==="init"||o==="success"){l.current?.destroy();return}c()},[o]),(0,mt.useUnmount)(()=>{l.current?.destroy()}),{create:h,verify:x}}Ot();gt();m();p();var w=E(q()),ft=E(Tt());ot();m();p();var pt={root:"_root_cl85f_1",passwordInput:"_passwordInput_cl85f_6"};var Ce=({onBack:a,onComplete:o})=>{let y=ct().get("from")===g.HARDWARE,l=Z.useForm(),[e,h]=(0,w.useState)({}),[x,{setTrue:b,setFalse:C}]=(0,ft.useBoolean)(!1),c=!e.password||!e.confirm||e.password?.length<xt||e.confirm?.length<xt||e.password!==e.confirm,_=(0,ft.useMemoizedFn)(async()=>{let{password:I,confirm:S}=e;if(!(x||c)){if(I!==S){l.setErrors({confirm:s("wallet_settings_reset_passord_errortip_input_error")});return}Ut(),b(),await o(S),C()}},[c,e]),N=(0,w.useCallback)(async I=>{(I?.key==="Enter"||I?.keyCode===13)&&await _()},[]),v=ke();return(0,w.useEffect)(()=>(document.addEventListener("keydown",N),()=>{document.removeEventListener("keydown",N)}),[]),w.default.createElement(Ee,{className:pt.root,title:s("wallet_signup_maintitle_set_password"),desc:s(y?"wallet_extension_signup_subtitle_set_password_hardware":"wallet_extension_subtitle_password_unlock"),onBack:a},({formClass:I,formErrorClass:S,itemClass:U})=>w.default.createElement(Z,{form:l,size:z.SIZE.lg,validateTrigger:["onChange","onBlur"],className:I,errorClassName:S,onValuesChange:(L,B)=>{h(B)}},w.default.createElement(Z.Item,{name:"password",style:{marginBottom:0},className:U,label:s("wallet_set_password_subtitle_password")},w.default.createElement(z.Password,{autoComplete:"off",size:z.SIZE.xl,inputClassName:pt.passwordInput,placeholder:s("wallet_settings_reset_passord_placeholder_input_desc")})),w.default.createElement(Z.Item,{noStyle:!0,shouldUpdate:(L,B)=>L.password!==B.password},({getFieldValue:L})=>{let B=L("password");return w.default.createElement(ge,{password:B})}),w.default.createElement(Z.Item,{name:"confirm",className:U,label:s("wallet_settings_reset_passord_subtitle_password_confirmation"),style:{flex:1,marginTop:"32px"}},w.default.createElement(z.Password,{autoComplete:"off",size:z.SIZE.xl,inputClassName:pt.passwordInput,placeholder:s("wallet_settings_reset_passord_placeholder_input_password_confirmation"),onChange:()=>{l.cleanErrors("confirm")}})),w.default.createElement(it.FooterActions,{usePortal:!0,renderNative:!0,affixStyle:v,buttonGroup:[{loading:x,disabled:c,block:!0,type:f.TYPE.highlight,category:f.CATEGORY.fill,size:f.SIZE.lg,btnText:s("wallet_set_password_btn_confirm"),onClick:_}]})))};m();p();var It=E(Et());var Ne=E(kt());function Ie(){let a=(0,Ne.useHistory)(),o=(0,It.useSelector)(at),t=(0,It.useSelector)(ce);o&&!t&&a.replace(K)}m();p();var k={root:"_root_1ybp2_1",content:"_content_1ybp2_4",title:"_title_1ybp2_7",desc:"_desc_1ybp2_15",list:"_list_1ybp2_22",item:"_item_1ybp2_25","item-select":"_item-select_1ybp2_42",itemSelect:"_item-select_1ybp2_42","item-title":"_item-title_1ybp2_45",itemTitle:"_item-title_1ybp2_45","item-desc":"_item-desc_1ybp2_53",itemDesc:"_item-desc_1ybp2_53",link:"_link_1ybp2_60",anchor:"_anchor_1ybp2_64",icon:"_icon_1ybp2_65",forgot:"_forgot_1ybp2_78"};m();p();var Ae=E(q()),_t=E(Et()),Se=E(kt());Ve();ot();ht();Ot();gt();Ge();He();var Le=a=>{let o=(0,Se.useHistory)(),t=(0,_t.useDispatch)(),{seedPhrase:T,privateKey:y,mpcInfo:l,unlockHardwareWallets:e,chooseNetworkList:h,isTonMnemonic:x}=(0,_t.useSelector)(n=>({seedPhrase:Xt(n),isTonMnemonic:se(n),privateKey:te(n),chooseNetworkList:re(n),mpcInfo:oe(n),unlockHardwareWallets:ee(n)})),{setValue:b}=xe(),{value:C}=Te();(a===g.SEED&&!T||a===g.KEY&&!y||a===g.BULK&&!C||a===g.MPC&&(!l||et(l))||a===g.HARDWARE&&(!e||et(e)))&&o.push(K);let c=n=>{let P=`${Pt}/${a}`,{keyringName:u="",walletName:F=""}=n||{},W=`${u}-${F}`;o.push({pathname:P,state:{walletName:W,anim:"1",next:K}})},_=async n=>{await t(Yt(n)),await t(j()),o.push({pathname:Qt,search:`?type=${Kt.INITIALIZE}`,state:{hasPassword:!0}})},N=async n=>{let P=T?.trim().toLowerCase().match(/\w+/gu)?.join(" ")||"",u=await t(Ht(n,P,{isTonMnemonic:x}));t(ae()),await t(j()),c(u)},v=async n=>{let P=await t(Gt(n,h,y));t(ie()),await t(j()),c(P)},I=n=>{b(n),o.push(Jt)},S=async(n,P)=>{et(e)||(await V().setPassword(n),await t(Y(P?2:1)),await t(H(P)),await t(be(e)),await t(j()),t(ne()));let u=`${Pt}/${g.HARDWARE}`;st()===Bt&&globalThis.platform.openExtensionInPopup(`${u}?anim=1`)},U=async n=>{let{cipherText:P,privateKey:u,mpcId:F,userInfo:W}=l;if(P&&u&&F){let dt=await t($t(n,{cipherText:P,privateKey:u},{mpcId:F,userInfo:W},!0));t(le()),await t(j()),c(dt)}},L={[g.CREATE]:_,[g.SEED]:N,[g.KEY]:v,[g.BULK]:I,[g.HARDWARE]:S,[g.MPC]:U};return(0,Ae.useCallback)(async(n,P)=>{try{await L[a](n,P)}catch(u){let F=s("wallet_extension_toast_text_unknown_error");u.message===Vt&&(F=s("wallet_home_toast_network_error")),J.error(u.message?u.message:JSON.stringify(u))}},[a])};var g={SEED:"seed",KEY:"key",HARDWARE:"hardware",CREATE:"create",MPC:"mpc",BULK:"bulk"},ze=()=>{let a=(0,At.useHistory)(),o=st(),t=o===St||o===wt,T=o===Lt,y=o===wt;return{openNotification:()=>{let{pathname:h,search:x}=a.location,b=x?"&":"?",C="openFromThisPage=1";globalThis.platform.openExtensionInPopup(`${h}${x}${b}${C}`,null,!y)},closeNotification:()=>{window.close()},needOpenNotification:t,isNotification:T}};function Ze(){let a=(0,At.useHistory)(),o=(0,ut.useDispatch)(),{needOpenNotification:t,isNotification:T,openNotification:y,closeNotification:l}=ze(),e=()=>{t?a.goBack():a.push(K)},[h]=lt(nt.passwordType),[x,b]=(0,r.useState)(2),C=(0,r.useMemo)(()=>Q()===rt?"telegram":"extension",[Q]);(0,$.useMount)(async()=>{await ue(h)||b(1)});let c=(0,ut.useSelector)(at);Ie();let[_,N]=(0,r.useState)(!1);(0,$.useAsyncEffect)(async()=>{try{if(await _e(h))return;let O=c?qt:jt;a.replace({pathname:O,search:a.location.search})}finally{N(!0)}},[]);let v=ct(),I=v.get("from")||g.CREATE,S=Le(I),U=v.get("openFromThisPage")==="1",L=i=>c?h===i:x===i,{create:B,verify:n}=Nt(),[P,{toggle:u}]=(0,$.useToggle)(!1),[F,{toggle:W}]=(0,$.useToggle)(!1),dt=async()=>{if(t){y();return}await B(async i=>{if(i){let{password:O,credentialId:tt}=i;await S(O,tt),await o(Y(2)),await o(H(tt)),X({button_name:"biometric",platform:C})}})},Oe=async()=>{W()},Me=async()=>{u(),await B(async i=>{if(i){let{password:O,credentialId:tt}=i;await V().modifyPassword(O)&&(J.success(s("wallet_edit_wallet_toast_renamed_success")),await o(Y(2)),await o(H(tt)),X({button_name:"biometric",platform:C}),T&&U&&l())}})},ve=async i=>{W(),await V().modifyPassword(i)&&(J.success(s("wallet_edit_wallet_toast_renamed_success")),await o(Y(1)),await o(H(void 0)),X({button_name:"password",platform:C}),T&&U&&l())},Fe=()=>{if(!c){b(2);return}if(c&&h===2){a.goBack();return}if(t){y();return}u()},We=async()=>{if(!c){b(1);return}if(c&&h===1){a.goBack();return}if(t){y();return}await n(i=>{i&&W()})},[De,yt]=(0,r.useState)(!1),Re=async()=>{try{yt(!0),x===2?await dt():await Oe()}catch{yt(!1)}finally{yt(!1)}},Ue=[{type:2,title:"wallet_extension_biometrics_radio_title_authentication",desc:"wallet_extension_biometrics_radio_desc_authentication",onClick:Fe},{type:1,title:"wallet_extension_biometrics_radio_title_password",desc:"wallet_extension_biometrics_radio_desc_password",onClick:We,link:c&&h===1?{url:Zt,text:"wallet_extension_biometrics_btn_change_password"}:null}];return _?P?r.default.createElement(Pe,{onBack:u,callback:Me}):F?r.default.createElement(Ce,{onBack:W,onComplete:async i=>{c?await ve(i):(await S(i),await o(Y(1)),await o(H(void 0)),X({button_name:"password",platform:C}))}}):r.default.createElement(d.Box,{className:k.root},r.default.createElement(he,{bordered:!1,closeable:!1,onBack:e}),r.default.createElement(d.Container,{className:k.content},r.default.createElement(A.Text,{className:k.title},s("wallet_extension_biometrics_header_title_unlock")),r.default.createElement(A.Text,{className:k.desc},s("wallet_extension_biometrics_desc_unlock")),r.default.createElement(d.Box,{className:k.list},Ue.map(i=>r.default.createElement(d.FlexBox,{className:(0,Be.default)(k.item,{[k.itemSelect]:L(i.type)}),direction:d.DIRECTION.horizontal,align:d.ALIGN.center,justify:"space-between",onClick:()=>{i.onClick()}},r.default.createElement(d.Box,{className:k.itemContent},r.default.createElement(A.Text,{className:k.itemTitle},s(i.title)),r.default.createElement(A.Text,{className:k.itemDesc},s(i.desc)),i.link?r.default.createElement(d.FlexBox,{className:k.link,direction:d.DIRECTION.horizontal,align:d.ALIGN.center},r.default.createElement(vt,{alt:s(i.link.text),rel:"nofollow",onClick:O=>{O.stopPropagation(),O.preventDefault(),Rt(),a.push(i.link.url)},className:k.anchor},s(i.link.text)),r.default.createElement(Mt,{iconName:"okds-arrow-chevron-right-centered-md",className:k.icon})):null),L(i.type)?r.default.createElement(Dt.Circle,{checked:!0}):null))),r.default.createElement(it.FooterActions,null,c?r.default.createElement(r.default.Fragment,null,r.default.createElement(me,{to:zt,className:k.forgot},r.default.createElement(A.Text,{strong:!0,size:A.SIZE.sm,type:A.TYPE.secondary},s("wallet_footer_subtitle_forgot_password")))):r.default.createElement(f,{block:!0,category:f.CATEGORY.fill,type:f.TYPE.highlight,size:f.SIZE.lg,loading:De,onClick:()=>{Re()}},s("commonall_button_text_next"))))):null}export{g as a,Ze as b};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-BYNZQNKW.js.map
