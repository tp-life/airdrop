import{a as Ne,b as be}from"./chunk-O6IGNLRS.js";import{b as he}from"./chunk-KPYSN5PV.js";import{b as pe,g as ye,i as _e,l as Te,m as ge,q as xe,r as Ae}from"./chunk-MOISJT5B.js";import{a as ue}from"./chunk-5AU4SCQT.js";import{a as et,c as Ce,d as k}from"./chunk-WMQSMBLA.js";import{a as Ie}from"./chunk-XKK5N6CR.js";import{a as At,c as tt}from"./chunk-3RJOXTRR.js";import{a as me,f as j,t as de}from"./chunk-NNO7KFUF.js";import{a as fe}from"./chunk-3L5C5CQB.js";import{d as le,g as ce}from"./chunk-4NCQWC2K.js";import{c as ie}from"./chunk-SR5VKAMR.js";import{b as oe}from"./chunk-6ZM3C6AR.js";import{b as gt}from"./chunk-UWTAV26V.js";import{f as _t}from"./chunk-IMZZ3LDB.js";import{h as yt,i as te}from"./chunk-OCTREJ3R.js";import{d as xt}from"./chunk-OQJOA7JT.js";import{h as se,l as ne,m as ae}from"./chunk-GTSNHSPT.js";import{a as re}from"./chunk-UEENMIFU.js";import{a as Q}from"./chunk-PVSNAFN3.js";import{b as Tt}from"./chunk-JYKQJVIF.js";import{q as N}from"./chunk-GBQG32PI.js";import{o as ee}from"./chunk-A3FIPWG3.js";import{ac as Ke}from"./chunk-NTISK7TT.js";import{V as X,b as K,da as Qt}from"./chunk-CU7RFE6B.js";import{a as Xe}from"./chunk-QZUNX5I4.js";import{c as w}from"./chunk-TU7CE5HJ.js";import{Ac as Zt,Fc as q,Kc as qt,Mc as Jt,Oc as $t,Ua as jt,Uc as J,Wc as Kt,Xc as $,Y as Yt,Ya as Rt,Yc as Xt,a as Mt,b as Je,sc as Z,xc as Gt}from"./chunk-YILNSICT.js";import{G as Vt,c as Ht,o as zt}from"./chunk-L4N7WJIQ.js";import{F as vt,pa as $e}from"./chunk-LBCQTFOD.js";import{N as G,l as P,w as f}from"./chunk-V63HWKAL.js";import{a as M}from"./chunk-B75PPTYD.js";import{f as h,m as c,o as m}from"./chunk-UGZFXKPB.js";c();m();var t=h(M()),ve=h(Ke()),Ye=h(Xe()),ot=h(ee());$e();G();$t();Rt();Gt();c();m();var I=h(M());G();Gt();c();m();var we={list:"_list_b7lh5_1"};var Qe=({coinId:e,value:n,visible:a,onToggleVisible:i,options:o,onChange:u})=>{let g=le(e),b=p=>{let{addressType:y,address:x,canTransferAmount:L}=p;return I.default.createElement(xt.Card,{selected:n?.address===x,onClick:()=>{i?.(),u?.(p)}},I.default.createElement(w.Box,{style:{width:"100%"}},I.default.createElement(w.FlexBox,{justify:"space-between",align:w.ALIGN.center},I.default.createElement(N.Text,{strong:!0},f(Z[y])),I.default.createElement(N.DisplayAmount,{strong:!0,mode:N.CRYPTO,decimals:g?.decimals},L)),I.default.createElement(w.FlexBox,{justify:"space-between",align:w.ALIGN.center},I.default.createElement(N.Address,{address:x,desensitize:!0,copyable:!1,size:N.SIZE.sm,type:N.TYPE.secondary}),I.default.createElement(N.Text,{type:N.TYPE.secondary,size:N.SIZE.xs},f("extension_wallet_available_coin_balance",{coin:g?.symbol})))))};return I.default.createElement(zt,{visible:a,alignBottom:!0,noTopRadius:!1,windowStyle:{width:"100%"},title:f("btcnft_gas_title_pay_gas_with"),onClose:i},I.default.createElement(xt,{space:16,dataSource:o,renderItem:b,className:we.list}))},Le=Qe;c();m();Je();var Ee=h(M()),to=()=>(0,Ee.useCallback)(({value:e,message:n,reportParams:a})=>{try{Mt.captureEvent({message:n,contexts:{report:{info:JSON.stringify(a)}},exception:{values:[{type:"BIZ_ERROR_btcPayWalletAddress",value:e}]},level:"warn"})}catch(i){console.log(i)}},[]),Fe=to;c();m();var R=h(M());$t();Xt();Kt();function eo(e,n,a,i){let[o,u]=(0,R.useState)(a),[g,b]=(0,R.useState)([]);return(0,R.useEffect)(()=>{if(i?.chainId===void 0||i?.chainId===null)return;(async()=>{try{if(!a)return;let y=await J($.checkDustForBtcTx,{inscriptionIds:n,targetAddress:e,scene:24,chain:i.chainId,tokenStandard:qt(i.chainId)});b(y?.data?.dustInscriptionIds||[])}finally{u(!1)}})()},[a,e,n,i]),{isDustLoading:o,dustError:g.length>0}}var Be=eo;c();m();var Pe=h(M());G();var oo=({isMpcWallet:e,isHardware:n,feeError:a,isSufficientGas:i,dustError:o,transferReminder:u})=>({tipMessageProps:(0,Pe.useMemo)(()=>e?{type:k.TIP_TYPE.COMMON_ERROR,message:f("extension_wallet_contractual_interaction_wallet_unavailable")}:n?{type:k.TIP_TYPE.COMMON_ERROR,message:f("wallet_extension_top_toast_dapp_comingsoon")}:a?{type:k.TIP_TYPE.FEE_ERROR}:i?o?{type:k.TIP_TYPE.COMMON_ERROR,message:f("wallet_info_dialog_dust_limit_individually")}:{type:Ht.TYPE.warn,message:u}:{type:Qt.FEE_BALANCE_INSUFFICIENT},[a,e,n,i,o,u])}),ke=oo;c();m();var Se=h(ee());Kt();Xt();var ro=e=>{let{loading:n,data:a}=(0,Se.useRequest)(async()=>(await J($.batchBtcNftDetail,{inscriptionIdProtocols:Array.isArray(e)?e:[e]}))?.data?.details||[]);return[n,a||[]]},Oe=ro;c();m();var It=h(M());G();Rt();var so=7*1e3,no=({walletId:e,coinId:n,satBytes:a,needFilteredUtxo:i,localType:o=Yt})=>{let u=se(e),g=(0,It.useMemo)(()=>{let x=oe(o);return u?.addressType?.[x]||[]},[u?.walletId]),[b,p]=Te({coinId:n,walletId:e,satBytes:a,addressList:g?.map(({address:x})=>x),needFilteredUtxo:i},{pollingInterval:so,ready:!!i?.length&&!!a}),y=(0,It.useMemo)(()=>g.map((L,A)=>({...L,canTransferAmount:p[A]}))?.sort((L,A)=>{let rt=P.sub(A.canTransferAmount,L.canTransferAmount);return Number(rt)}),[p,g]);return[b,y]},We=no;c();m();var Ct={"nft-transfer__extend":"_nft-transfer__extend_1bjoo_1",nftTransferExtend:"_nft-transfer__extend_1bjoo_1","nft-transfer__icon":"_nft-transfer__icon_1bjoo_4",nftTransferIcon:"_nft-transfer__icon_1bjoo_4"};var De={Ordinals:"Ordinals",Atomicals:"Atomicals"},Ue=2,Me="NFT",zr=({unapproved:e})=>{let n=e?.walletId,a=e?.localType,o=ie({localType:a})?.coinId;o===void 0&&(o=jt(a));let[u,g]=ce(o),b=ae(n),p=e.params.transfer.from,y=e.params.transfer.to,{feeRate:x}=e.params.transfer.options||{},L=Fe(),[,A]=ue({coinId:o,address:p,chainId:u?.chainId}),rt=A?.transferReminder,[ht,H]=(0,ot.useSetState)({payWallet:!1,networkFee:!1}),[E,Nt]=(0,t.useState)(x&&typeof x=="number"?{satBytes:x,level:X.CUSTOM}:{satBytes:A?.normal,level:X.STANDARD});(0,t.useEffect)(()=>{!E?.satBytes&&A?.normal&&Nt({satBytes:A?.normal,level:X.STANDARD})},[A,E]);let z=e.params.transfer.data,S=Array.isArray(z)&&z.length>1,{isDustLoading:bt,dustError:st}=Be(y,z,S,g),[,l]=Oe(z),v=(0,t.useMemo)(()=>{if(!Array.isArray(l)||!l?.length)return;let[{protocol:s}]=l||[];if(s===De.Atomicals)return q.ARC_20},[l]),nt=(0,t.useMemo)(()=>l.map(s=>`${s.btcNftUtxoDetail?.txId}-${s.btcNftUtxoDetail?.outputIndex}`),[l]),[wt,O]=We({localType:a,coinId:o,walletId:n,needFilteredUtxo:nt,satBytes:E?.satBytes}),[r,at]=(0,t.useState)({}),[it,{toggle:je}]=(0,ot.useBoolean)(!1);(0,t.useEffect)(()=>{let s=O?.[0];if(vt(r)&&!!s&&s?.canTransferAmount&&at(s),O&&r.address&&r?.canTransferAmount){let d=O.find(({address:_})=>_===r?.address);d||L({value:d,reportParams:{payWallet:r,payWallets:O},message:`payWallet address get ${d}`}),d&&at(d)}},[L,r,O]);let Y=(0,t.useMemo)(()=>l.map(s=>{let{tokenId:d,protocol:_}=s,{txId:D,outputIndex:U,outputValue:qe}=s?.btcNftUtxoDetail||{},Ut={txHash:D,nftId:s.tokenId,status:1,address:p,vout:Number(U),coinAmount:Number(qe),resourceUrl:s?.resourceUrl};return _===De.Atomicals&&Object.assign(Ut,{data:[{atomicalId:d,type:Me,amount:1}]}),Ut}),[p,l]),Lt=(0,t.useMemo)(()=>l.map(s=>{let d=s?.tokenId,{outputValue:_}=s?.btcNftUtxoDetail||{},D=Number(_);S||(D=P.lt(_,546)?546:Number(_));let U={amount:D,address:y};return v===q.ARC_20&&Object.assign(U,{data:[{atomicalId:d,type:Me,amount:1}]}),U}),[S,l,v,y]),lt=(0,t.useMemo)(()=>{if(!S){let{outputValue:s=0}=l?.[0]?.btcNftUtxoDetail||{};if(s<546)return P.sub(546,s)}return 0},[S,l]),[ct,T,V]=xe({coinId:o,protocolId:v,toAddr:y,coinAmount:lt,fromAddr:r?.address,satBytes:E?.satBytes,utxoParams:{satBytes:E?.satBytes,needFilteredUtxo:nt},canTransferAmount:r?.canTransferAmount,inputs:Y,outputs:Lt},{ready:!!Y?.length}),mt=S?K.BTC_NFT_BULK_SEND:K.SEND_NFT,Et=Ae({coinId:o,walletId:n,protocolId:v,coinAmount:0,toAddr:y,fromAddr:p,changeAddr:r?.address,localType:u?.localType,dustSize:v===q.ARC_20?void 0:A?.minOutput,networkFee:T,satBytes:E.satBytes,inputs:Y,outputs:Lt}),dt=l.map(({tokenId:s})=>s),Re=JSON.stringify({nftIds:dt,from:p,to:y,serviceCharge:T,gasFrom:r?.address}),Ft=de({coinId:o,txType:mt,walletId:n,coinAmount:0,fromAddr:p,toAddr:y,networkFee:T,localType:u?.localType,extJson:Re,txSource:Zt.NFT}),Bt=_e({coinId:o,walletId:n,address:r.address,utxoType:pe.TRANSFER,satBytes:E?.satBytes,needFilteredUtxo:nt}),C=(0,ve.useDispatch)(),B=(0,Ye.useHistory)(),Pt=ge({coinId:o,txType:K.SEND_NFT,protocolId:Jt(u?.chainId),address:r.address}),ut=l?.length,He=(0,t.useMemo)(()=>(l?.slice(0,it?ut:Ue)).map(({resourceUrl:d,name:_})=>({title:_,icon:{src:d}})),[l,it,ut]),W=(0,t.useMemo)(()=>!(r?.canTransferAmount&&P.lt(r?.canTransferAmount,P.add(T,lt))),[T,lt,r?.canTransferAmount]),ze=ne(n),[Ve,ft]=(0,t.useState)(!1),pt=(0,t.useCallback)(async()=>{e.id?(await C(yt(e.id)),await C(gt()),B.push(Q)):(C(_t()),W?B.goBack():B.replace(Q)),ft(!1)},[C,B,W,e.id]),{tipMessageProps:Ge}=ke({isHardware:b,feeError:V,isSufficientGas:W,dustError:st,transferReminder:rt}),kt=(0,t.useCallback)(async()=>{if(!await fe({walletId:n,callback:async()=>{await C(yt(e.id))}}))return;let d=await Bt(0,T);await Pt([...Y,...d],pt),ft(!0);let _=await Et({utxoList:[],utxos:[{address:r.address,inputs:ye(d)}]}),D=await me(u?.localType,_);try{e.id?(await C(te(e.id,{coinId:o,txHash:D,signedTx:_,serviceCharge:T,gasFrom:r.address,txType:mt,nftIds:dt})),await C(gt())):(await Ft(_),C(_t()),Vt.success({title:f("wallet_transfer_notif_transaction_submit")})),B.push(Q)}catch(U){console.log(U)}finally{ft(!1)}},[pt,Pt,u?.localType,C,T,Bt,B,W,dt,r.address,Ft,Et,Y,mt,e.id]),{loading:St,onClick:Ot}=At(kt),{loading:Wt,onClick:Dt}=At(pt),Ze=(0,t.useMemo)(()=>{let s={actionType:j.ACTION_TYPE.CANCEL,btnText:f("wallet_dapp_connection_btn_reject"),onClick:Dt,loading:Wt},d={disabled:wt||ct||V||b||!Number(T)||!l?.length||bt||st,actionType:j.ACTION_TYPE.CONFIRM,onClick:Ot,loading:St};return W||(d={coinId:o,walletId:n,address:r?.address,actionType:j.ACTION_TYPE.FILL_UP}),[s,d]},[wt,ct,V,b,T,l?.length,kt,W,e.id,C,B,o,n,r?.address,bt,st,Wt,St,Dt,Ot]);return t.default.createElement(w.Box,null,t.default.createElement(et,null,t.default.createElement(Ce,{space:24,title:f("wallet_extension_send_colored_send"),summaryList:He}),ut>Ue&&t.default.createElement(w.FlexBox,{justify:"center",className:Ct["nft-transfer__extend"],onClick:je},t.default.createElement(Tt,{size:Tt.SIZE.xs,className:Ct["nft-transfer__icon"],icon:it?"okds-arrow-chevron-up-md":"okx-wallet-plugin-add-arrow-chevrons"}))),t.default.createElement(et,null,t.default.createElement(tt,{walletId:n,address:p,title:f("extension_send_mid_text_from")}),t.default.createElement(tt,{address:y,title:f("extension_send_mid_text_to")})),t.default.createElement(et,null,t.default.createElement(Ie,{coinId:o,loading:ct,estimateFailed:V,networkFee:T,onClick:()=>{H({networkFee:!0})}}),t.default.createElement(tt,{copyable:!1,address:r?.address,addressType:r?.addressType,title:f("btcnft_gas_label_pay_gas_with"),tags:[f(Z[r?.addressType])],onClick:()=>{H({payWallet:!0})}},t.default.createElement(Ne,{coinBalance:r.canTransferAmount,coinId:o}))),t.default.createElement(Le,{coinId:o,value:r,options:O,visible:ht.payWallet,onChange:at,onToggleVisible:()=>{H({payWallet:!1})}}),t.default.createElement(re,{offsetBottom:0,placeholder:!0,borderTop:!0},t.default.createElement(k,{coinId:o,...Ge}),t.default.createElement(j,{buttonGroup:Ze})),t.default.createElement(he,{coinId:o,signInfo:A,visible:ht?.networkFee,value:E,estimatedFee:T,onChange:Nt,onToggleVisible:()=>{H({networkFee:!1})}}),t.default.createElement(be,{visible:ze&&Ve}))};export{zr as a};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-3SNY26AW.js.map
